# ç”µåŠ›äº¤æ˜“ä¸­å¿ƒæ¥å£æœåŠ¡å¹³å°æŠ€æœ¯æ¶æ„æ–‡æ¡£ v1.0

## ç‰ˆæœ¬ä¿¡æ¯

| ç‰ˆæœ¬å·  | å‘å¸ƒæ—¥æœŸ       | æ›´æ–°å†…å®¹                  | ç»´æŠ¤äººå‘˜ |
| ---- | ---------- | --------------------- | ---- |
| v1.0 | 2024-01-15 | åˆå§‹æŠ€æœ¯æ¶æ„è®¾è®¡ï¼Œå¯¹åº”PRD v1.0åŠŸèƒ½ | æŠ€æœ¯å›¢é˜Ÿ |

## ç‰ˆæœ¬å¯¹åº”å…³ç³»

**æŠ€æœ¯æ¶æ„ v1.0 å¯¹åº” PRD v1.0**ï¼š

* âœ… æ¥å£ç›®å½•æµè§ˆä¸è®¢é˜…æŠ€æœ¯å®ç°

* âœ… æ¥å£ç”Ÿæˆä¸ç®¡ç†æŠ€æœ¯æ¶æ„

* âœ… è®¢é˜…ç”³è¯·å®¡æ‰¹æŠ€æœ¯æµç¨‹

* âœ… ç”¨æˆ·ä¸­å¿ƒæŠ€æœ¯å®ç°

* ğŸš« æ¥å£ç›‘æ§æŠ€æœ¯æ¶æ„ï¼ˆv2.0å®ç°ï¼‰

* ğŸš« æ—¥å¿—å®¡è®¡æŠ€æœ¯æ–¹æ¡ˆï¼ˆv2.0å®ç°ï¼‰

* ğŸš« è®¡è´¹ç®¡ç†æŠ€æœ¯æ–¹æ¡ˆï¼ˆæš‚ä¸å®ç°ï¼‰

***

## 1. æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TD
    A[ç”¨æˆ·æµè§ˆå™¨] --> B[Nginxè´Ÿè½½å‡è¡¡]
    B --> C[Spring Cloud Gateway]
    C --> D[å‰ç«¯åº”ç”¨ Vue.js]
    C --> E[ç”¨æˆ·æœåŠ¡]
    C --> F[æ¥å£ç®¡ç†æœåŠ¡]
    C --> G[å®¡æ‰¹æœåŠ¡]
    
    E --> J[MySQLä¸»åº“]
    F --> J
    G --> J
    
    subgraph "å‰ç«¯å±‚"
        D
    end
    
    subgraph "ç½‘å…³å±‚"
        C
    end
    
    subgraph "åº”ç”¨å±‚"
        E
        F
        G
    end
    
    subgraph "æ•°æ®å±‚"
        J
    end
```

### 1.2 æ¶æ„ç‰¹ç‚¹

* **å¾®æœåŠ¡æ¶æ„**ï¼šé‡‡ç”¨Spring Cloudå¾®æœåŠ¡æ¶æ„ï¼ŒæœåŠ¡é—´é€šè¿‡HTTP REST APIé€šä¿¡

* **å‰åç«¯åˆ†ç¦»**ï¼šVue.jså‰ç«¯ + Spring Bootåç«¯ï¼Œé€šè¿‡RESTful APIäº¤äº’

* **ç»Ÿä¸€ç½‘å…³**ï¼šSpring Cloud Gatewayä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œå¤„ç†è·¯ç”±ã€è®¤è¯ã€é™æµ

* **è¯»å†™åˆ†ç¦»**ï¼šMySQLä¸»ä»æ¶æ„ï¼Œè¯»å†™åˆ†ç¦»æå‡æ•°æ®åº“æ€§èƒ½

## 2. æŠ€æœ¯æ ˆè¯´æ˜

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

* **æ¡†æ¶**ï¼šVue.js 3.x + Vue Router + Vuex

* **UIç»„ä»¶åº“**ï¼šElement Plus

* **æ„å»ºå·¥å…·**ï¼šVite

* **æ ·å¼**ï¼šSCSS + CSS3

* **HTTPå®¢æˆ·ç«¯**ï¼šAxios

#### 2.1.1 å‰ç«¯æƒé™æ§åˆ¶å®ç°

**ç»„ä»¶çº§æƒé™æ§åˆ¶**ï¼š

```javascript
// æ¥å£ç®¡ç†é¡µé¢ç»„ä»¶æƒé™æ§åˆ¶
<template>
  <div class="interface-management">
    <!-- é¡¶éƒ¨æ“ä½œåŒº - ä¸‰ä¸ªæŒ‰é’®æ°´å¹³æ’åˆ— -->
    <div class="operation-bar">
      <!-- æ¥å£ç”ŸæˆæŒ‰é’® - ä»…æŠ€æœ¯éƒ¨å¯è§ -->
      <el-button 
        v-if="hasPermission('tech')" 
        type="primary" 
        @click="handleCreateInterface">
        æ¥å£ç”Ÿæˆ
      </el-button>
      
      <!-- ä¸Šæ¶æŒ‰é’® - ä»…ç»“ç®—éƒ¨å¯è§ -->
      <el-button 
        v-if="hasPermission('settlement')" 
        type="success" 
        @click="handlePublishInterface">
        ä¸Šæ¶
      </el-button>
      
      <!-- ä¸‹æ¶æŒ‰é’® - ä»…ç»“ç®—éƒ¨å¯è§ -->
      <el-button 
        v-if="hasPermission('settlement')" 
        type="warning" 
        @click="handleUnpublishInterface">
        ä¸‹æ¶
      </el-button>
    </div>
    
    <!-- æ¥å£åˆ—è¡¨ -->
    <interface-list />
    
    <!-- æ¥å£ç”Ÿæˆå¼¹çª— -->
    <interface-creation-dialog 
      v-model="showCreationDialog"
      @success="handleCreationSuccess" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      showCreationDialog: false
    }
  },
  methods: {
    // æƒé™æ£€æŸ¥æ–¹æ³•
    hasPermission(role) {
      const userRole = this.$store.getters.userRole;
      return userRole === role || userRole === 'admin';
    },
    
    // æ‰“å¼€æ¥å£ç”Ÿæˆå¼¹çª—
    handleCreateInterface() {
      this.showCreationDialog = true;
    },
    
    // æ¥å£ç”ŸæˆæˆåŠŸå›è°ƒ
    handleCreationSuccess() {
      this.showCreationDialog = false;
      this.$message.success('æ¥å£ç”ŸæˆæˆåŠŸï¼Œå½“å‰çŠ¶æ€ï¼šæœªä¸Šæ¶');
      this.refreshInterfaceList();
    }
  }
}
</script>
```

#### 2.1.2 æ¥å£ç”Ÿæˆå¼¹çª—ç»„ä»¶è®¾è®¡

**ç»„ä»¶ç»“æ„**ï¼š

```javascript
// InterfaceCreationDialog.vue
<template>
  <el-dialog
    title="æ¥å£ç”Ÿæˆå‘å¯¼"
    v-model="visible"
    width="800px"
    :close-on-click-modal="false"
    :close-on-press-escape="false">
    
    <!-- æ­¥éª¤å¯¼èˆªæ¡ -->
    <el-steps :active="currentStep" align-center class="step-nav">
      <el-step title="æ•°æ®æºé€‰æ‹©" :status="getStepStatus(0)" />
      <el-step title="æ¥å£é…ç½®" :status="getStepStatus(1)" />
      <el-step title="å‚æ•°è®¾ç½®" :status="getStepStatus(2)" />
      <el-step title="é¢„è§ˆç¡®è®¤" :status="getStepStatus(3)" />
    </el-steps>
    
    <!-- æ­¥éª¤å†…å®¹åŒº -->
    <div class="step-content" v-loading="loading">
      <!-- æ­¥éª¤1ï¼šæ•°æ®æºé€‰æ‹© -->
      <data-source-selection 
        v-if="currentStep === 0"
        v-model="formData.dataSource"
        @next="nextStep" />
      
      <!-- æ­¥éª¤2ï¼šæ¥å£é…ç½® -->
      <interface-configuration 
        v-if="currentStep === 1"
        v-model="formData.config"
        :data-source="formData.dataSource"
        @next="nextStep"
        @prev="prevStep" />
      
      <!-- æ­¥éª¤3ï¼šå‚æ•°è®¾ç½® -->
      <parameter-settings 
        v-if="currentStep === 2"
        v-model="formData.parameters"
        @next="nextStep"
        @prev="prevStep" />
      
      <!-- æ­¥éª¤4ï¼šé¢„è§ˆç¡®è®¤ -->
      <preview-confirmation 
        v-if="currentStep === 3"
        :form-data="formData"
        @confirm="handleConfirm"
        @prev="prevStep" />
    </div>
    
    <!-- åº•éƒ¨æ“ä½œæ  -->
    <template #footer>
      <div class="dialog-footer">
        <el-button @click="handleCancel">å–æ¶ˆ</el-button>
        <el-button 
          v-if="currentStep > 0" 
          @click="prevStep">ä¸Šä¸€æ­¥</el-button>
        <el-button 
          v-if="currentStep < 3" 
          type="primary" 
          @click="nextStep"
          :disabled="!canNextStep">ä¸‹ä¸€æ­¥</el-button>
        <el-button 
          v-if="currentStep === 3" 
          type="primary" 
          @click="handleConfirm"
          :loading="submitting">ç”Ÿæˆæ¥å£</el-button>
      </div>
    </template>
  </el-dialog>
</template>

<script>
export default {
  name: 'InterfaceCreationDialog',
  props: {
    modelValue: Boolean
  },
  emits: ['update:modelValue', 'success'],
  data() {
    return {
      currentStep: 0,
      loading: false,
      submitting: false,
      formData: {
        dataSource: null,
        config: {},
        parameters: []
      }
    }
  },
  computed: {
    visible: {
      get() { return this.modelValue },
      set(val) { this.$emit('update:modelValue', val) }
    },
    canNextStep() {
      // æ ¹æ®å½“å‰æ­¥éª¤éªŒè¯æ˜¯å¦å¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥
      switch(this.currentStep) {
        case 0: return this.formData.dataSource?.table;
        case 1: return this.formData.config?.name && this.formData.config?.description;
        case 2: return true;
        default: return false;
      }
    }
  },
  methods: {
    getStepStatus(step) {
      if (step < this.currentStep) return 'finish';
      if (step === this.currentStep) return 'process';
      return 'wait';
    },
    
    nextStep() {
      if (this.currentStep < 3) {
        this.currentStep++;
      }
    },
    
    prevStep() {
      if (this.currentStep > 0) {
        this.currentStep--;
      }
    },
    
    async handleConfirm() {
      this.submitting = true;
      try {
        await this.createInterface();
        this.$emit('success');
      } catch (error) {
        this.$message.error('æ¥å£ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
      } finally {
        this.submitting = false;
      }
    },
    
    async createInterface() {
      const response = await this.$api.interfaces.create({
        dataSource: this.formData.dataSource,
        config: this.formData.config,
        parameters: this.formData.parameters
      });
      return response.data;
    },
    
    handleCancel() {
      this.visible = false;
      this.resetForm();
    },
    
    resetForm() {
      this.currentStep = 0;
      this.formData = {
        dataSource: null,
        config: {},
        parameters: []
      };
    }
  }
}
</script>
```

**è·¯ç”±å®ˆå«æƒé™æ§åˆ¶**ï¼š

```javascript
// router/index.js
router.beforeEach((to, from, next) => {
  const userRole = store.getters.userRole;
  const requiredRole = to.meta.role;
  
  if (requiredRole && !checkPermission(userRole, requiredRole)) {
    next('/403'); // æ— æƒé™é¡µé¢
  } else {
    next();
  }
});

function checkPermission(userRole, requiredRole) {
  const roleHierarchy = {
    'admin': ['admin', 'settlement', 'tech', 'consumer'],
    'settlement': ['settlement'],
    'tech': ['tech'],
    'consumer': ['consumer']
  };
  
  return roleHierarchy[userRole]?.includes(requiredRole);
}
```

### 2.2 åç«¯æŠ€æœ¯æ ˆ

* **æ¡†æ¶**ï¼šSpring Boot 2.7.x + Spring Cloud 2021.x

* **ç½‘å…³**ï¼šSpring Cloud Gateway

* **æœåŠ¡æ³¨å†Œ**ï¼šNacos

* **é…ç½®ä¸­å¿ƒ**ï¼šNacos Config

* **æ•°æ®åº“**ï¼šMySQL 8.0ï¼ˆä¸»ä»æ¶æ„ï¼‰

* **æ•°æ®åº“è¿æ¥æ± **ï¼šHikariCPè¿æ¥æ± 

* **ORMæ¡†æ¶**ï¼šMyBatis Plus

* **å®‰å…¨æ¡†æ¶**ï¼šSpring Security + JWT

### 2.3 è¿ç»´æŠ€æœ¯æ ˆ

* **å®¹å™¨åŒ–**ï¼šDocker + Docker Compose

* **ç›‘æ§**ï¼šPrometheus + Grafana

* **æ—¥å¿—**ï¼šELK Stackï¼ˆElasticsearch + Logstash + Kibanaï¼‰

* **è´Ÿè½½å‡è¡¡**ï¼šNginx

## 3. è·¯ç”±å®šä¹‰

### 3.1 å‰ç«¯è·¯ç”±

| è·¯ç”±è·¯å¾„                  | ç»„ä»¶åç§°                | åŠŸèƒ½æè¿°  | æƒé™è¦æ±‚    |
| --------------------- | ------------------- | ----- | ------- |
| /                     | Dashboard           | é¦–é¡µä»ªè¡¨æ¿ | å·²ç™»å½•     |
| /login                | Login               | ç”¨æˆ·ç™»å½•  | æ—        |
| /interface/catalog    | InterfaceCatalog    | æ¥å£ç›®å½•  | æ‰€æœ‰ç”¨æˆ·    |
| /interface/management | InterfaceManagement | æ¥å£ç®¡ç†  | æŠ€æœ¯éƒ¨/ç»“ç®—éƒ¨ |
| /interface/detail/:id | InterfaceDetail     | æ¥å£è¯¦æƒ…  | æ‰€æœ‰ç”¨æˆ·    |
| /application/approval | ApplicationApproval | ç”³è¯·å®¡æ‰¹  | ç»“ç®—éƒ¨     |
| /user/center          | UserCenter          | ç”¨æˆ·ä¸­å¿ƒ  | æ‰€æœ‰ç”¨æˆ·    |

### 3.2 åç«¯APIè·¯ç”±

| æœåŠ¡åç§°              | è·¯ç”±å‰ç¼€                 | åŠŸèƒ½æè¿°   |
| ----------------- | -------------------- | ------ |
| user-service      | /api/v1/users        | ç”¨æˆ·ç®¡ç†æœåŠ¡ |
| interface-service | /api/v1/interfaces   | æ¥å£ç®¡ç†æœåŠ¡ |
| approval-service  | /api/v1/applications | å®¡æ‰¹æœåŠ¡   |
| gateway-service   | /api/v1/gateway      | ç½‘å…³ç®¡ç†æœåŠ¡ |

## 4. æ ¸å¿ƒä¸šåŠ¡æŠ€æœ¯æ—¶åºå›¾

### 4.1 ç”¨æˆ·ç™»å½•è®¤è¯æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·æµè§ˆå™¨
    participant G as Gatewayç½‘å…³
    participant US as ç”¨æˆ·æœåŠ¡
    participant DB as MySQLæ•°æ®åº“
    
    U->>G: 1. æäº¤ç™»å½•è¯·æ±‚
    G->>US: 2. è½¬å‘ç™»å½•è¯·æ±‚
    US->>DB: 3. éªŒè¯ç”¨æˆ·å‡­æ®
    DB-->>US: 4. è¿”å›ç”¨æˆ·ä¿¡æ¯
    US->>US: 5. ç”ŸæˆJWT Token
    US->>DB: 6. ä¿å­˜ç”¨æˆ·ä¼šè¯
    US-->>G: 7. è¿”å›Tokenå’Œç”¨æˆ·ä¿¡æ¯
    G-->>U: 8. è¿”å›ç™»å½•ç»“æœ
    
    Note over U,DB: åç»­è¯·æ±‚æºå¸¦Tokenè¿›è¡Œè®¤è¯
    U->>G: 9. æºå¸¦Tokençš„APIè¯·æ±‚
    G->>G: 10. éªŒè¯Tokenæœ‰æ•ˆæ€§
    G->>DB: 11. æ£€æŸ¥Tokenæœ‰æ•ˆæ€§
    DB-->>G: 12. è¿”å›éªŒè¯ç»“æœ
    G->>US: 13. è½¬å‘ä¸šåŠ¡è¯·æ±‚
    US-->>G: 14. è¿”å›ä¸šåŠ¡ç»“æœ
    G-->>U: 15. è¿”å›æœ€ç»ˆç»“æœ
```

### 4.2 ç»Ÿä¸€æ¥å£é…ç½®è§„èŒƒå®ç°

#### 4.2.1 æ¥å£è·¯å¾„è§„èŒƒåŒ–

**è·¯å¾„ç”Ÿæˆè§„åˆ™**ï¼š

```java
@Service
public class InterfacePathGenerator {
    
    private static final String PATH_PREFIX = "/px-phzhb-external-share/dataproduct/";
    
    public String generateInterfacePath(String interfaceName, String businessType) {
        // æ ¹æ®æ¥å£åç§°å’Œä¸šåŠ¡ç±»å‹ç”Ÿæˆæ ‡å‡†è·¯å¾„
        String pathSuffix = generatePathSuffix(interfaceName, businessType);
        return PATH_PREFIX + pathSuffix;
    }
    
    private String generatePathSuffix(String interfaceName, String businessType) {
        // ç¤ºä¾‹ï¼š"ç”µç½‘å…³é”®æ–­é¢çº¦æŸæƒ…å†µ" -> "queryKeySectionConstraints"
        // ç¤ºä¾‹ï¼š"å¿…å¼€å¿…åœæœºç»„åå•" -> "queryMustOpenOffNameAndCapacity"
        return convertToApiPath(interfaceName);
    }
}
```

#### 4.2.2 æ ‡å‡†å‚æ•°æ¨¡æ¿

**å‚æ•°é…ç½®æ¨¡æ¿**ï¼š

```java
@Component
public class StandardParameterTemplate {
    
    public List<ParameterDefinition> getStandardParameters() {
        return Arrays.asList(
            ParameterDefinition.builder()
                .paramName("dataTime")
                .paramType("string")
                .description("æŸ¥è¯¢æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD")
                .required(true)
                .validationRule("date:YYYY-MM-DD,max:yesterday")
                .example("2022-03-17")
                .build(),
            ParameterDefinition.builder()
                .paramName("appId")
                .paramType("string")
                .description("åº”ç”¨IDï¼Œç”¨æˆ·èº«ä»½æ ‡è¯†")
                .required(true)
                .validationRule("string,length:15-20")
                .example("KzoHypQZH4-F6qM63L")
                .build()
        );
    }
}
```

### 4.3 æ¥å£ç”Ÿæˆå®Œæ•´æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant U as æŠ€æœ¯äººå‘˜
    participant F as å‰ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant IS as æ¥å£æœåŠ¡
    participant DB as MySQLæ•°æ®åº“
    
    U->>F: 1. ç‚¹å‡»ç”Ÿæˆæ¥å£æŒ‰é’®
    F->>G: 2. è¯·æ±‚æ•°æ®åº“è¡¨åˆ—è¡¨
    G->>IS: 3. è½¬å‘è¯·æ±‚
    IS->>DB: 4. æŸ¥è¯¢æ•°æ®åº“è¡¨ä¿¡æ¯
    DB-->>IS: 5. è¿”å›è¡¨åˆ—è¡¨
    IS-->>G: 6. è¿”å›è¡¨åˆ—è¡¨
    G-->>F: 7. è¿”å›ç»™å‰ç«¯
    F-->>U: 8. å±•ç¤ºæ•°æ®åº“è¡¨é€‰æ‹©ç•Œé¢
    
    U->>F: 9. é€‰æ‹©æ•°æ®åº“è¡¨å¹¶é…ç½®æ¥å£
    F->>G: 10. æäº¤æ¥å£ç”Ÿæˆè¯·æ±‚
    G->>IS: 11. è½¬å‘ç”Ÿæˆè¯·æ±‚
    IS->>DB: 12. éªŒè¯æ•°æ®åº“è¡¨ç»“æ„
    DB-->>IS: 13. è¿”å›è¡¨ç»“æ„ä¿¡æ¯
    IS->>IS: 14. ç”Ÿæˆæ¥å£ä»£ç å’Œé…ç½®
    IS->>DB: 15. ä¿å­˜æ¥å£ä¿¡æ¯(çŠ¶æ€ä¸ºæœªä¸Šæ¶)
    IS-->>G: 16. è¿”å›ç”Ÿæˆç»“æœ
    G-->>F: 17. è¿”å›ç»™å‰ç«¯
    F-->>U: 18. æ˜¾ç¤ºæ¥å£ç”ŸæˆæˆåŠŸï¼Œè¿›å…¥æœªä¸Šæ¶åˆ—è¡¨
    
    Note over IS: æ¥å£ç”Ÿæˆå®Œæˆï¼Œç­‰å¾…ç»“ç®—éƒ¨ä¸Šæ¶
```

### 4.4 æ¥å£ä¸Šæ¶æ“ä½œæ—¶åºå›¾

```mermaid
sequenceDiagram
    participant B as ç»“ç®—äººå‘˜
    participant F as å‰ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant IS as æ¥å£æœåŠ¡
    participant GS as ç½‘å…³æœåŠ¡
    participant DB as MySQLæ•°æ®åº“
    
    B->>F: 1. æŸ¥çœ‹æœªä¸Šæ¶æ¥å£åˆ—è¡¨
    F->>G: 2. è¯·æ±‚æœªä¸Šæ¶æ¥å£
    G->>IS: 3. è½¬å‘è¯·æ±‚
    IS->>DB: 4. æŸ¥è¯¢æœªä¸Šæ¶æ¥å£
    DB-->>IS: 5. è¿”å›æ¥å£åˆ—è¡¨
    IS-->>G: 6. è¿”å›æ¥å£æ•°æ®
    G-->>F: 7. è¿”å›ç»™å‰ç«¯
    F-->>B: 8. å±•ç¤ºæœªä¸Šæ¶æ¥å£åˆ—è¡¨
    
    B->>F: 9. é€‰æ‹©æ¥å£å¹¶ç‚¹å‡»ä¸Šæ¶
    F->>G: 10. å‘é€ä¸Šæ¶è¯·æ±‚
    G->>IS: 11. è½¬å‘ä¸Šæ¶è¯·æ±‚
    IS->>DB: 12. æ›´æ–°æ¥å£çŠ¶æ€ä¸ºå·²ä¸Šæ¶
    IS->>GS: 13. åŒæ­¥è°ƒç”¨ç½‘å…³æœåŠ¡æ³¨å†Œè·¯ç”±
    GS->>GS: 14. ç”ŸæˆåŠ¨æ€è·¯ç”±é…ç½®
    GS->>G: 15. æ³¨å†Œæ¥å£è·¯ç”±
    GS-->>IS: 16. è¿”å›è·¯ç”±æ³¨å†Œç»“æœ
    IS-->>G: 17. è¿”å›ä¸Šæ¶ç»“æœ
    G-->>F: 18. è¿”å›ç»™å‰ç«¯
    F-->>B: 19. æ˜¾ç¤ºä¸Šæ¶æˆåŠŸ
    
    Note over IS,GS: åŒæ­¥å¤„ç†è·¯ç”±æ³¨å†Œï¼Œç¡®ä¿æ“ä½œä¸€è‡´æ€§
```

### 4.5 è®¢é˜…ç”³è¯·å®¡æ‰¹æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant C as æ•°æ®æ¶ˆè´¹è€…
    participant F as å‰ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant AS as å®¡æ‰¹æœåŠ¡
    participant US as ç”¨æˆ·æœåŠ¡
    participant NS as é€šçŸ¥æœåŠ¡
    participant DB as MySQLæ•°æ®åº“
    participant A as å®¡æ‰¹äººå‘˜
    
    C->>F: 1. æäº¤è®¢é˜…ç”³è¯·
    F->>G: 2. å‘é€ç”³è¯·è¯·æ±‚
    G->>AS: 3. è½¬å‘åˆ°å®¡æ‰¹æœåŠ¡
    AS->>DB: 4. ä¿å­˜ç”³è¯·è®°å½•
    AS->>NS: 5. å‘é€å®¡æ‰¹é€šçŸ¥
    NS->>A: 6. é€šçŸ¥å®¡æ‰¹äººå‘˜
    AS-->>G: 7. è¿”å›ç”³è¯·ç»“æœ
    G-->>F: 8. è¿”å›ç»™å‰ç«¯
    F-->>C: 9. æ˜¾ç¤ºç”³è¯·æäº¤æˆåŠŸ
    
    Note over A: å®¡æ‰¹äººå‘˜å¤„ç†ç”³è¯·
    A->>F: 10. æŸ¥çœ‹ç”³è¯·è¯¦æƒ…
    F->>G: 11. è¯·æ±‚ç”³è¯·ä¿¡æ¯
    G->>AS: 12. è½¬å‘è¯·æ±‚
    AS->>DB: 13. æŸ¥è¯¢ç”³è¯·è¯¦æƒ…
    DB-->>AS: 14. è¿”å›ç”³è¯·ä¿¡æ¯
    AS-->>G: 15. è¿”å›ç”³è¯·è¯¦æƒ…
    G-->>F: 16. è¿”å›ç»™å‰ç«¯
    F-->>A: 17. å±•ç¤ºç”³è¯·è¯¦æƒ…
    
    A->>F: 18. æäº¤å®¡æ‰¹å†³å®š
    F->>G: 19. å‘é€å®¡æ‰¹ç»“æœ
    G->>AS: 20. è½¬å‘å®¡æ‰¹è¯·æ±‚
    AS->>DB: 21. æ›´æ–°ç”³è¯·çŠ¶æ€
    AS->>US: 22. æ›´æ–°ç”¨æˆ·æƒé™
    US->>DB: 23. ä¿å­˜æƒé™å˜æ›´
    AS->>NS: 24. å‘é€ç»“æœé€šçŸ¥
    NS->>C: 25. é€šçŸ¥ç”³è¯·äºº
    AS-->>G: 26. è¿”å›å¤„ç†ç»“æœ
    G-->>F: 27. è¿”å›ç»™å‰ç«¯
    F-->>A: 28. æ˜¾ç¤ºå¤„ç†æˆåŠŸ
```

### 4.6 APIè°ƒç”¨è®¤è¯æ—¶åºå›¾ï¼ˆappIdéªŒè¯ï¼‰

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant AS as è®¤è¯æœåŠ¡
    participant IS as æ¥å£æœåŠ¡
    participant DS as æ•°æ®æº
    participant AL as å®¡è®¡æ—¥å¿—
    participant DB as MySQLæ•°æ®åº“
    
    C->>G: 1. APIè°ƒç”¨è¯·æ±‚(POST, JSONæ ¼å¼, åŒ…å«appId)
    G->>AS: 2. éªŒè¯appId
    AS->>DB: 3. æŸ¥è¯¢appIdå’Œæƒé™
    DB-->>AS: 4. è¿”å›ç”¨æˆ·æƒé™ä¿¡æ¯
    
    AS->>AS: 5. éªŒè¯æ¥å£è®¿é—®æƒé™
    alt æƒé™éªŒè¯é€šè¿‡
        AS-->>G: 6a. è¿”å›è®¤è¯æˆåŠŸ
        G->>IS: 7a. è½¬å‘ä¸šåŠ¡è¯·æ±‚
        IS->>DB: 8a. æ‰§è¡ŒSQLæŸ¥è¯¢
        DB-->>IS: 9a. è¿”å›æ ‡å‡†æ ¼å¼æ•°æ®
        IS->>IS: 10a. æ ¼å¼åŒ–ä¸º{status, message, data}å“åº”
        IS->>AL: 11a. è®°å½•è°ƒç”¨æ—¥å¿—
        IS-->>G: 12a. è¿”å›æ ‡å‡†å“åº”
        G-->>C: 13a. è¿”å›APIç»“æœ
    else æƒé™éªŒè¯å¤±è´¥
        AS->>AL: 6b. è®°å½•è®¿é—®æ‹’ç»æ—¥å¿—
        AS-->>G: 7b. è¿”å›æƒé™é”™è¯¯
        G-->>C: 8b. è¿”å›æ ‡å‡†é”™è¯¯å“åº”
    end
```

### 4.7 åŸAPIè°ƒç”¨è®¤è¯æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant AS as è®¤è¯æœåŠ¡
    participant IS as æ¥å£æœåŠ¡
    participant DS as æ•°æ®æº
    participant AL as å®¡è®¡æ—¥å¿—
    participant DB as MySQLæ•°æ®åº“
    
    C->>G: 1. APIè°ƒç”¨è¯·æ±‚(æºå¸¦API Key)
    G->>AS: 2. éªŒè¯API Key
    AS->>DB: 3. æŸ¥è¯¢Keyå’Œæƒé™
    DB-->>AS: 4. è¿”å›æƒé™ä¿¡æ¯
    
    AS->>AS: 5. éªŒè¯æ¥å£è®¿é—®æƒé™
    alt æƒé™éªŒè¯é€šè¿‡
        AS-->>G: 6a. è¿”å›è®¤è¯æˆåŠŸ
        G->>IS: 7a. è½¬å‘ä¸šåŠ¡è¯·æ±‚
        IS->>DB: 8a. æŸ¥è¯¢MySQLæ•°æ®åº“
    DB-->>IS: 9a. è¿”å›æ•°æ®
        IS->>AL: 10a. è®°å½•è°ƒç”¨æ—¥å¿—
        IS-->>G: 11a. è¿”å›ä¸šåŠ¡æ•°æ®
        G-->>C: 12a. è¿”å›APIç»“æœ
    else æƒé™éªŒè¯å¤±è´¥
        AS->>AL: 6b. è®°å½•è®¿é—®æ‹’ç»æ—¥å¿—
        AS-->>G: 7b. è¿”å›æƒé™é”™è¯¯
        G-->>C: 8b. è¿”å›403é”™è¯¯
    end
```

## 5. ç½‘å…³ä¸è·¯ç”±ç»´æŠ¤ç­–ç•¥

### 5.1 Spring Cloud GatewayåŠ¨æ€è·¯ç”±æ¶æ„

```mermaid
graph TD
    A[Gatewayå¯åŠ¨] --> B[åŠ è½½é™æ€è·¯ç”±é…ç½®]
    B --> C[è¿æ¥Nacosé…ç½®ä¸­å¿ƒ]
    C --> D[ç›‘å¬è·¯ç”±é…ç½®å˜æ›´]
    D --> E[åŠ¨æ€è·¯ç”±ç®¡ç†å™¨]
    
    E --> F[è·¯ç”±æ³¨å†Œ]
    E --> G[è·¯ç”±æ›´æ–°]
    E --> H[è·¯ç”±åˆ é™¤]
    
    F --> I[æ›´æ–°è·¯ç”±è¡¨]
    G --> I
    H --> I
    
    I --> J[åˆ·æ–°Gatewayè·¯ç”±]
    J --> K[é€šçŸ¥å…¶ä»–Gatewayå®ä¾‹]
    
    subgraph "è·¯ç”±å­˜å‚¨"
        L[Nacosé…ç½®]
        N[æœ¬åœ°ç¼“å­˜]
    end
    
    E --> L
    E --> N
```

### 5.2 åŠ¨æ€è·¯ç”±é…ç½®è§„èŒƒ

#### 5.2.1 è·¯ç”±é…ç½®æ ¼å¼

```yaml
# æ¥å£è·¯ç”±é…ç½®ç¤ºä¾‹
spring:
  cloud:
    gateway:
      routes:
        - id: interface-route-{interfaceId}
          uri: lb://interface-service
          predicates:
            - Path=/api/data/{interfaceId}/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100
                redis-rate-limiter.burstCapacity: 200
            - name: AuthFilter
              args:
                required-permissions: interface:read
          metadata:
            interface-id: "{interfaceId}"
            created-by: "system"
            created-time: "2024-01-15T10:30:00Z"
```

#### 5.2.2 è·¯ç”±ç®¡ç†API

```java
@RestController
@RequestMapping("/api/v1/gateway/routes")
public class RouteController {
    
    @PostMapping
    public ResponseEntity<String> addRoute(@RequestBody RouteDefinition route) {
        // æ·»åŠ åŠ¨æ€è·¯ç”±
        routeService.addRoute(route);
        return ResponseEntity.ok("Route added successfully");
    }
    
    @PutMapping("/{routeId}")
    public ResponseEntity<String> updateRoute(
        @PathVariable String routeId, 
        @RequestBody RouteDefinition route) {
        // æ›´æ–°è·¯ç”±é…ç½®
        routeService.updateRoute(routeId, route);
        return ResponseEntity.ok("Route updated successfully");
    }
    
    @DeleteMapping("/{routeId}")
    public ResponseEntity<String> deleteRoute(@PathVariable String routeId) {
        // åˆ é™¤è·¯ç”±
        routeService.deleteRoute(routeId);
        return ResponseEntity.ok("Route deleted successfully");
    }
}
```

### 5.3 è·¯ç”±çƒ­æ›´æ–°æœºåˆ¶

#### 5.3.1 é…ç½®å˜æ›´ç›‘å¬

```java
@Component
public class RouteConfigListener {
    
    @NacosConfigListener(dataId = "gateway-routes", groupId = "DEFAULT_GROUP")
    public void onRouteConfigChange(String configInfo) {
        try {
            // è§£ææ–°çš„è·¯ç”±é…ç½®
            List<RouteDefinition> newRoutes = parseRouteConfig(configInfo);
            
            // æ›´æ–°è·¯ç”±è¡¨
            routeDefinitionRepository.save(newRoutes);
            
            // åˆ·æ–°Gatewayè·¯ç”±
            applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this));
            
            log.info("Route configuration updated successfully");
        } catch (Exception e) {
            log.error("Failed to update route configuration", e);
        }
    }
}
```

#### 5.3.2 ç°åº¦å‘å¸ƒç­–ç•¥

```java
@Service
public class GrayReleaseService {
    
    public void enableGrayRelease(String interfaceId, String version, int percentage) {
        // åˆ›å»ºç°åº¦è·¯ç”±è§„åˆ™
        RouteDefinition grayRoute = RouteDefinition.builder()
            .id("gray-" + interfaceId + "-" + version)
            .uri("lb://interface-service-" + version)
            .predicate(predicateDefinition -> {
                predicateDefinition.setName("Path");
                predicateDefinition.addArg("pattern", "/api/data/" + interfaceId + "/**");
            })
            .filter(filterDefinition -> {
                filterDefinition.setName("GrayReleaseFilter");
                filterDefinition.addArg("percentage", String.valueOf(percentage));
            })
            .build();
            
        // æ³¨å†Œç°åº¦è·¯ç”±
        routeDefinitionRepository.save(grayRoute);
        
        // å‘å¸ƒè·¯ç”±åˆ·æ–°äº‹ä»¶
        applicationEventPublisher.publishEvent(new RefreshRoutesEvent(this));
    }
}
```

### 5.4 è·¯ç”±ç›‘æ§ä¸å‘Šè­¦

#### 5.4.1 è·¯ç”±å¥åº·æ£€æŸ¥

```java
@Component
@Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
public class RouteHealthChecker {
    
    public void checkRouteHealth() {
        List<RouteDefinition> routes = routeDefinitionRepository.getRouteDefinitions();
        
        for (RouteDefinition route : routes) {
            try {
                // æ£€æŸ¥è·¯ç”±ç›®æ ‡æœåŠ¡å¥åº·çŠ¶æ€
                boolean isHealthy = checkServiceHealth(route.getUri());
                
                if (!isHealthy) {
                    // å‘é€å‘Šè­¦
                    alertService.sendAlert(
                        "Route Health Check Failed", 
                        "Route " + route.getId() + " target service is unhealthy"
                    );
                    
                    // å¯é€‰ï¼šè‡ªåŠ¨ç¦ç”¨ä¸å¥åº·çš„è·¯ç”±
                    // routeService.disableRoute(route.getId());
                }
            } catch (Exception e) {
                log.error("Health check failed for route: " + route.getId(), e);
            }
        }
    }
}
```

## 6. æ•°æ®æ¨¡å‹è®¾è®¡

### 6.1 è¡¨çº§æ¨¡å‹ - ERå›¾

```mermaid
erDiagram
    USERS ||--o{ USER_ROLES : has
    USER_ROLES }o--|| ROLES : belongs_to
    USERS ||--o{ API_KEYS : owns
    USERS ||--o{ SUBSCRIPTION_APPLICATIONS : submits
    
    INTERFACES ||--o{ SUBSCRIPTION_APPLICATIONS : receives

    INTERFACES ||--o{ INTERFACE_PARAMETERS : has
    INTERFACES ||--o{ API_CALL_LOGS : generates
    
    SUBSCRIPTION_APPLICATIONS ||--o{ APPROVAL_RECORDS : has
    APPROVAL_RECORDS }o--|| USERS : approved_by
    
    API_KEYS ||--o{ API_CALL_LOGS : authenticates
    
    USERS {
        bigint id PK
        varchar username UK
        varchar email UK
        varchar password_hash
        varchar real_name
        varchar phone
        varchar department
        varchar position
        tinyint status
        datetime created_at
        datetime updated_at
    }
    
    ROLES {
        int id PK
        varchar role_name UK
        varchar role_code UK
        varchar description
        json permissions
        tinyint status
        datetime created_at
    }
    
    USER_ROLES {
        bigint id PK
        bigint user_id FK
        int role_id FK
        datetime assigned_at
    }
    
    API_KEYS {
        bigint id PK
        bigint user_id FK
        varchar api_key UK
        varchar secret_key
        json permissions
        datetime expires_at
        tinyint status
        datetime created_at
        datetime last_used_at
    }
    

    
    INTERFACES {
        bigint id PK
        varchar interface_name
        varchar interface_path UK
        varchar description

        varchar sql_template
        json request_params
        json response_format
        varchar status
        bigint created_by FK
        datetime created_at
        datetime updated_at
        datetime published_at
    }
    
    INTERFACE_PARAMETERS {
        bigint id PK
        bigint interface_id FK
        varchar param_name
        varchar param_type
        varchar param_description
        tinyint is_required
        varchar default_value
        varchar validation_rule
        int sort_order
    }
    
    SUBSCRIPTION_APPLICATIONS {
        bigint id PK
        bigint user_id FK
        bigint interface_id FK
        varchar application_reason
        varchar business_scenario
        varchar status
        datetime applied_at
        datetime approved_at
        bigint approved_by FK
        varchar approval_comment
    }
    
    APPROVAL_RECORDS {
        bigint id PK
        bigint application_id FK
        bigint approver_id FK
        varchar action
        varchar comment
        datetime created_at
    }
    
    API_CALL_LOGS {
        bigint id PK
        bigint api_key_id FK
        bigint interface_id FK
        varchar request_ip
        varchar request_method
        text request_params
        int response_status
        text response_body
        int response_time_ms
        datetime created_at
    }
    

```

### 6.2 è¡¨èŒè´£è¯´æ˜

| è¡¨å          | èŒè´£æè¿°     | æ ¸å¿ƒä¸šåŠ¡            |
| ----------- | -------- | --------------- |
| users       | ç”¨æˆ·åŸºç¡€ä¿¡æ¯ç®¡ç† | å­˜å‚¨ç”¨æˆ·è´¦å·ã€ä¸ªäººä¿¡æ¯ã€çŠ¶æ€ç­‰ |
| roles       | è§’è‰²æƒé™å®šä¹‰   | å®šä¹‰ç³»ç»Ÿè§’è‰²å’Œå¯¹åº”æƒé™     |
| user\_roles | ç”¨æˆ·è§’è‰²å…³è”   | ç®¡ç†ç”¨æˆ·ä¸è§’è‰²çš„å¤šå¯¹å¤šå…³ç³»   |
| api\_keys   | APIå¯†é’¥ç®¡ç†  | ç»Ÿä¸€APIå¯†é’¥ç”Ÿæˆã€æƒé™æ§åˆ¶  |

\| interfaces                 | æ¥å£å®šä¹‰ç®¡ç†   | å­˜å‚¨æ¥å£å…ƒæ•°æ®ã€SQLæ¨¡æ¿ç­‰  |
\| interface\_parameters      | æ¥å£å‚æ•°å®šä¹‰   | å®šä¹‰æ¥å£è¯·æ±‚å‚æ•°è§„èŒƒ      |
\| subscription\_applications | è®¢é˜…ç”³è¯·ç®¡ç†   | å¤„ç†ç”¨æˆ·æ¥å£è®¢é˜…ç”³è¯·æµç¨‹    |
\| approval\_records          | å®¡æ‰¹è®°å½•     | è®°å½•å®¡æ‰¹è¿‡ç¨‹å’Œå†å²       |
\| api\_call\_logs            | APIè°ƒç”¨æ—¥å¿—  | è®°å½•æ‰€æœ‰APIè°ƒç”¨è¯¦æƒ…     |

### 6.3 MySQLæ•°æ®åº“è¿æ¥é…ç½®

#### 6.3.1 æ•°æ®åº“è¿æ¥é…ç½®

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š

```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://mysql-master:3306/power_trading?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=true
    username: ${DB_USERNAME:power_user}
    password: ${DB_PASSWORD:power_password}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
      pool-name: PowerTradingHikariCP
      
  # è¯»å†™åˆ†ç¦»é…ç½®
  datasource:
    master:
      url: jdbc:mysql://mysql-master:3306/power_trading
      username: ${DB_MASTER_USERNAME:power_user}
      password: ${DB_MASTER_PASSWORD:power_password}
    slave:
      url: jdbc:mysql://mysql-slave:3306/power_trading
      username: ${DB_SLAVE_USERNAME:power_readonly}
      password: ${DB_SLAVE_PASSWORD:readonly_password}
```

#### 6.3.2 æ¥å£æ•°æ®è®¿é—®æ–¹å¼

**ç»Ÿä¸€æ•°æ®è®¿é—®**ï¼š

* æ‰€æœ‰æ¥å£å‡åŸºäºç°æœ‰MySQLæ•°æ®åº“ä¸­çš„ä¸šåŠ¡è¡¨

* é€šè¿‡SQLæ¨¡æ¿åŠ¨æ€ç”ŸæˆæŸ¥è¯¢è¯­å¥

* æ”¯æŒå‚æ•°åŒ–æŸ¥è¯¢ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

* ç»Ÿä¸€ä½¿ç”¨HikariCPè¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥

**æ•°æ®è¡¨è®¿é—®è§„èŒƒ**ï¼š

* æ¥å£ç”Ÿæˆæ—¶ç›´æ¥é€‰æ‹©MySQLæ•°æ®åº“ä¸­çš„ä¸šåŠ¡è¡¨

* æ”¯æŒå¤šè¡¨å…³è”æŸ¥è¯¢å’Œå¤æ‚ä¸šåŠ¡é€»è¾‘

* è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–çš„RESTful APIæ¥å£

* ç»Ÿä¸€çš„æ•°æ®æ ¼å¼å’Œé”™è¯¯å¤„ç†æœºåˆ¶

### 6.4 å­—æ®µçº§æ•°æ®å­—å…¸

#### 6.4.1 æ•æ„Ÿæ•°æ®åˆ†çº§æ ‡å‡†

| æ•æ„Ÿçº§åˆ«  | çº§åˆ«æè¿°      | æ•°æ®ç±»å‹ç¤ºä¾‹        | è„±æ•ç­–ç•¥ |
| ----- | --------- | ------------- | ---- |
| L1-å…¬å¼€ | å¯å…¬å¼€è®¿é—®çš„æ•°æ®  | ç”¨æˆ·åã€æ¥å£åç§°ã€å…¬å¼€æè¿° | æ— éœ€è„±æ• |
| L2-å†…éƒ¨ | å†…éƒ¨ä½¿ç”¨çš„ä¸šåŠ¡æ•°æ® | éƒ¨é—¨ä¿¡æ¯ã€æ¥å£é…ç½®     | éƒ¨åˆ†è„±æ• |
| L3-æ•æ„Ÿ | ä¸ªäººæ•æ„Ÿä¿¡æ¯    | æ‰‹æœºå·ã€é‚®ç®±ã€çœŸå®å§“å   | ä¸­é—´è„±æ• |
| L4-æœºå¯† | é«˜åº¦æœºå¯†æ•°æ®    | å¯†ç ã€å¯†é’¥ã€æ•°æ®åº“è¿æ¥   | å®Œå…¨åŠ å¯† |

#### 6.3.2 æ ¸å¿ƒè¡¨å­—æ®µå­—å…¸

**usersè¡¨å­—æ®µè¯¦æƒ…**ï¼š

| å­—æ®µå            | æ•°æ®ç±»å‹     | é•¿åº¦  | æ˜¯å¦å¿…å¡« | æ•æ„Ÿçº§åˆ«  | è„±æ•è§„åˆ™    | å­—æ®µæè¿°            |
| -------------- | -------- | --- | ---- | ----- | ------- | --------------- |
| id             | bigint   | -   | æ˜¯    | L1-å…¬å¼€ | æ—        | ç”¨æˆ·å”¯ä¸€æ ‡è¯†          |
| username       | varchar  | 50  | æ˜¯    | L2-å†…éƒ¨ | æ—        | ç”¨æˆ·ç™»å½•å           |
| email          | varchar  | 100 | æ˜¯    | L3-æ•æ„Ÿ | ä¸­é—´4ä½\*å· | ç”¨æˆ·é‚®ç®±åœ°å€          |
| password\_hash | varchar  | 255 | æ˜¯    | L4-æœºå¯† | å®Œå…¨éšè—    | å¯†ç å“ˆå¸Œå€¼           |
| real\_name     | varchar  | 50  | æ˜¯    | L3-æ•æ„Ÿ | å§“æ°+\*å·  | ç”¨æˆ·çœŸå®å§“å          |
| phone          | varchar  | 20  | å¦    | L3-æ•æ„Ÿ | ä¸­é—´4ä½\*å· | æ‰‹æœºå·ç             |
| department     | varchar  | 100 | å¦    | L2-å†…éƒ¨ | æ—        | æ‰€å±éƒ¨é—¨            |
| position       | varchar  | 100 | å¦    | L2-å†…éƒ¨ | æ—        | èŒä½ä¿¡æ¯            |
| status         | tinyint  | -   | æ˜¯    | L1-å…¬å¼€ | æ—        | ç”¨æˆ·çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨) |
| created\_at    | datetime | -   | æ˜¯    | L1-å…¬å¼€ | æ—        | åˆ›å»ºæ—¶é—´            |
| updated\_at    | datetime | -   | æ˜¯    | L1-å…¬å¼€ | æ—        | æ›´æ–°æ—¶é—´            |

**interfacesè¡¨å­—æ®µè¯¦æƒ…**ï¼š

| å­—æ®µå              | æ•°æ®ç±»å‹     | é•¿åº¦  | æ˜¯å¦å¿…å¡« | æ•æ„Ÿçº§åˆ«  | è„±æ•è§„åˆ™  | å­—æ®µæè¿°    |
| ---------------- | -------- | --- | ---- | ----- | ----- | ------- |
| id               | bigint   | -   | æ˜¯    | L1-å…¬å¼€ | æ—      | æ¥å£å”¯ä¸€æ ‡è¯†  |
| interface\_name  | varchar  | 200 | æ˜¯    | L1-å…¬å¼€ | æ—      | æ¥å£åç§°    |
| interface\_path  | varchar  | 500 | æ˜¯    | L2-å†…éƒ¨ | æ—      | æ¥å£è®¿é—®è·¯å¾„  |
| description      | text     | -   | å¦    | L1-å…¬å¼€ | æ—      | æ¥å£æè¿°ä¿¡æ¯  |
| data\_source\_id | int      | -   | æ˜¯    | L2-å†…éƒ¨ | æ—      | å…³è”æ•°æ®æºID |
| sql\_template    | text     | -   | æ˜¯    | L3-æ•æ„Ÿ | å…³é”®å­—è„±æ• | SQLæŸ¥è¯¢æ¨¡æ¿ |
| request\_params  | json     | -   | å¦    | L2-å†…éƒ¨ | æ—      | è¯·æ±‚å‚æ•°å®šä¹‰  |
| response\_format | json     | -   | å¦    | L2-å†…éƒ¨ | æ—      | å“åº”æ ¼å¼å®šä¹‰  |
| status           | varchar  | 20  | æ˜¯    | L1-å…¬å¼€ | æ—      | æ¥å£çŠ¶æ€    |
| created\_by      | bigint   | -   | æ˜¯    | L2-å†…éƒ¨ | æ—      | åˆ›å»ºäººID   |
| created\_at      | datetime | -   | æ˜¯    | L1-å…¬å¼€ | æ—      | åˆ›å»ºæ—¶é—´    |
| updated\_at      | datetime | -   | æ˜¯    | L1-å…¬å¼€ | æ—      | æ›´æ–°æ—¶é—´    |
| published\_at    | datetime | -   | å¦    | L1-å…¬å¼€ | æ—      | å‘å¸ƒæ—¶é—´    |

**api\_keysè¡¨å­—æ®µè¯¦æƒ…**ï¼š

| å­—æ®µå            | æ•°æ®ç±»å‹     | é•¿åº¦  | æ˜¯å¦å¿…å¡« | æ•æ„Ÿçº§åˆ«  | è„±æ•è§„åˆ™           | å­—æ®µæè¿°    |
| -------------- | -------- | --- | ---- | ----- | -------------- | ------- |
| id             | bigint   | -   | æ˜¯    | L1-å…¬å¼€ | æ—               | å¯†é’¥è®°å½•ID  |
| user\_id       | bigint   | -   | æ˜¯    | L2-å†…éƒ¨ | æ—               | å…³è”ç”¨æˆ·ID  |
| api\_key       | varchar  | 64  | æ˜¯    | L4-æœºå¯† | å‰4ä½+\*\*\*+å4ä½ | APIè®¿é—®å¯†é’¥ |
| secret\_key    | varchar  | 128 | æ˜¯    | L4-æœºå¯† | å®Œå…¨éšè—           | å¯†é’¥ç­¾åç§˜é’¥  |
| permissions    | json     | -   | å¦    | L2-å†…éƒ¨ | æ—               | æƒé™èŒƒå›´å®šä¹‰  |
| expires\_at    | datetime | -   | å¦    | L2-å†…éƒ¨ | æ—               | è¿‡æœŸæ—¶é—´    |
| status         | tinyint  | -   | æ˜¯    | L1-å…¬å¼€ | æ—               | å¯†é’¥çŠ¶æ€    |
| created\_at    | datetime | -   | æ˜¯    | L1-å…¬å¼€ | æ—               | åˆ›å»ºæ—¶é—´    |
| last\_used\_at | datetime | -   | å¦    | L2-å†…éƒ¨ | æ—               | æœ€åä½¿ç”¨æ—¶é—´  |

#### 6.3.3 è„±æ•å®ç°ç­–ç•¥

```java
@Component
public class DataMaskingService {
    
    /**
     * æ‰‹æœºå·è„±æ•ï¼š138****5678
     */
    public String maskPhone(String phone) {
        if (StringUtils.isEmpty(phone) || phone.length() < 7) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(phone.length() - 4);
    }
    
    /**
     * é‚®ç®±è„±æ•ï¼šabc****@example.com
     */
    public String maskEmail(String email) {
        if (StringUtils.isEmpty(email) || !email.contains("@")) {
            return email;
        }
        String[] parts = email.split("@");
        String username = parts[0];
        if (username.length() <= 3) {
            return email;
        }
        return username.substring(0, 3) + "****@" + parts[1];
    }
    
    /**
     * å§“åè„±æ•ï¼šå¼ **
     */
    public String maskName(String name) {
        if (StringUtils.isEmpty(name) || name.length() < 2) {
            return name;
        }
        return name.substring(0, 1) + "*".repeat(name.length() - 1);
    }
    
    /**
     * APIå¯†é’¥è„±æ•ï¼šabcd****wxyz
     */
    public String maskApiKey(String apiKey) {
        if (StringUtils.isEmpty(apiKey) || apiKey.length() < 8) {
            return "****";
        }
        return apiKey.substring(0, 4) + "****" + apiKey.substring(apiKey.length() - 4);
    }
}
```

## 7. åŠŸèƒ½æ¨¡å—è¯¦ç»†è°ƒç”¨è®¾è®¡

### 7.1 æ¥å£ç›®å½•æµè§ˆè°ƒç”¨é“¾è·¯

#### 7.1.1 å‰ç«¯â†’ç½‘å…³â†’åç«¯â†’æ•°æ®åº“è°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant F as Vueå‰ç«¯
    participant G as Gatewayç½‘å…³
    participant IS as æ¥å£æœåŠ¡
    participant DB as MySQLæ•°æ®åº“
    
    Note over F,DB: 1. é¡µé¢åˆå§‹åŒ–åŠ è½½
    F->>G: GET /api/v1/interfaces/categories
    G->>G: è·¯ç”±åŒ¹é…å’Œè®¤è¯
    G->>IS: è½¬å‘è¯·æ±‚åˆ°æ¥å£æœåŠ¡
    IS->>DB: SELECT * FROM interface_categories
    DB-->>IS: è¿”å›åˆ†ç±»æ•°æ®
    IS-->>G: è¿”å›åˆ†ç±»åˆ—è¡¨
    G-->>F: è¿”å›JSONå“åº”
    
    Note over F,DB: 2. æ ¹æ®åˆ†ç±»åŠ è½½æ¥å£åˆ—è¡¨
    F->>G: GET /api/v1/interfaces?category=power&page=1&size=20
    G->>IS: è½¬å‘è¯·æ±‚
    IS->>DB: å¤æ‚æŸ¥è¯¢æ¥å£ä¿¡æ¯
    Note over IS,DB: SELECT i.*, ic.category_name, u.real_name as creator<br/>FROM interfaces i<br/>LEFT JOIN interface_categories ic ON i.category_id = ic.id<br/>LEFT JOIN users u ON i.created_by = u.id<br/>WHERE i.status = 'published' AND ic.category_code = ?<br/>ORDER BY i.published_at DESC<br/>LIMIT ?, ?
    DB-->>IS: è¿”å›æ¥å£åˆ—è¡¨
    IS-->>G: è¿”å›æ¥å£åˆ—è¡¨
    G-->>F: è¿”å›åˆ†é¡µæ•°æ®
```

#### 7.1.2 æ•°æ®å¤„ç†é€»è¾‘

**å‰ç«¯æ•°æ®å¤„ç†**ï¼š

```javascript
// InterfaceCatalog.vue
export default {
  data() {
    return {
      categories: [],
      interfaces: [],
      loading: false,
      pagination: {
        current: 1,
        pageSize: 20,
        total: 0
      }
    }
  },
  
  async mounted() {
    await this.loadCategories()
    await this.loadInterfaces()
  },
  
  methods: {
    async loadCategories() {
      try {
        const response = await this.$http.get('/api/v1/interfaces/categories')
        this.categories = response.data.data
      } catch (error) {
        this.$message.error('åŠ è½½åˆ†ç±»å¤±è´¥')
      }
    },
    
    async loadInterfaces(category = '', page = 1) {
      this.loading = true
      try {
        const params = {
          category,
          page,
          size: this.pagination.pageSize
        }
        const response = await this.$http.get('/api/v1/interfaces', { params })
        this.interfaces = response.data.data.records
        this.pagination.total = response.data.data.total
      } catch (error) {
        this.$message.error('åŠ è½½æ¥å£åˆ—è¡¨å¤±è´¥')
      } finally {
        this.loading = false
      }
    }
  }
}
```

**åç«¯ä¸šåŠ¡é€»è¾‘**ï¼š

```java
@RestController
@RequestMapping("/api/v1/interfaces")
public class InterfaceController {
    
    @Autowired
    private InterfaceService interfaceService;
    
    @GetMapping("/categories")
    public ResponseEntity<ApiResponse<List<CategoryVO>>> getCategories() {
        List<CategoryVO> categories = interfaceService.getCategories();
        return ResponseEntity.ok(ApiResponse.success(categories));
    }
    
    @GetMapping
    public ResponseEntity<ApiResponse<PageResult<InterfaceVO>>> getInterfaces(
            @RequestParam(required = false) String category,
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "20") int size) {
        
        PageRequest pageRequest = PageRequest.of(page - 1, size);
        PageResult<InterfaceVO> result = interfaceService.getInterfaces(category, pageRequest);
        return ResponseEntity.ok(ApiResponse.success(result));
    }
}

@Service
public class InterfaceService {
    
    @Autowired
    private InterfaceMapper interfaceMapper;
    
    public List<CategoryVO> getCategories() {
        return interfaceMapper.selectCategories();
    }
    
    public PageResult<InterfaceVO> getInterfaces(String category, PageRequest pageRequest) {
        // æ„å»ºæŸ¥è¯¢æ¡ä»¶ - ä»…æŸ¥è¯¢å·²ä¸Šæ¶çŠ¶æ€çš„æ¥å£
        QueryWrapper<Interface> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("status", "published"); // åªæŸ¥è¯¢å·²ä¸Šæ¶çš„æ¥å£
        if (StringUtils.isNotBlank(category)) {
            queryWrapper.eq("category_code", category);
        }
        queryWrapper.orderByDesc("published_at"); // æŒ‰ä¸Šæ¶æ—¶é—´æ’åº
        
        // åˆ†é¡µæŸ¥è¯¢
        Page<Interface> page = new Page<>(pageRequest.getPageNumber() + 1, pageRequest.getPageSize());
        Page<Interface> result = interfaceMapper.selectPage(page, queryWrapper);
        
        // è½¬æ¢ä¸ºVO
        List<InterfaceVO> voList = result.getRecords().stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());
            
        return new PageResult<>(voList, result.getTotal(), result.getCurrent(), result.getSize());
    }
    
    /**
     * æ¥å£ç®¡ç†é¡µé¢æŸ¥è¯¢ - å¯æŸ¥è¯¢æ‰€æœ‰çŠ¶æ€çš„æ¥å£
     */
    public PageResult<InterfaceVO> getInterfacesForManagement(String status, String category, PageRequest pageRequest) {
        QueryWrapper<Interface> queryWrapper = new QueryWrapper<>();
        if (StringUtils.isNotBlank(status)) {
            queryWrapper.eq("status", status);
        }
        if (StringUtils.isNotBlank(category)) {
            queryWrapper.eq("category_code", category);
        }
        queryWrapper.orderByDesc("created_at");
        
        Page<Interface> page = new Page<>(pageRequest.getPageNumber() + 1, pageRequest.getPageSize());
        Page<Interface> result = interfaceMapper.selectPage(page, queryWrapper);
        
        List<InterfaceVO> voList = result.getRecords().stream()
            .map(this::convertToVO)
            .collect(Collectors.toList());
            
        return new PageResult<>(voList, result.getTotal(), result.getCurrent(), result.getSize());
    }
}
```

### 7.2 æ¥å£ç”Ÿæˆè°ƒç”¨é“¾è·¯

#### 7.2.1 å®Œæ•´è°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant F as Vueå‰ç«¯
    participant G as Gatewayç½‘å…³
    participant IS as æ¥å£æœåŠ¡
    participant DS as æ•°æ®æºæœåŠ¡
    participant GS as ç½‘å…³æœåŠ¡
    participant R as Redisç¼“å­˜
    participant DB as MySQLæ•°æ®åº“
    
    Note over F,DB: æ¥å£ç”Ÿæˆå®Œæ•´æµç¨‹
    
    F->>G: POST /api/v1/interfaces/generate
    Note over F: è¯·æ±‚ä½“åŒ…å«ï¼šæ•°æ®åº“è¡¨åã€æ¥å£é…ç½®ã€SQLæ¨¡æ¿ç­‰
    
    G->>G: JWT TokenéªŒè¯
    G->>G: æƒé™æ£€æŸ¥(interface:create)
    G->>IS: è½¬å‘åˆ°æ¥å£æœåŠ¡
    
    IS->>IS: å‚æ•°éªŒè¯å’Œä¸šåŠ¡è§„åˆ™æ£€æŸ¥
    IS->>DB: éªŒè¯æ•°æ®åº“è¡¨ç»“æ„
    DB-->>IS: è¿”å›è¡¨ç»“æ„ä¿¡æ¯
    
    alt æ•°æ®åº“è¡¨ä¸å­˜åœ¨
        IS-->>G: è¿”å›è¡¨ä¸å­˜åœ¨é”™è¯¯
        G-->>F: è¿”å›400é”™è¯¯
    else è¡¨ç»“æ„éªŒè¯é€šè¿‡
        IS->>IS: ç”Ÿæˆæ¥å£ä»£ç å’Œé…ç½®
        IS->>DB: ä¿å­˜æ¥å£ä¿¡æ¯
        Note over IS,DB: INSERT INTO interfaces (name, path, sql_template, status='unpublished', ...)
        
        IS-->>G: è¿”å›ç”Ÿæˆç»“æœ
        G-->>F: è¿”å›æˆåŠŸå“åº”
        
        Note over IS: æ¥å£ç”Ÿæˆå®Œæˆï¼ŒçŠ¶æ€ä¸º"æœªä¸Šæ¶"ï¼Œç­‰å¾…ç»“ç®—éƒ¨è¯„ä¼°ä¸Šæ¶
    end
```

#### 7.2.2 æ¥å£ç”Ÿæˆæ ¸å¿ƒä»£ç 

**å‰ç«¯æ¥å£ç”Ÿæˆç»„ä»¶**ï¼š

```javascript
// InterfaceGenerateDialog.vue
export default {
  data() {
    return {
      currentStep: 1,
      formData: {
        dataSourceId: null,
        interfaceName: '',
        interfacePath: '',
        description: '',
        sqlTemplate: '',
        parameters: []
      }
    }
  },
  
  methods: {
    async submitGenerate() {
      try {
        this.loading = true
        const response = await this.$http.post('/api/v1/interfaces/generate', this.formData)
        
        this.$message.success('æ¥å£ç”ŸæˆæˆåŠŸ')
        this.$emit('generated', response.data.data)
        this.closeDialog()
      } catch (error) {
        this.$message.error(error.response?.data?.message || 'æ¥å£ç”Ÿæˆå¤±è´¥')
      } finally {
        this.loading = false
      }
    }
  }
}
```

**åç«¯æ¥å£ç”ŸæˆæœåŠ¡**ï¼š

```java
@Service
@Transactional
public class InterfaceGenerateService {
    
    @Autowired
    private InterfaceMapper interfaceMapper;
    
    @Autowired
    private DatabaseTableService databaseTableService;
    
    @Autowired
    private GatewayRouteService gatewayRouteService;
    
    public InterfaceVO generateInterface(InterfaceGenerateRequest request) {
        // 1. éªŒè¯æ•°æ®åº“è¡¨ç»“æ„
        if (!validateDatabaseTable(request.getTableName())) {
            throw new BusinessException("æ•°æ®åº“è¡¨ä¸å­˜åœ¨æˆ–æ— è®¿é—®æƒé™");
        }
        
        // 2. éªŒè¯SQLæ¨¡æ¿
        validateSqlTemplate(request.getSqlTemplate());
        
        // 3. ç”Ÿæˆæ¥å£è·¯å¾„
        String interfacePath = generateInterfacePath(request.getInterfaceName());
        
        // 4. åˆ›å»ºæ¥å£è®°å½•
        Interface interfaceEntity = new Interface();
        interfaceEntity.setInterfaceName(request.getInterfaceName());
        interfaceEntity.setInterfacePath(interfacePath);
        interfaceEntity.setDescription(request.getDescription());
        interfaceEntity.setSqlTemplate(request.getSqlTemplate());
        interfaceEntity.setStatus("unpublished"); // ç”ŸæˆåçŠ¶æ€ä¸ºæœªä¸Šæ¶
        interfaceEntity.setCreatedBy(getCurrentUserId());
        interfaceEntity.setCreatedAt(LocalDateTime.now());
        
        interfaceMapper.insert(interfaceEntity);
        
        // 5. ä¿å­˜æ¥å£å‚æ•°
        saveInterfaceParameters(interfaceEntity.getId(), request.getParameters());
        
        return convertToVO(interfaceEntity);
    }
    
    private void validateSqlTemplate(String sqlTemplate) {
        // SQLæ³¨å…¥æ£€æŸ¥
        if (containsDangerousKeywords(sqlTemplate)) {
            throw new BusinessException("SQLæ¨¡æ¿åŒ…å«å±é™©å…³é”®å­—");
        }
        
        // SQLè¯­æ³•æ£€æŸ¥
        try {
            JSqlParser.parse(sqlTemplate);
        } catch (Exception e) {
            throw new BusinessException("SQLæ¨¡æ¿è¯­æ³•é”™è¯¯: " + e.getMessage());
        }
    }
}
```

### 7.3 è®¢é˜…ç”³è¯·å®¡æ‰¹è°ƒç”¨é“¾è·¯

#### 7.3.1 ç”³è¯·æäº¤æµç¨‹

```mermaid
sequenceDiagram
    participant C as æ¶ˆè´¹è€…å‰ç«¯
    participant G as Gatewayç½‘å…³
    participant AS as å®¡æ‰¹æœåŠ¡
    participant US as ç”¨æˆ·æœåŠ¡
    participant R as Redisç¼“å­˜
    participant DB as MySQLæ•°æ®åº“
    
    C->>G: POST /api/v1/applications/subscribe
    G->>G: è®¤è¯å’Œæƒé™æ£€æŸ¥
    G->>AS: è½¬å‘è®¢é˜…ç”³è¯·
    
    AS->>AS: éªŒè¯ç”³è¯·å‚æ•°
    AS->>DB: æ£€æŸ¥é‡å¤ç”³è¯·
    Note over AS,DB: SELECT COUNT(*) FROM subscription_applications<br/>WHERE user_id = ? AND interface_id = ?<br/>AND status IN ('pending', 'approved')
    
    alt å­˜åœ¨é‡å¤ç”³è¯·
        AS-->>G: è¿”å›é‡å¤ç”³è¯·é”™è¯¯
        G-->>C: è¿”å›400é”™è¯¯
    else å¯ä»¥ç”³è¯·
        AS->>DB: ä¿å­˜ç”³è¯·è®°å½•
        Note over AS,DB: INSERT INTO subscription_applications<br/>(user_id, interface_id, reason, status='pending', applied_at)
        
        AS->>R: æ›´æ–°ç”³è¯·ç»Ÿè®¡ç¼“å­˜
        
        AS-->>G: è¿”å›ç”³è¯·æˆåŠŸ
        G-->>C: è¿”å›æˆåŠŸå“åº”
        
        Note over AS: ç”³è¯·æäº¤æˆåŠŸï¼Œç»“ç®—éƒ¨å¯åœ¨å®¡æ‰¹é¡µé¢æŸ¥çœ‹
    end
```

#### 7.3.2 ä¸€çº§å®¡æ‰¹å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant A as å®¡æ‰¹äººå‰ç«¯
    participant G as Gatewayç½‘å…³
    participant AS as å®¡æ‰¹æœåŠ¡
    participant US as ç”¨æˆ·æœåŠ¡
    participant NS as é€šçŸ¥æœåŠ¡
    participant R as Redisç¼“å­˜
    participant DB as MySQLæ•°æ®åº“
    
    A->>G: PUT /api/v1/applications/{id}/approve
    Note over A: ä¸€çº§å®¡æ‰¹ï¼šç‚¹å‡»é€šè¿‡/æ‹’ç»æŒ‰é’®
    G->>AS: è½¬å‘å®¡æ‰¹è¯·æ±‚
    
    AS->>DB: æŸ¥è¯¢ç”³è¯·è¯¦æƒ…
    AS->>AS: éªŒè¯å®¡æ‰¹æƒé™ï¼ˆä»…ç»“ç®—éƒ¨å¯å®¡æ‰¹ï¼‰
    
    alt å®¡æ‰¹é€šè¿‡
        AS->>DB: æ›´æ–°ç”³è¯·çŠ¶æ€ä¸ºapproved
        Note over AS,DB: çŠ¶æ€ç›´æ¥ä»pendingâ†’approved
        AS->>DB: è®°å½•å®¡æ‰¹å†å²
        AS->>US: ç«‹å³æ›´æ–°ç”¨æˆ·æ¥å£æƒé™
        US->>R: æ›´æ–°æƒé™ç¼“å­˜
        AS->>NS: å‘é€é€šè¿‡é€šçŸ¥ç»™ç”³è¯·äºº
        Note over AS: å®¡æ‰¹é€šè¿‡ï¼Œæƒé™ç«‹å³ç”Ÿæ•ˆ
    else å®¡æ‰¹æ‹’ç»
        AS->>DB: æ›´æ–°ç”³è¯·çŠ¶æ€ä¸ºrejected
        Note over AS,DB: çŠ¶æ€ç›´æ¥ä»pendingâ†’rejected
        AS->>DB: è®°å½•æ‹’ç»åŸå› ï¼ˆå¿…å¡«ï¼‰
        AS->>NS: å‘é€æ‹’ç»é€šçŸ¥ç»™ç”³è¯·äºº
        Note over AS: å®¡æ‰¹æ‹’ç»ï¼Œç”¨æˆ·å¯é‡æ–°ç”³è¯·
    end
    
    AS-->>G: è¿”å›å®¡æ‰¹ç»“æœ
    G-->>A: è¿”å›æˆåŠŸå“åº”
    Note over A: ä¸€çº§å®¡æ‰¹å®Œæˆï¼Œæ— éœ€å¤šçº§æµè½¬
```

### 7.4 APIè°ƒç”¨è®¤è¯è°ƒç”¨é“¾è·¯

#### 7.4.1 APIè°ƒç”¨å®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯åº”ç”¨
    participant G as Gatewayç½‘å…³
    participant AF as è®¤è¯è¿‡æ»¤å™¨
    participant IS as æ¥å£æœåŠ¡
    participant DS as æ•°æ®æºæœåŠ¡
    participant AL as å®¡è®¡æ—¥å¿—
    participant R as Redisç¼“å­˜
    participant DB as MySQLæ•°æ®åº“
    
    Client->>G: GET /api/data/{interfaceId}?param1=value1
    Note over Client: Headers: X-API-Key: abc123...
    
    G->>AF: è·¯ç”±åˆ°è®¤è¯è¿‡æ»¤å™¨
    AF->>R: æ£€æŸ¥API Keyç¼“å­˜
    
    alt API Keyç¼“å­˜å­˜åœ¨
        R-->>AF: è¿”å›ç”¨æˆ·æƒé™ä¿¡æ¯
    else ç¼“å­˜ä¸å­˜åœ¨
        AF->>DB: æŸ¥è¯¢API Keyå’Œæƒé™
        Note over AF,DB: SELECT ak.*, u.status, u.id as user_id<br/>FROM api_keys ak<br/>JOIN users u ON ak.user_id = u.id<br/>WHERE ak.api_key = ? AND ak.status = 1
        DB-->>AF: è¿”å›Keyä¿¡æ¯
        AF->>R: ç¼“å­˜æƒé™ä¿¡æ¯(TTL:15åˆ†é’Ÿ)
    end
    
    AF->>AF: éªŒè¯æ¥å£è®¿é—®æƒé™
    alt æƒé™éªŒè¯å¤±è´¥
        AF->>AL: è®°å½•è®¿é—®æ‹’ç»æ—¥å¿—
        AF-->>G: è¿”å›403é”™è¯¯
        G-->>Client: è¿”å›æƒé™é”™è¯¯
    else æƒé™éªŒè¯é€šè¿‡
        AF->>G: ç»§ç»­å¤„ç†è¯·æ±‚
        G->>IS: è½¬å‘åˆ°æ¥å£æœåŠ¡
        
        IS->>DB: æŸ¥è¯¢æ¥å£é…ç½®
        IS->>DS: æ‰§è¡Œæ•°æ®æŸ¥è¯¢
        DS->>DS: æ„å»ºSQLå¹¶æ‰§è¡Œ
        DS-->>IS: è¿”å›æŸ¥è¯¢ç»“æœ
        
        IS->>AL: è®°å½•APIè°ƒç”¨æ—¥å¿—
        IS-->>G: è¿”å›ä¸šåŠ¡æ•°æ®
        G-->>Client: è¿”å›APIç»“æœ
    end
```

#### 7.4.2 è®¤è¯è¿‡æ»¤å™¨å®ç°

```java
@Component
public class ApiKeyAuthenticationFilter implements GlobalFilter, Ordered {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private ApiKeyService apiKeyService;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦API Keyè®¤è¯
        if (!requiresApiKeyAuth(request.getPath().value())) {
            return chain.filter(exchange);
        }
        
        // æå–API Key
        String apiKey = extractApiKey(request);
        if (StringUtils.isEmpty(apiKey)) {
            return handleAuthError(exchange, "Missing API Key");
        }
        
        // éªŒè¯API Key
        return validateApiKey(apiKey)
            .flatMap(userInfo -> {
                // æ£€æŸ¥æ¥å£æƒé™
                String interfaceId = extractInterfaceId(request.getPath().value());
                if (!hasInterfacePermission(userInfo, interfaceId)) {
                    return handleAuthError(exchange, "Insufficient permissions");
                }
                
                // æ·»åŠ ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¤´
                ServerHttpRequest mutatedRequest = request.mutate()
                    .header("X-User-Id", userInfo.getUserId().toString())
                    .header("X-User-Role", userInfo.getRole())
                    .build();
                    
                return chain.filter(exchange.mutate().request(mutatedRequest).build());
            })
            .onErrorResume(throwable -> {
                log.error("API Key validation failed", throwable);
                return handleAuthError(exchange, "Invalid API Key");
            });
    }
    
    private Mono<UserInfo> validateApiKey(String apiKey) {
        // å…ˆæ£€æŸ¥ç¼“å­˜
        String cacheKey = "api_key:" + apiKey;
        UserInfo cachedUserInfo = (UserInfo) redisTemplate.opsForValue().get(cacheKey);
        
        if (cachedUserInfo != null) {
            return Mono.just(cachedUserInfo);
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        return apiKeyService.validateApiKey(apiKey)
            .doOnNext(userInfo -> {
                // ç¼“å­˜ç”¨æˆ·ä¿¡æ¯
                redisTemplate.opsForValue().set(cacheKey, userInfo, Duration.ofMinutes(15));
            });
    }
}
```

## 8. APIæ¥å£æ ‡å‡†åŒ–å®šä¹‰

### 8.1 æ¥å£è®¾è®¡è§„èŒƒ

#### 8.1.1 ç»Ÿä¸€å“åº”æ ¼å¼

**æ ‡å‡†å“åº”ç»“æ„**ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2024-01-15T10:30:00Z",
  "requestId": "uuid-string"
}
```

**å“åº”å­—æ®µè¯´æ˜**ï¼š

* `code`: ä¸šåŠ¡çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ

* `message`: å“åº”æ¶ˆæ¯ï¼ŒæˆåŠŸæ—¶ä¸º"success"

* `data`: ä¸šåŠ¡æ•°æ®ï¼Œå¯ä»¥æ˜¯å¯¹è±¡ã€æ•°ç»„æˆ–åŸºæœ¬ç±»å‹

* `timestamp`: å“åº”æ—¶é—´æˆ³ï¼ŒISO 8601æ ¼å¼

* `requestId`: è¯·æ±‚å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºé“¾è·¯è¿½è¸ª

#### 8.1.2 ç»Ÿä¸€é”™è¯¯ç å®šä¹‰

**ç³»ç»Ÿçº§é”™è¯¯ç ï¼ˆ1000-1999ï¼‰**ï¼š

* 1000: ç³»ç»Ÿå†…éƒ¨é”™è¯¯

* 1001: å‚æ•°æ ¡éªŒå¤±è´¥

* 1002: æ•°æ®æ ¼å¼é”™è¯¯

* 1003: è¯·æ±‚è¶…æ—¶

* 1004: æœåŠ¡ä¸å¯ç”¨

**è®¤è¯æˆæƒé”™è¯¯ç ï¼ˆ2000-2999ï¼‰**ï¼š

* 2000: æœªç™»å½•

* 2001: ç™»å½•å¤±è´¥

* 2002: Tokenæ— æ•ˆ

* 2003: Tokenè¿‡æœŸ

* 2004: æƒé™ä¸è¶³

* 2005: è´¦å·è¢«é”å®š

* 2006: è´¦å·æœªæ¿€æ´»

**ä¸šåŠ¡é€»è¾‘é”™è¯¯ç ï¼ˆ3000-3999ï¼‰**ï¼š

* 3000: ç”¨æˆ·ä¸å­˜åœ¨

* 3001: ç”¨æˆ·å·²å­˜åœ¨

* 3002: å¯†ç é”™è¯¯

* 3003: éªŒè¯ç é”™è¯¯

* 3004: æ“ä½œé¢‘ç¹

**æ¥å£ç®¡ç†é”™è¯¯ç ï¼ˆ4000-4999ï¼‰**ï¼š

* 4000: æ¥å£ä¸å­˜åœ¨

* 4001: æ¥å£åç§°é‡å¤

* 4002: æ¥å£è·¯å¾„å†²çª

* 4003: æ•°æ®æºè¿æ¥å¤±è´¥

* 4004: è¡¨ç»“æ„è·å–å¤±è´¥

* 4005: æ¥å£ç”Ÿæˆå¤±è´¥

* 4006: æ¥å£çŠ¶æ€ä¸å…è®¸æ“ä½œ

**è®¢é˜…å®¡æ‰¹é”™è¯¯ç ï¼ˆ5000-5999ï¼‰**ï¼š

* 5000: ç”³è¯·ä¸å­˜åœ¨

* 5001: é‡å¤ç”³è¯·

* 5002: ç”³è¯·å·²å¤„ç†

* 5003: å®¡æ‰¹æƒé™ä¸è¶³

* 5004: ç”³è¯·ç†ç”±ä¸ºç©º

#### 8.1.3 å‚æ•°æ ¡éªŒè§„èŒƒ

**é€šç”¨æ ¡éªŒè§„åˆ™**ï¼š

* å¿…å¡«å‚æ•°ä¸èƒ½ä¸ºç©º

* å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶

* æ•°å­—èŒƒå›´é™åˆ¶

* æ—¥æœŸæ ¼å¼æ ¡éªŒ

* é‚®ç®±æ ¼å¼æ ¡éªŒ

* æ‰‹æœºå·æ ¼å¼æ ¡éªŒ

**æ ¡éªŒå¤±è´¥å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 1001,
  "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
  "data": {
    "errors": [
      {
        "field": "username",
        "message": "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-50ä¸ªå­—ç¬¦ä¹‹é—´"
      },
      {
        "field": "email",
        "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
      }
    ]
  },
  "timestamp": "2024-01-15T10:30:00Z",
  "requestId": "req-12345"
}
```

### 8.2 ç”¨æˆ·è®¤è¯ç›¸å…³API

#### 8.2.1 ç”¨æˆ·ç™»å½•

```
POST /api/v1/auth/login
```

**åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·è´¦å·å¯†ç ç™»å½•

**è¯·æ±‚å¤´**ï¼š

```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å      | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | é•¿åº¦é™åˆ¶  | æè¿°             | æ ¡éªŒè§„åˆ™     |
| -------- | ------ | ---- | ----- | -------------- | -------- |
| username | string | æ˜¯    | 2-100 | ç”¨æˆ·åï¼ˆæ‰‹æœºå·æˆ–é‚®ç®±ï¼‰    | æ‰‹æœºå·æˆ–é‚®ç®±æ ¼å¼ |
| password | string | æ˜¯    | 8-20  | å¯†ç              | éç©ºå­—ç¬¦ä¸²    |
| captcha  | string | å¦    | 4     | éªŒè¯ç ï¼ˆè¿ç»­å¤±è´¥3æ¬¡åå¿…éœ€ï¼‰ | 4ä½æ•°å­—     |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "username": "13800138000",
  "password": "Password123!",
  "captcha": "1234"
}
```

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å                       | å‚æ•°ç±»å‹    | æè¿°      |
| ------------------------- | ------- | ------- |
| code                      | integer | å“åº”ç      |
| message                   | string  | å“åº”æ¶ˆæ¯    |
| data                      | object  | å“åº”æ•°æ®    |
| data.token                | string  | JWTè®¿é—®ä»¤ç‰Œ |
| data.userInfo             | object  | ç”¨æˆ·ä¿¡æ¯    |
| data.userInfo.id          | integer | ç”¨æˆ·ID    |
| data.userInfo.username    | string  | ç”¨æˆ·å     |
| data.userInfo.realName    | string  | çœŸå®å§“å    |
| data.userInfo.role        | string  | ç”¨æˆ·è§’è‰²    |
| data.userInfo.permissions | array   | æƒé™åˆ—è¡¨    |

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh_token_string",
    "expiresIn": 86400,
    "userInfo": {
      "id": 1001,
      "username": "zhangsan",
      "realName": "å¼ ä¸‰",
      "email": "zhangsan@example.com",
      "phone": "13800138000",
      "department": "æŠ€æœ¯éƒ¨",
      "position": "é«˜çº§å·¥ç¨‹å¸ˆ",
      "role": "tech",
      "roleCode": "TECH",
      "permissions": [
        "interface:read",
        "interface:create",
        "interface:update",
        "interface:test"
      ],
      "appId": "app_1001_20240115",
      "status": 1,
      "lastLoginTime": "2024-01-15T10:30:00Z"
    }
  },
  "timestamp": "2024-01-15T10:30:00Z",
  "requestId": "req-login-12345"
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 2001,
  "message": "ç™»å½•å¤±è´¥",
  "data": {
    "reason": "å¯†ç é”™è¯¯",
    "remainingAttempts": 2,
    "lockTime": null
  },
  "timestamp": "2024-01-15T10:30:00Z",
  "requestId": "req-login-12345"
}
```

**ä¸šåŠ¡è§„åˆ™**ï¼š

* è¿ç»­5æ¬¡å¯†ç é”™è¯¯é”å®šè´¦å·30åˆ†é’Ÿ

* è¿ç»­3æ¬¡å¤±è´¥åéœ€è¦è¾“å…¥éªŒè¯ç 

* Tokenæœ‰æ•ˆæœŸ24å°æ—¶

* åªæœ‰"å·²å®¡æ ¸"çŠ¶æ€ç”¨æˆ·å¯ç™»å½•

* åŒä¸€è´¦å·åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆToken

**é”™è¯¯ç è¯´æ˜**ï¼š

* 2001: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

* 2005: è´¦å·è¢«é”å®š

* 2006: è´¦å·æœªæ¿€æ´»

* 3003: éªŒè¯ç é”™è¯¯

* 1001: å‚æ•°æ ¡éªŒå¤±è´¥

#### 8.1.2 ç”¨æˆ·ç™»å‡º

```
POST /api/v1/auth/logout
```

**è¯·æ±‚å¤´**ï¼š

| å‚æ•°å           | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°             |
| ------------- | ------ | ---- | -------------- |
| Authorization | string | æ˜¯    | Bearer {token} |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ",
  "data": null,
  "timestamp": "2024-01-15T10:35:00Z"
}
```

### 8.2 æ¥å£ç®¡ç†ç›¸å…³API

#### 8.2.1 è·å–æ¥å£åˆ—è¡¨

```
GET /api/v1/interfaces
```

**æŸ¥è¯¢å‚æ•°**ï¼š

| å‚æ•°å      | å‚æ•°ç±»å‹    | æ˜¯å¦å¿…å¡« | æè¿°                                              |
| -------- | ------- | ---- | ----------------------------------------------- |
| category | string  | å¦    | æ¥å£åˆ†ç±»                                            |
| status   | string  | å¦    | æ¥å£çŠ¶æ€(unpublished:æœªä¸Šæ¶/published:å·²ä¸Šæ¶/offline:å·²ä¸‹æ¶) |
| keyword  | string  | å¦    | æœç´¢å…³é”®è¯                                           |
| page     | integer | å¦    | é¡µç ï¼Œé»˜è®¤1                                          |
| size     | integer | å¦    | æ¯é¡µå¤§å°ï¼Œé»˜è®¤20                                       |

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å          | å‚æ•°ç±»å‹    | æè¿°   |
| ------------ | ------- | ---- |
| code         | integer | å“åº”ç   |
| message      | string  | å“åº”æ¶ˆæ¯ |
| data         | object  | åˆ†é¡µæ•°æ® |
| data.records | array   | æ¥å£åˆ—è¡¨ |
| data.total   | integer | æ€»è®°å½•æ•° |
| data.current | integer | å½“å‰é¡µç  |
| data.size    | integer | æ¯é¡µå¤§å° |

#### 8.2.2 ç”Ÿæˆæ¥å£

```
POST /api/v1/interfaces/generate
```

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å           | å‚æ•°ç±»å‹    | æ˜¯å¦å¿…å¡« | æè¿°      |
| ------------- | ------- | ---- | ------- |
| dataSourceId  | integer | æ˜¯    | æ•°æ®æºID   |
| interfaceName | string  | æ˜¯    | æ¥å£åç§°    |
| interfacePath | string  | æ˜¯    | æ¥å£è·¯å¾„    |
| description   | string  | å¦    | æ¥å£æè¿°    |
| sqlTemplate   | string  | æ˜¯    | SQLæŸ¥è¯¢æ¨¡æ¿ |
| parameters    | array   | å¦    | å‚æ•°å®šä¹‰    |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "dataSourceId": 1,
  "interfaceName": "ç”µåŠ›è´Ÿè·æ•°æ®æŸ¥è¯¢",
  "interfacePath": "/power/load",
  "description": "æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´çš„ç”µåŠ›è´Ÿè·æ•°æ®",
  "sqlTemplate": "SELECT * FROM power_load WHERE date_time BETWEEN #{startTime} AND #{endTime}",
  "parameters": [
    {
      "paramName": "startTime",
      "paramType": "datetime",
      "isRequired": true,
      "description": "å¼€å§‹æ—¶é—´"
    },
    {
      "paramName": "endTime",
      "paramType": "datetime",
      "isRequired": true,
      "description": "ç»“æŸæ—¶é—´"
    }
  ]
}
```

#### 8.2.3 æ‰¹é‡æ¥å£æ“ä½œ

```
POST /api/v1/interfaces/batch-operation
```

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å          | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°                           |
| ------------ | ------ | ---- | ---------------------------- |
| interfaceIds | array  | æ˜¯    | æ¥å£IDåˆ—è¡¨                       |
| operation    | string | æ˜¯    | æ“ä½œç±»å‹(publish/offline/reject) |
| reason       | string | å¦    | æ“ä½œåŸå›                          |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "interfaceIds": [1, 2, 3, 4, 5],
  "operation": "publish",
  "reason": "æ‰¹é‡ä¸Šæ¶ç”µåŠ›äº¤æ˜“ç›¸å…³æ¥å£"
}
```

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å        | å‚æ•°ç±»å‹    | æè¿°                     |
| ---------- | ------- | ---------------------- |
| taskId     | string  | æ‰¹é‡æ“ä½œä»»åŠ¡ID               |
| totalCount | integer | æ€»æ“ä½œæ•°é‡                  |
| status     | string  | ä»»åŠ¡çŠ¶æ€(completed/failed) |

#### 8.2.4 æ‰¹é‡æ“ä½œçŠ¶æ€æŸ¥è¯¢

```
GET /api/v1/interfaces/batch-operation/{taskId}
```

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å    | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°   |
| ------ | ------ | ---- | ---- |
| taskId | string | æ˜¯    | ä»»åŠ¡ID |

**å“åº”å‚æ•°**ï¼š

| å‚æ•°å      | å‚æ•°ç±»å‹   | æè¿°                             |
| -------- | ------ | ------------------------------ |
| taskId   | string | ä»»åŠ¡ID                           |
| status   | string | ä»»åŠ¡çŠ¶æ€(running/completed/failed) |
| progress | object | è¿›åº¦ä¿¡æ¯                           |
| results  | array  | æ“ä½œç»“æœåˆ—è¡¨                         |

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "taskId": "batch_20240115_001",
    "status": "completed",
    "progress": {
      "total": 5,
      "success": 4,
      "failed": 1,
      "percentage": 100
    },
    "results": [
      {
        "interfaceId": 1,
        "status": "success",
        "message": "æ¥å£ä¸Šæ¶æˆåŠŸ"
      },
      {
        "interfaceId": 2,
        "status": "failed",
        "message": "æ¥å£çŠ¶æ€ä¸ç¬¦åˆä¸Šæ¶æ¡ä»¶"
      }
    ]
  }
}
```

**è¯´æ˜**ï¼šæ‰¹é‡æ“ä½œé‡‡ç”¨åŒæ­¥å¤„ç†æ–¹å¼ï¼Œç›´æ¥è¿”å›æ‰€æœ‰æ“ä½œç»“æœï¼Œæ— éœ€å¼‚æ­¥æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ã€‚

#### 8.2.5 é‡è¯•å¤±è´¥çš„æ‰¹é‡æ“ä½œ

```
POST /api/v1/interfaces/batch-operation/{taskId}/retry
```

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å    | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°   |
| ------ | ------ | ---- | ---- |
| taskId | string | æ˜¯    | ä»»åŠ¡ID |

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å          | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…å¡« | æè¿°        |
| ------------ | ----- | ---- | --------- |
| interfaceIds | array | å¦    | æŒ‡å®šé‡è¯•çš„æ¥å£ID |

#### 8.2.6 æ¥å£çŠ¶æ€å˜æ›´

```
PUT /api/v1/interfaces/{id}/status
```

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å | å‚æ•°ç±»å‹    | æ˜¯å¦å¿…å¡« | æè¿°   |
| --- | ------- | ---- | ---- |
| id  | integer | æ˜¯    | æ¥å£ID |

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å    | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°                                              |
| ------ | ------ | ---- | ----------------------------------------------- |
| status | string | æ˜¯    | æ¥å£çŠ¶æ€(unpublished:æœªä¸Šæ¶/published:å·²ä¸Šæ¶/offline:å·²ä¸‹æ¶) |
| reason | string | å¦    | çŠ¶æ€å˜æ›´åŸå›                                           |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "status": "published",
  "reason": "æ¥å£è¯„ä¼°é€šè¿‡ï¼Œæ­£å¼ä¸Šæ¶"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "æ¥å£çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "interfaceId": 1001,
    "oldStatus": "unpublished",
    "newStatus": "published",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

### 8.3 è®¢é˜…ç”³è¯·ç›¸å…³API

#### 8.3.1 æäº¤è®¢é˜…ç”³è¯·

```
POST /api/v1/applications/subscribe
```

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å               | å‚æ•°ç±»å‹    | æ˜¯å¦å¿…å¡« | æè¿°   |
| ----------------- | ------- | ---- | ---- |
| interfaceId       | integer | æ˜¯    | æ¥å£ID |
| applicationReason | string  | æ˜¯    | ç”³è¯·ç†ç”± |
| businessScenario  | string  | æ˜¯    | ä¸šåŠ¡åœºæ™¯ |

#### 8.3.2 ä¸€çº§å®¡æ‰¹ç”³è¯·

```
PUT /api/v1/applications/{id}/approve
```

**åŠŸèƒ½æè¿°**ï¼šä¸€çº§å®¡æ‰¹å¤„ç†è®¢é˜…ç”³è¯·ï¼Œæ”¯æŒé€šè¿‡æˆ–æ‹’ç»æ“ä½œ

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å | å‚æ•°ç±»å‹    | æ˜¯å¦å¿…å¡« | æè¿°   |
| --- | ------- | ---- | ---- |
| id  | integer | æ˜¯    | ç”³è¯·ID |

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å     | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°                   | æ ¡éªŒè§„åˆ™    |
| ------- | ------ | ---- | -------------------- | ------- |
| action  | string | æ˜¯    | å®¡æ‰¹åŠ¨ä½œ(approve/reject) | æšä¸¾å€¼é™åˆ¶   |
| comment | string | å¦    | å®¡æ‰¹æ„è§ï¼ˆæ‹’ç»æ—¶å»ºè®®å¡«å†™ï¼‰        | æœ€å¤§500å­—ç¬¦ |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "action": "approve",
  "comment": "ç”³è¯·ç†ç”±å……åˆ†ï¼Œä¸šåŠ¡åœºæ™¯æ˜ç¡®ï¼ŒåŒæ„è®¢é˜…"
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**ï¼š

```json
{
  "code": 200,
  "message": "å®¡æ‰¹æˆåŠŸ",
  "data": {
    "applicationId": 12345,
    "status": "approved",
    "approvedAt": "2024-01-15T10:30:00Z",
    "approvedBy": 1001,
    "comment": "ç”³è¯·ç†ç”±å……åˆ†ï¼Œä¸šåŠ¡åœºæ™¯æ˜ç¡®ï¼ŒåŒæ„è®¢é˜…"
  },
  "timestamp": "2024-01-15T10:30:00Z",
  "requestId": "req-approve-12345"
}
```

**ä¸šåŠ¡è§„åˆ™**ï¼š

* åªæœ‰ç»“ç®—éƒ¨è§’è‰²ç”¨æˆ·å¯ä»¥æ‰§è¡Œå®¡æ‰¹æ“ä½œ

* ç”³è¯·çŠ¶æ€å¿…é¡»ä¸ºpendingæ‰èƒ½å®¡æ‰¹

* å®¡æ‰¹åçŠ¶æ€ç«‹å³ç”Ÿæ•ˆï¼šapprovedï¼ˆé€šè¿‡ï¼‰æˆ–rejectedï¼ˆæ‹’ç»ï¼‰

* å®¡æ‰¹é€šè¿‡åè‡ªåŠ¨ä¸ºç”¨æˆ·å¼€é€šæ¥å£è®¿é—®æƒé™

* å®¡æ‰¹ç»“æœä¼šå‘é€é€šçŸ¥ç»™ç”³è¯·ç”¨æˆ·

* æ‹’ç»ç”³è¯·æ—¶å»ºè®®å¡«å†™å®¡æ‰¹æ„è§

**é”™è¯¯ç è¯´æ˜**ï¼š

* 5000: ç”³è¯·ä¸å­˜åœ¨

* 5002: ç”³è¯·å·²å¤„ç†

* 5003: å®¡æ‰¹æƒé™ä¸è¶³

* 2004: æƒé™ä¸è¶³

### 8.4 æ•°æ®æ¥å£è°ƒç”¨API

**è¯´æ˜**ï¼šç³»ç»Ÿä¸å†æä¾›é€šçŸ¥ç®¡ç†åŠŸèƒ½ï¼Œæ¥å£çŠ¶æ€å˜æ›´é€šè¿‡é¡µé¢å®æ—¶å±•ç¤ºï¼Œæ— éœ€ç³»ç»Ÿé€šçŸ¥ã€‚

#### 8.4.1 é€šç”¨æ•°æ®æ¥å£

```
GET /api/data/{interfaceId}
```

**è¯·æ±‚å¤´**ï¼š

| å‚æ•°å       | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°      |
| --------- | ------ | ---- | ------- |
| X-API-Key | string | æ˜¯    | APIè®¿é—®å¯†é’¥ |

**è·¯å¾„å‚æ•°**ï¼š

| å‚æ•°å         | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…å¡« | æè¿°   |
| ----------- | ------ | ---- | ---- |
| interfaceId | string | æ˜¯    | æ¥å£æ ‡è¯† |

**æŸ¥è¯¢å‚æ•°**ï¼šæ ¹æ®å…·ä½“æ¥å£å®šä¹‰çš„å‚æ•°

**å“åº”æ ¼å¼**ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "records": [...],
    "total": 100,
    "page": 1,
    "size": 20
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## 9. æ•°æ®åº“è®¾è®¡ç»†åŒ–

### 9.1 æ•°æ®åº“æ¶æ„è®¾è®¡

#### 9.1.1 æ•°æ®åº“åˆ†å±‚æ¶æ„

**ä¸»ä»å¤åˆ¶æ¶æ„**ï¼š

```
ä¸»åº“ï¼ˆMasterï¼‰ï¼š
- å¤„ç†æ‰€æœ‰å†™æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰
- å®æ—¶æ•°æ®ä¸€è‡´æ€§ä¿è¯
- äº‹åŠ¡å®Œæ•´æ€§æ§åˆ¶

ä»åº“ï¼ˆSlaveï¼‰ï¼š
- å¤„ç†æ‰€æœ‰è¯»æ“ä½œï¼ˆSELECTï¼‰
- æ•°æ®å»¶è¿Ÿï¼š< 100ms
- è¯»å†™åˆ†ç¦»è´Ÿè½½å‡è¡¡

å¤‡ä»½ç­–ç•¥ï¼š
- å…¨é‡å¤‡ä»½ï¼šæ¯æ—¥å‡Œæ™¨2ç‚¹
- å¢é‡å¤‡ä»½ï¼šæ¯4å°æ—¶ä¸€æ¬¡
- binlogä¿ç•™ï¼š7å¤©
- å¤‡ä»½éªŒè¯ï¼šæ¯å‘¨ä¸€æ¬¡æ¢å¤æµ‹è¯•
```

**æ•°æ®åº“è¿æ¥æ± é…ç½®**ï¼š

```yaml
# HikariCPè¿æ¥æ± é…ç½®
hikari:
  maximum-pool-size: 20          # æœ€å¤§è¿æ¥æ•°
  minimum-idle: 5                # æœ€å°ç©ºé—²è¿æ¥æ•°
  connection-timeout: 30000      # è¿æ¥è¶…æ—¶æ—¶é—´(ms)
  idle-timeout: 600000           # ç©ºé—²è¶…æ—¶æ—¶é—´(ms)
  max-lifetime: 1800000          # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ(ms)
  leak-detection-threshold: 60000 # è¿æ¥æ³„æ¼æ£€æµ‹é˜ˆå€¼(ms)
```

#### 9.1.2 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

**æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥**ï¼š

```sql
-- 1. ç´¢å¼•ä¼˜åŒ–åŸåˆ™
-- ä¸»é”®ç´¢å¼•ï¼šæ¯ä¸ªè¡¨å¿…é¡»æœ‰ä¸»é”®
-- å”¯ä¸€ç´¢å¼•ï¼šå”¯ä¸€æ€§çº¦æŸå­—æ®µ
-- å¤åˆç´¢å¼•ï¼šå¤šå­—æ®µæŸ¥è¯¢æ¡ä»¶
-- è¦†ç›–ç´¢å¼•ï¼šå‡å°‘å›è¡¨æŸ¥è¯¢

-- 2. åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
-- é¿å…ä½¿ç”¨OFFSETå¤§åç§»é‡
-- ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆåŸºäºIDï¼‰
SELECT * FROM interfaces 
WHERE id > ? 
ORDER BY id ASC 
LIMIT 20;

-- 3. ç»Ÿè®¡æŸ¥è¯¢ä¼˜åŒ–
-- ä½¿ç”¨é¢„è®¡ç®—ç»Ÿè®¡è¡¨
-- å®šæ—¶æ›´æ–°ç»Ÿè®¡æ•°æ®
CREATE TABLE interface_statistics (
    date DATE PRIMARY KEY,
    total_interfaces INT,
    published_interfaces INT,
    total_calls BIGINT,
    avg_response_time DECIMAL(10,2)
);
```

**ç¼“å­˜ç­–ç•¥è®¾è®¡**ï¼š

```
ä¸€çº§ç¼“å­˜ï¼ˆåº”ç”¨å±‚ï¼‰ï¼š
- æ¥å£é…ç½®ä¿¡æ¯ï¼š30åˆ†é’Ÿ
- ç”¨æˆ·æƒé™ä¿¡æ¯ï¼š15åˆ†é’Ÿ
- åˆ†ç±»æ ‡ç­¾æ•°æ®ï¼š60åˆ†é’Ÿ

äºŒçº§ç¼“å­˜ï¼ˆRedisï¼‰ï¼š
- çƒ­ç‚¹æ¥å£æ•°æ®ï¼š2å°æ—¶
- ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼š24å°æ—¶
- ç»Ÿè®¡æ±‡æ€»æ•°æ®ï¼š6å°æ—¶

ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼š
- å†™å…¥æ—¶æ›´æ–°ï¼ˆWrite-Throughï¼‰
- å»¶è¿ŸåŒåˆ ï¼ˆDelayed Double Deleteï¼‰
- ç¼“å­˜é¢„çƒ­ï¼ˆCache Warmingï¼‰
```

### 9.2 æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡

#### 9.2.1 ç”¨æˆ·ç®¡ç†è¡¨è®¾è®¡

**usersè¡¨ï¼ˆç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼‰**ï¼š

```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT 'é‚®ç®±åœ°å€',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œå€¼',
    salt VARCHAR(32) NOT NULL COMMENT 'å¯†ç ç›å€¼',
    real_name VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·ç ',
    department VARCHAR(100) COMMENT 'æ‰€å±éƒ¨é—¨',
    position VARCHAR(100) COMMENT 'èŒä½ä¿¡æ¯',
    avatar_url VARCHAR(255) COMMENT 'å¤´åƒURL',
    last_login_at DATETIME COMMENT 'æœ€åç™»å½•æ—¶é—´',
    last_login_ip VARCHAR(45) COMMENT 'æœ€åç™»å½•IP',
    login_count INT DEFAULT 0 COMMENT 'ç™»å½•æ¬¡æ•°',
    status TINYINT DEFAULT 1 COMMENT 'ç”¨æˆ·çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨,2:é”å®š)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    
    -- ç´¢å¼•è®¾è®¡
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_phone (phone),
    INDEX idx_department (department),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_last_login (last_login_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨';
```

**å­—æ®µçº¦æŸè¯´æ˜**ï¼š

```
ä¸šåŠ¡çº¦æŸï¼š
- username: 3-50å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼Œä¸èƒ½çº¯æ•°å­—
- email: æ ‡å‡†é‚®ç®±æ ¼å¼ï¼Œå¿…é¡»å”¯ä¸€
- password_hash: BCryptåŠ å¯†ï¼Œå¼ºåº¦12
- real_name: 2-50å­—ç¬¦ï¼Œä¸­è‹±æ–‡å‡å¯
- phone: 11ä½æ‰‹æœºå·æˆ–å›ºè¯æ ¼å¼
- department: é¢„å®šä¹‰éƒ¨é—¨åˆ—è¡¨éªŒè¯

æ•°æ®å®Œæ•´æ€§ï¼š
- ç”¨æˆ·åå’Œé‚®ç®±å…¨å±€å”¯ä¸€
- å¯†ç å“ˆå¸Œå€¼ä¸èƒ½ä¸ºç©º
- çŠ¶æ€å€¼é™åˆ¶ï¼š0,1,2
- åˆ›å»ºæ—¶é—´è‡ªåŠ¨è®¾ç½®
```

**user\_rolesè¡¨ï¼ˆç”¨æˆ·è§’è‰²å…³è”ï¼‰**ï¼š

```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role_code VARCHAR(50) NOT NULL COMMENT 'è§’è‰²ä»£ç ',
    granted_by BIGINT COMMENT 'æˆæƒäººID',
    granted_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æˆæƒæ—¶é—´',
    expires_at DATETIME COMMENT 'è¿‡æœŸæ—¶é—´',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE KEY uk_user_role (user_id, role_code),
    INDEX idx_role_code (role_code),
    INDEX idx_granted_at (granted_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### 9.2.2 æ¥å£ç®¡ç†è¡¨è®¾è®¡

**interfacesè¡¨ï¼ˆæ¥å£åŸºç¡€ä¿¡æ¯ï¼‰**ï¼š

```sql
CREATE TABLE interfaces (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¥å£ID',
    name VARCHAR(100) NOT NULL COMMENT 'æ¥å£åç§°',
    description TEXT COMMENT 'æ¥å£æè¿°',
    path VARCHAR(200) NOT NULL UNIQUE COMMENT 'æ¥å£è·¯å¾„',
    method VARCHAR(10) DEFAULT 'GET' COMMENT 'HTTPæ–¹æ³•',
    category_id INT COMMENT 'åˆ†ç±»ID',
    data_source VARCHAR(100) NOT NULL COMMENT 'æ•°æ®æºæ ‡è¯†',
    table_name VARCHAR(100) NOT NULL COMMENT 'æ•°æ®è¡¨å',
    sql_template TEXT NOT NULL COMMENT 'SQLæ¨¡æ¿',
    response_format JSON COMMENT 'å“åº”æ ¼å¼å®šä¹‰',
    parameters JSON COMMENT 'å‚æ•°å®šä¹‰',
    rate_limit INT DEFAULT 1000 COMMENT 'é¢‘ç‡é™åˆ¶(æ¬¡/å°æ—¶)',
    timeout_seconds INT DEFAULT 30 COMMENT 'è¶…æ—¶æ—¶é—´(ç§’)',
    cache_ttl INT DEFAULT 300 COMMENT 'ç¼“å­˜æ—¶é—´(ç§’)',
    status VARCHAR(20) DEFAULT 'unpublished' COMMENT 'çŠ¶æ€(unpublished,published,offline)',
    version VARCHAR(10) DEFAULT '1.0' COMMENT 'ç‰ˆæœ¬å·',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    published_by BIGINT COMMENT 'å‘å¸ƒäººID',
    call_count BIGINT DEFAULT 0 COMMENT 'è°ƒç”¨æ¬¡æ•°',
    last_called_at DATETIME COMMENT 'æœ€åè°ƒç”¨æ—¶é—´',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    published_at DATETIME COMMENT 'å‘å¸ƒæ—¶é—´',
    
    FOREIGN KEY (created_by) REFERENCES users(id),
    FOREIGN KEY (published_by) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES interface_categories(id),
    
    -- å¤åˆç´¢å¼•ä¼˜åŒ–
    INDEX idx_status_category (status, category_id),
    INDEX idx_created_by_status (created_by, status),
    INDEX idx_published_at (published_at DESC),
    INDEX idx_call_count (call_count DESC),
    INDEX idx_data_source_table (data_source, table_name),
    
    -- å•å­—æ®µç´¢å¼•
    INDEX idx_name (name),
    INDEX idx_path (path),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¥å£åŸºç¡€ä¿¡æ¯è¡¨';
```

**interface\_parametersè¡¨ï¼ˆæ¥å£å‚æ•°å®šä¹‰ï¼‰**ï¼š

```sql
CREATE TABLE interface_parameters (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å‚æ•°ID',
    interface_id BIGINT NOT NULL COMMENT 'æ¥å£ID',
    param_name VARCHAR(50) NOT NULL COMMENT 'å‚æ•°åç§°',
    param_type VARCHAR(20) NOT NULL COMMENT 'å‚æ•°ç±»å‹',
    is_required TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å¿…éœ€(0:å¦,1:æ˜¯)',
    default_value VARCHAR(255) COMMENT 'é»˜è®¤å€¼',
    description TEXT COMMENT 'å‚æ•°æè¿°',
    validation_rule JSON COMMENT 'éªŒè¯è§„åˆ™',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    
    FOREIGN KEY (interface_id) REFERENCES interfaces(id) ON DELETE CASCADE,
    UNIQUE KEY uk_interface_param (interface_id, param_name),
    INDEX idx_interface_id (interface_id),
    INDEX idx_param_type (param_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¥å£å‚æ•°å®šä¹‰è¡¨';
```

**validation\_ruleå­—æ®µJSONç»“æ„**ï¼š

```json
{
  "type": "string",           // æ•°æ®ç±»å‹
  "minLength": 1,             // æœ€å°é•¿åº¦
  "maxLength": 50,            // æœ€å¤§é•¿åº¦
  "pattern": "^[a-zA-Z0-9]+$", // æ­£åˆ™è¡¨è¾¾å¼
  "enum": ["value1", "value2"], // æšä¸¾å€¼
  "min": 0,                   // æœ€å°å€¼ï¼ˆæ•°å­—ç±»å‹ï¼‰
  "max": 100,                 // æœ€å¤§å€¼ï¼ˆæ•°å­—ç±»å‹ï¼‰
  "format": "date"            // æ ¼å¼ç±»å‹
}
```

#### 9.2.3 è®¢é˜…å®¡æ‰¹è¡¨è®¾è®¡

**subscription\_applicationsè¡¨ï¼ˆè®¢é˜…ç”³è¯·ï¼‰**ï¼š

```sql
CREATE TABLE subscription_applications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”³è¯·ID',
    user_id BIGINT NOT NULL COMMENT 'ç”³è¯·ç”¨æˆ·ID',
    interface_id BIGINT NOT NULL COMMENT 'æ¥å£ID',
    application_reason TEXT NOT NULL COMMENT 'ç”³è¯·ç†ç”±',
    business_scenario TEXT COMMENT 'ä¸šåŠ¡åœºæ™¯æè¿°',
    expected_calls_per_day INT COMMENT 'é¢„è®¡æ¯æ—¥è°ƒç”¨é‡',
    contact_info JSON COMMENT 'è”ç³»æ–¹å¼',
    status VARCHAR(20) DEFAULT 'pending' COMMENT 'ç”³è¯·çŠ¶æ€',
    priority TINYINT DEFAULT 2 COMMENT 'ä¼˜å…ˆçº§(1:é«˜,2:ä¸­,3:ä½)',
    applied_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ç”³è¯·æ—¶é—´',
    approved_at DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    approved_by BIGINT COMMENT 'å®¡æ‰¹äººID',
    approval_comment TEXT COMMENT 'å®¡æ‰¹æ„è§',
    rejected_reason TEXT COMMENT 'æ‹’ç»åŸå› ',
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (interface_id) REFERENCES interfaces(id),
    FOREIGN KEY (approved_by) REFERENCES users(id),
    
    -- é˜²é‡å¤ç”³è¯·
    UNIQUE KEY uk_user_interface_pending (user_id, interface_id, status),
    
    INDEX idx_user_id (user_id),
    INDEX idx_interface_id (interface_id),
    INDEX idx_status (status),
    INDEX idx_applied_at (applied_at DESC),
    INDEX idx_approved_by (approved_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢é˜…ç”³è¯·è¡¨';
```

**approval\_historyè¡¨ï¼ˆå®¡æ‰¹å†å²ï¼‰**ï¼š

```sql
CREATE TABLE approval_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å†å²ID',
    application_id BIGINT NOT NULL COMMENT 'ç”³è¯·ID',
    approver_id BIGINT NOT NULL COMMENT 'å®¡æ‰¹äººID',
    action VARCHAR(20) NOT NULL COMMENT 'æ“ä½œåŠ¨ä½œ',
    comment TEXT COMMENT 'å®¡æ‰¹æ„è§',
    previous_status VARCHAR(20) COMMENT 'å˜æ›´å‰çŠ¶æ€',
    new_status VARCHAR(20) COMMENT 'å˜æ›´åçŠ¶æ€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',
    
    FOREIGN KEY (application_id) REFERENCES subscription_applications(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    
    INDEX idx_application_id (application_id),
    INDEX idx_approver_id (approver_id),
    INDEX idx_created_at (created_at DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¡æ‰¹å†å²è®°å½•è¡¨';
```

### 9.3 ç´¢å¼•è®¾è®¡ç­–ç•¥

#### 9.3.1 ç´¢å¼•è®¾è®¡åŸåˆ™

**ä¸»é”®ç´¢å¼•è®¾è®¡**ï¼š

```sql
-- æ‰€æœ‰è¡¨ä½¿ç”¨BIGINTè‡ªå¢ä¸»é”®
-- ä¼˜åŠ¿ï¼š
-- 1. æ’å…¥æ€§èƒ½å¥½ï¼ˆé¡ºåºæ’å…¥ï¼‰
-- 2. å­˜å‚¨ç©ºé—´å°
-- 3. æ”¯æŒå¤§æ•°æ®é‡
-- 4. ä¾¿äºåˆ†åº“åˆ†è¡¨

ALTER TABLE interfaces AUTO_INCREMENT = 1000000; -- è®¾ç½®èµ·å§‹å€¼
```

**å¤åˆç´¢å¼•è®¾è®¡**ï¼š

```sql
-- 1. æŸ¥è¯¢é¢‘ç‡é«˜çš„å­—æ®µç»„åˆ
CREATE INDEX idx_status_category_published ON interfaces (status, category_id, published_at DESC);

-- 2. è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_user_interface_status ON subscription_applications (user_id, interface_id, status, applied_at);

-- 3. å‰ç¼€ç´¢å¼•ä¼˜åŒ–é•¿å­—æ®µ
CREATE INDEX idx_name_prefix ON interfaces (name(20));

-- 4. å‡½æ•°ç´¢å¼•ï¼ˆMySQL 8.0+ï¼‰
CREATE INDEX idx_created_date ON interfaces ((DATE(created_at)));
```

**ç´¢å¼•ç›‘æ§å’Œä¼˜åŒ–**ï¼š

```sql
-- 1. æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    SUB_PART,
    NULLABLE
FROM information_schema.STATISTICS 
WHERE TABLE_SCHEMA = 'power_trading'
ORDER BY TABLE_NAME, SEQ_IN_INDEX;

-- 2. åˆ†ææ…¢æŸ¥è¯¢
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log 
WHERE start_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY query_time DESC
LIMIT 10;

-- 3. æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    s.TABLE_SCHEMA,
    s.TABLE_NAME,
    s.INDEX_NAME
FROM information_schema.STATISTICS s
LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage t
    ON s.TABLE_SCHEMA = t.OBJECT_SCHEMA
    AND s.TABLE_NAME = t.OBJECT_NAME
    AND s.INDEX_NAME = t.INDEX_NAME
WHERE t.INDEX_NAME IS NULL
    AND s.TABLE_SCHEMA = 'power_trading'
    AND s.INDEX_NAME != 'PRIMARY';
```

#### 9.3.2 åˆ†åŒºè¡¨è®¾è®¡

**æ—¥å¿—è¡¨åˆ†åŒºç­–ç•¥**ï¼š

```sql
-- æ“ä½œæ—¥å¿—è¡¨æŒ‰æœˆåˆ†åŒº
CREATE TABLE operation_logs (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    operation_type VARCHAR(50) NOT NULL,
    operation_desc TEXT,
    request_data JSON,
    response_data JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at DATETIME NOT NULL,
    
    PRIMARY KEY (id, created_at),
    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB
PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at)) (
    PARTITION p202401 VALUES LESS THAN (202402),
    PARTITION p202402 VALUES LESS THAN (202403),
    PARTITION p202403 VALUES LESS THAN (202404),
    PARTITION p202404 VALUES LESS THAN (202405),
    PARTITION p202405 VALUES LESS THAN (202406),
    PARTITION p202406 VALUES LESS THAN (202407),
    PARTITION p202407 VALUES LESS THAN (202408),
    PARTITION p202408 VALUES LESS THAN (202409),
    PARTITION p202409 VALUES LESS THAN (202410),
    PARTITION p202410 VALUES LESS THAN (202411),
    PARTITION p202411 VALUES LESS THAN (202412),
    PARTITION p202412 VALUES LESS THAN (202501),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- è‡ªåŠ¨åˆ†åŒºç®¡ç†å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE CreateMonthlyPartition()
BEGIN
    DECLARE next_month_partition VARCHAR(20);
    DECLARE next_month_value INT;
    
    SET next_month_value = (YEAR(DATE_ADD(NOW(), INTERVAL 2 MONTH)) * 100 + MONTH(DATE_ADD(NOW(), INTERVAL 2 MONTH)));
    SET next_month_partition = CONCAT('p', next_month_value);
    
    SET @sql = CONCAT('ALTER TABLE operation_logs ADD PARTITION (PARTITION ', next_month_partition, ' VALUES LESS THAN (', next_month_value + 1, '))');
    
    PREPARE stmt FROM @sql;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
END //
DELIMITER ;

-- å®šæ—¶ä»»åŠ¡ï¼šæ¯æœˆ1å·åˆ›å»ºä¸‹ä¸ªæœˆåˆ†åŒº
CREATE EVENT create_monthly_partition
ON SCHEDULE EVERY 1 MONTH
STARTS '2024-01-01 00:00:00'
DO CALL CreateMonthlyPartition();
```

### 9.4 æºç«¯æ•°æ®è¡¨ç»“æ„è®¾è®¡

#### 9.4.1 æºç«¯æ•°æ®è¡¨æ¦‚è¿°

æ¥å£å¹³å°çš„æ•°æ®æ¥æºä¸»è¦æ¥è‡ªç”µåŠ›äº¤æ˜“ç³»ç»Ÿçš„æºç«¯æ•°æ®è¡¨ï¼Œè¿™äº›è¡¨å­˜å‚¨äº†ç”µåŠ›è°ƒåº¦ã€äº¤æ˜“ã€è®¾å¤‡çŠ¶æ€ç­‰æ ¸å¿ƒä¸šåŠ¡æ•°æ®ã€‚æºç«¯æ•°æ®è¡¨æŒ‰ä¸šåŠ¡åŠŸèƒ½å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªä¸»è¦ç±»åˆ«ï¼š

**æ•°æ®è¡¨åˆ†ç±»**ï¼š

```
ç”µåŠ›äº¤æ˜“æºç«¯æ•°æ®è¡¨åˆ†ç±»ï¼š
â”œâ”€â”€ è®¾å¤‡æ£€ä¿®è®¡åˆ’ç±»
â”‚   â”œâ”€â”€ mos_pub_repair_planï¼ˆæ£€ä¿®è®¡åˆ’è¡¨ï¼‰
â”‚   â””â”€â”€ ç›¸å…³è®¾å¤‡çŠ¶æ€è¡¨
â”œâ”€â”€ æœºç»„è¿è¡ŒçŠ¶æ€ç±»
â”‚   â”œâ”€â”€ mos_pub_must_onoffï¼ˆæœºç»„å¿…å¼€å¿…åœçŠ¶æ€è¡¨ï¼‰
â”‚   â””â”€â”€ mos_pub_unit_powerï¼ˆæœºç»„å‡ºåŠ›è¡¨ï¼‰
â”œâ”€â”€ ç«ä»·äº¤æ˜“æ•°æ®ç±»
â”‚   â”œâ”€â”€ mos_pub_bid_sys_statï¼ˆç«ä»·ç³»ç»Ÿç»Ÿè®¡è¡¨ï¼‰
â”‚   â””â”€â”€ ç›¸å…³äº¤æ˜“ç»“æœè¡¨
â”œâ”€â”€ è”ç»œçº¿è®¡åˆ’ç±»
â”‚   â”œâ”€â”€ mos_pub_tie_planï¼ˆè”ç»œçº¿é€å—ç”µè®¡åˆ’è¡¨ï¼‰
â”‚   â””â”€â”€ ç›¸å…³ç”µç½‘æ•°æ®è¡¨
â”œâ”€â”€ å®‰å…¨çº¦æŸç±»
â”‚   â”œâ”€â”€ mos_pub_scs_res_devï¼ˆå®‰å…¨çº¦æŸç»“æœè®¾å¤‡è¡¨ï¼‰
â”‚   â”œâ”€â”€ mos_pub_scs_res_dev_time_typeï¼ˆå®‰å…¨çº¦æŸç»“æœè®¾å¤‡æ—¶é—´ç±»å‹è¡¨ï¼‰
â”‚   â””â”€â”€ ç›¸å…³çº¦æŸæ¡ä»¶è¡¨
â””â”€â”€ å›ºå®šè®¡åˆ’ç±»
    â”œâ”€â”€ mos_pub_fixed_planï¼ˆå›ºå®šè®¡åˆ’è¡¨ï¼‰
    â””â”€â”€ ç›¸å…³è®¡åˆ’æ•°æ®è¡¨
```

#### 9.4.2 æ ¸å¿ƒæºç«¯æ•°æ®è¡¨ç»“æ„

**mos\_pub\_repair\_planï¼ˆè®¾å¤‡æ£€ä¿®è®¡åˆ’è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_repair_plan` (
  `ST_ID` decimal(20,0) DEFAULT NULL COMMENT 'ç”µå‚è°ƒåº¦ID',
  `ST_NAME` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'ç”µå‚è°ƒåº¦åç§°',
  `DEVICE_ID` decimal(20,0) NOT NULL COMMENT 'è®¾å¤‡ID',
  `DEV_NAME` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'è®¾å¤‡è°ƒåº¦åç§°',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æœºä¿®æ—¥æœŸ',
  `CASE_TYPE` decimal(20,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹ï¼Œ220ï¼šæ—¥å‰ï¼›200ï¼šå®æ—¶',
  `EXT_TYPE` decimal(20,0) NOT NULL COMMENT 'å‘å¸ƒç±»å‹ï¼Œ1ï¼šé¢„å‘å¸ƒï¼›2ï¼šç»ˆå‘å¸ƒï¼›3ï¼šå‡ºæ¸…ç»“æœå‘å¸ƒ',
  `REPAIR_ID` varchar(64) CHARACTER SET gbk DEFAULT NULL COMMENT 'æ£€ä¿®ID',
  `device_type` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'è®¾å¤‡ç±»å‹ï¼Œæœºç»„ã€åˆ€é—¸ã€å¼€å…³ç­‰',
  `status` decimal(20,0) DEFAULT NULL COMMENT 'è®¾å¤‡çŠ¶æ€ï¼Œ0ï¼šé€€å‡ºè¿è¡Œï¼›1ï¼šæŠ•å…¥è¿è¡Œ',
  `type` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'çŠ¶æ€ç±»å‹ï¼Œå¤§ä¿®ã€å°ä¿®ã€è¯•éªŒã€è°ƒåœç­‰',
  `reason` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'çŠ¶æ€å˜æ›´åŸå› ',
  `effective` timestamp NOT NULL COMMENT 'åœç”¨æˆ–å¯ç”¨è®¡åˆ’å¼€å§‹æ—¶é—´',
  `termination` timestamp NULL DEFAULT NULL COMMENT 'åœç”¨æˆ–å¯ç”¨è®¡åˆ’ç»“æŸæ—¶é—´',
  `fact_effective_time` timestamp NULL DEFAULT NULL COMMENT 'åœç”¨æˆ–å¯ç”¨å®é™…å¼€å§‹æ—¶é—´',
  `fact_termination_time` timestamp NULL DEFAULT NULL COMMENT 'åœç”¨æˆ–å¯ç”¨å®é™…ç»“æŸæ—¶é—´',
  `div_id` decimal(20,0) DEFAULT NULL COMMENT 'æ‰€å±åŒºåŸŸ',
  `remark` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `UPDATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`DEVICE_ID`,`DATA_TIME`,`CASE_TYPE`,`EXT_TYPE`,`effective`),
  KEY `ind_mpRP_uptime` (`UPDATE_TIME`),
  KEY `index_query` (`DATA_TIME`,`EXT_TYPE`,`CASE_TYPE`,`DEV_NAME`,`ST_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_german2_ci 
COMMENT='è°ƒåº¦-äº¤æ˜“æ£€ä¿®è®¡åˆ’-ï¼ˆçœå†…-ä¿¡æ¯å‘å¸ƒï¼‰';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨ç”µåŠ›è®¾å¤‡çš„æ£€ä¿®è®¡åˆ’ä¿¡æ¯

* æ”¯æŒæ—¥å‰å’Œå®æ—¶ä¸¤ç§æ¡ˆä¾‹ç±»å‹

* è®°å½•è®¾å¤‡çš„è®¡åˆ’æ£€ä¿®æ—¶é—´å’Œå®é™…æ£€ä¿®æ—¶é—´

* ç”¨äºç”µåŠ›è°ƒåº¦å’Œäº¤æ˜“å†³ç­–çš„é‡è¦æ•°æ®æº

**mos\_pub\_must\_onoffï¼ˆæœºç»„å¿…å¼€å¿…åœçŠ¶æ€è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_must_onoff` (
  `phyunit_id` decimal(20,0) NOT NULL COMMENT 'æœºç»„è°ƒåº¦ID',
  `phyunit_name` varchar(64) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'æœºç»„è°ƒåº¦åç§°',
  `case_type` decimal(20,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹ï¼Œ220ï¼šæ—¥å‰ï¼›200ï¼šå®æ—¶',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ—¥æœŸ',
  `EXT_TYPE` decimal(20,0) NOT NULL COMMENT 'å‘å¸ƒç±»å‹ï¼Œ1ï¼šé¢„å‘å¸ƒï¼›2ï¼šç»ˆå‘å¸ƒï¼›3ï¼šå‡ºæ¸…ç»“æœå‘å¸ƒ',
  `DISPLAY_TYPE` decimal(5,0) DEFAULT NULL COMMENT 'æ•°æ®å±•ç¤ºç±»å‹ï¼Œ1ï¼š96ï¼›2ï¼š288',
  -- 288ä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€å­—æ®µï¼ˆæ¯5åˆ†é’Ÿä¸€ä¸ªç‚¹ï¼‰
  `status1` decimal(22,6) DEFAULT NULL COMMENT 'æœºç»„çŠ¶æ€(0:05),0:å‚ä¸ä¼˜åŒ–ï¼›1ï¼šåœæœºï¼›2ï¼šå¼€æœº',
  `status2` decimal(22,6) DEFAULT NULL COMMENT 'æœºç»„çŠ¶æ€(0:10)',
  -- ... çœç•¥ä¸­é—´çŠ¶æ€å­—æ®µ ...
  `status288` decimal(22,6) DEFAULT NULL COMMENT 'æœºç»„çŠ¶æ€(24:00)',
  `remark` varchar(64) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `UPDATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `PARTICIPANT_ID` decimal(20,0) DEFAULT NULL COMMENT 'ç”µå‚ID',
  `CON_TYPE` decimal(10,0) DEFAULT NULL COMMENT 'æ§åˆ¶ç±»å‹(1æ˜¯ç”µç½‘åŸå› ï¼Œ2æ˜¯ç”µå‚åŸå› ï¼Œ3æ˜¯ä¾›çƒ­)',
  PRIMARY KEY (`phyunit_id`,`case_type`,`DATA_TIME`,`EXT_TYPE`),
  KEY `ind_mpmo_uptime` (`UPDATE_TIME`),
  KEY `index_query` (`DATA_TIME`,`phyunit_name`,`EXT_TYPE`,`case_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_german2_ci 
COMMENT='è°ƒåº¦-äº¤æ˜“å‘ç”µæœºç»„å¿…å¼€å¿…åœçŠ¶æ€ï¼ˆçœå†…-ä¿¡æ¯å‘å¸ƒï¼‰';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨å‘ç”µæœºç»„çš„å¿…å¼€å¿…åœçŠ¶æ€ä¿¡æ¯

* æŒ‰5åˆ†é’Ÿé—´éš”è®°å½•å…¨å¤©288ä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€

* æ”¯æŒ96ç‚¹ï¼ˆ15åˆ†é’Ÿé—´éš”ï¼‰å’Œ288ç‚¹ï¼ˆ5åˆ†é’Ÿé—´éš”ï¼‰ä¸¤ç§å±•ç¤ºç±»å‹

* ç”¨äºç”µåŠ›è°ƒåº¦ä¼˜åŒ–å’Œæœºç»„è¿è¡Œç®¡ç†

**mos\_pub\_bid\_sys\_statï¼ˆç«ä»·ç³»ç»Ÿç»Ÿè®¡è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_bid_sys_stat` (
  `AREA_ID` varchar(20) NOT NULL COMMENT 'åŒºåŸŸID',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ•°æ®æ—¶é—´',
  `CASE_TYPE` decimal(10,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹',
  `DATA_TYPE` decimal(10,0) NOT NULL COMMENT 'æ•°æ®ç±»å‹',
  `DATA_NAME` varchar(128) DEFAULT NULL COMMENT 'æ•°æ®åç§°',
  `UNIT_TYPE` decimal(10,0) NOT NULL COMMENT 'å•ä½ç±»å‹',
  `NAME` varchar(20) DEFAULT NULL COMMENT 'åç§°',
  `EXT_TYPE` decimal(10,0) DEFAULT NULL COMMENT 'å‘å¸ƒç±»å‹',
  -- 96ä¸ªæ—¶é—´ç‚¹çš„æ•°å€¼å­—æ®µï¼ˆæ¯15åˆ†é’Ÿä¸€ä¸ªç‚¹ï¼‰
  `VALUE1` decimal(22,6) DEFAULT NULL COMMENT 'æ•°å€¼(0:15)',
  `VALUE2` decimal(22,6) DEFAULT NULL COMMENT 'æ•°å€¼(0:30)',
  -- ... çœç•¥ä¸­é—´æ•°å€¼å­—æ®µ ...
  `VALUE96` decimal(22,6) DEFAULT NULL COMMENT 'æ•°å€¼(24:00)',
  PRIMARY KEY (`AREA_ID`,`DATA_TIME`,`CASE_TYPE`,`DATA_TYPE`,`UNIT_TYPE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_german2_ci 
COMMENT='è°ƒåº¦-äº¤æ˜“ç«ä»·ç³»ç»Ÿç»Ÿè®¡æ•°æ®';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨ç”µåŠ›äº¤æ˜“ç«ä»·ç³»ç»Ÿçš„ç»Ÿè®¡æ•°æ®

* æŒ‰15åˆ†é’Ÿé—´éš”è®°å½•å…¨å¤©96ä¸ªæ—¶é—´ç‚¹çš„æ•°å€¼

* æ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œå•ä½ç±»å‹

* ç”¨äºç”µåŠ›å¸‚åœºåˆ†æå’Œäº¤æ˜“å†³ç­–

**mos\_pub\_scs\_res\_devï¼ˆå®‰å…¨çº¦æŸç»“æœè®¾å¤‡è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_scs_res_dev` (
  `KEYID` decimal(20,0) NOT NULL COMMENT 'å…³é”®ID',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®æ—¶é—´',
  `CASE_TYPE` decimal(10,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹',
  `EXT_TYPE` decimal(20,0) DEFAULT NULL COMMENT 'å‘å¸ƒç±»å‹',
  `DEV` decimal(20,0) DEFAULT NULL COMMENT 'è®¾å¤‡ID',
  `DEV_DESC` varchar(64) DEFAULT NULL COMMENT 'è®¾å¤‡æè¿°',
  `DEV_TYPE` decimal(10,0) DEFAULT NULL COMMENT 'è®¾å¤‡ç±»å‹',
  `B_NORMALNUM` decimal(10,0) DEFAULT NULL COMMENT 'æ­£å¸¸æ—¶æ®µæ•°',
  `B_OVERNUM` decimal(10,0) DEFAULT NULL COMMENT 'è¶Šé™æ—¶æ®µæ•°',
  `B_ALARMNUM` decimal(10,0) DEFAULT NULL COMMENT 'å‘Šè­¦æ—¶æ®µæ•°',
  `B_NORMALPER` decimal(22,6) DEFAULT NULL COMMENT 'æ­£å¸¸æ—¶æ®µæ¯”ä¾‹',
  `B_OVERPER` decimal(22,6) DEFAULT NULL COMMENT 'è¶Šé™æ—¶æ®µæ¯”ä¾‹',
  `B_ALARMPER` decimal(22,6) DEFAULT NULL COMMENT 'å‘Šè­¦æ—¶æ®µæ¯”ä¾‹',
  `B_OVER_MAX_T` timestamp NULL DEFAULT NULL COMMENT 'æœ€å¤§è¶Šé™æ—¶é—´',
  `B_OVER_MAX` decimal(22,6) DEFAULT NULL COMMENT 'æœ€å¤§è¶Šé™å€¼',
  `B_OVER_RATEMAX_T` timestamp NULL DEFAULT NULL COMMENT 'æœ€å¤§è¶Šé™ç‡æ—¶é—´',
  `B_OVER_RATEMAX` decimal(22,6) DEFAULT NULL COMMENT 'æœ€å¤§è¶Šé™ç‡',
  `DEVLIMIT` decimal(22,6) DEFAULT NULL COMMENT 'è®¾å¤‡é™å€¼',
  `UPDATE_TIME` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`KEYID`,`DATA_TIME`,`CASE_TYPE`)
) ENGINE=InnoDB DEFAULT CHARSET=gbk 
COMMENT='è°ƒåº¦-äº¤æ˜“è¶Šé™æƒ…å†µç»Ÿè®¡ï¼ˆçœå†…å‡ºæ¸…ç»“æœï¼‰';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨ç”µåŠ›è®¾å¤‡çš„å®‰å…¨çº¦æŸç»“æœå’Œè¶Šé™ç»Ÿè®¡ä¿¡æ¯

* è®°å½•è®¾å¤‡åœ¨ä¸åŒæ—¶æ®µçš„è¿è¡ŒçŠ¶æ€ï¼ˆæ­£å¸¸ã€è¶Šé™ã€å‘Šè­¦ï¼‰

* æä¾›è¶Šé™åˆ†æçš„å…³é”®æ•°æ®ï¼ŒåŒ…æ‹¬è¶Šé™æ—¶æ®µæ•°ã€æ¯”ä¾‹ã€æœ€å¤§å€¼ç­‰

* ç”¨äºç”µåŠ›ç³»ç»Ÿå®‰å…¨è¿è¡Œç›‘æ§å’Œé£é™©è¯„ä¼°

**mos\_pub\_scs\_res\_dev\_time\_typeï¼ˆå®‰å…¨çº¦æŸç»“æœè®¾å¤‡æ—¶é—´ç±»å‹è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_scs_res_dev_time_type` (
  `ID` decimal(20,0) NOT NULL COMMENT 'è®¾å¤‡ID',
  `NAME` varchar(128) COLLATE utf8mb4_german2_ci DEFAULT NULL COMMENT 'è®¾å¤‡åç§°',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ•°æ®æ—¶é—´',
  `CASE_TYPE` decimal(20,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹',
  `EXT_TYPE` decimal(20,0) NOT NULL COMMENT 'å‘å¸ƒç±»å‹',
  `LIMIT_VALUE` decimal(22,6) DEFAULT NULL COMMENT 'é™åˆ¶å€¼',
  `REVERSE_LIMIT` decimal(22,6) DEFAULT NULL COMMENT 'åå‘é™åˆ¶å€¼',
  -- 288ä¸ªæ—¶é—´ç‚¹çš„åŠŸç‡å€¼å­—æ®µï¼ˆæ¯5åˆ†é’Ÿä¸€ä¸ªç‚¹ï¼‰
  `P1` decimal(22,6) DEFAULT NULL COMMENT 'åŠŸç‡å€¼(0:05)',
  `P2` decimal(22,6) DEFAULT NULL COMMENT 'åŠŸç‡å€¼(0:10)',
  -- ... çœç•¥ä¸­é—´åŠŸç‡å­—æ®µ ...
  `P288` decimal(22,6) DEFAULT NULL COMMENT 'åŠŸç‡å€¼(24:00)',
  `UPDATE_TIME` timestamp NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`ID`,`CASE_TYPE`,`DATA_TIME`,`EXT_TYPE`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_german2_ci 
COMMENT='è°ƒåº¦-äº¤æ˜“å®‰å…¨çº¦æŸç»“æœè®¾å¤‡æ—¶é—´ç±»å‹è¡¨';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨è®¾å¤‡åœ¨å„ä¸ªæ—¶é—´ç‚¹çš„åŠŸç‡å€¼å’Œçº¦æŸé™åˆ¶ä¿¡æ¯

* æŒ‰5åˆ†é’Ÿé—´éš”è®°å½•å…¨å¤©288ä¸ªæ—¶é—´ç‚¹çš„åŠŸç‡æ•°æ®

* åŒ…å«æ­£å‘å’Œåå‘åŠŸç‡é™åˆ¶å€¼ï¼Œç”¨äºå®‰å…¨çº¦æŸæ£€æŸ¥

* ä¸ºç”µåŠ›è°ƒåº¦ä¼˜åŒ–æä¾›è¯¦ç»†çš„æ—¶åºçº¦æŸæ•°æ®

**mos\_pub\_fixed\_planï¼ˆå›ºå®šè®¡åˆ’è¡¨ï¼‰**ï¼š

```sql
CREATE TABLE `mos_pub_fixed_plan` (
  `ID` decimal(20,0) NOT NULL COMMENT 'è®¡åˆ’ID',
  `NAME` varchar(256) CHARACTER SET gbk DEFAULT NULL COMMENT 'è®¡åˆ’åç§°',
  `DATA_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®æ—¶é—´',
  `EXT_TYPE` decimal(20,0) NOT NULL COMMENT 'å‘å¸ƒç±»å‹ï¼Œ1ï¼šé¢„å‘å¸ƒï¼›2ï¼šç»ˆå‘å¸ƒï¼›3ï¼šå‡ºæ¸…ç»“æœå‘å¸ƒ',
  `CASE_TYPE` decimal(20,0) NOT NULL COMMENT 'æ¡ˆä¾‹ç±»å‹ï¼Œé»˜è®¤220',
  `DATA_TYPE` decimal(20,0) DEFAULT NULL COMMENT 'æ•°æ®ç±»å‹',
  `DISPLAY_TYPE` decimal(20,0) DEFAULT NULL COMMENT 'æ˜¾ç¤ºç±»å‹',
  -- 96ä¸ªæ—¶é—´ç‚¹çš„è®¡åˆ’å€¼å­—æ®µï¼ˆæ¯15åˆ†é’Ÿä¸€ä¸ªç‚¹ï¼‰
  `P1` decimal(26,6) DEFAULT NULL COMMENT 'è®¡åˆ’å€¼(0:15)',
  `P2` decimal(26,6) DEFAULT NULL COMMENT 'è®¡åˆ’å€¼(0:30)',
  -- ... çœç•¥ä¸­é—´è®¡åˆ’å­—æ®µ ...
  `P96` decimal(26,6) DEFAULT NULL COMMENT 'è®¡åˆ’å€¼(24:00)',
  PRIMARY KEY (`ID`,`EXT_TYPE`,`DATA_TIME`,`CASE_TYPE`)
) ENGINE=InnoDB DEFAULT CHARSET=gbk 
COMMENT='è°ƒåº¦-äº¤æ˜“å›ºå®šè®¡åˆ’è¡¨';
```

**ä¸šåŠ¡å«ä¹‰**ï¼š

* å­˜å‚¨ç”µåŠ›ç³»ç»Ÿçš„å›ºå®šå‘ç”µè®¡åˆ’æ•°æ®

* æŒ‰15åˆ†é’Ÿé—´éš”è®°å½•å…¨å¤©96ä¸ªæ—¶é—´ç‚¹çš„è®¡åˆ’å€¼

* æ”¯æŒé¢„å‘å¸ƒã€ç»ˆå‘å¸ƒã€å‡ºæ¸…ç»“æœå‘å¸ƒç­‰å¤šç§å‘å¸ƒç±»å‹

* ä¸ºç”µåŠ›è°ƒåº¦å’Œå¸‚åœºäº¤æ˜“æä¾›åŸºç¡€è®¡åˆ’æ•°æ®

#### 9.4.3 æ•°æ®è¡¨è®¾è®¡ç‰¹ç‚¹

**æ—¶é—´åºåˆ—æ•°æ®è®¾è®¡**ï¼š

```
æ—¶é—´ç‚¹å­—æ®µè®¾è®¡æ¨¡å¼ï¼š
- é‡‡ç”¨P1-P288æˆ–status1-status288ã€VALUE1-VALUE96å‘½åè§„èŒƒ
- æ¯ä¸ªå­—æ®µå¯¹åº”ç‰¹å®šæ—¶é—´ç‚¹ï¼ˆ5åˆ†é’Ÿæˆ–15åˆ†é’Ÿé—´éš”ï¼‰
- æ”¯æŒçµæ´»çš„æ—¶é—´ç²’åº¦æŸ¥è¯¢
- ä¾¿äºç”µåŠ›è°ƒåº¦çš„æ—¶åºåˆ†æ

ä¼˜åŠ¿ï¼š
âœ“ æŸ¥è¯¢æ€§èƒ½å¥½ï¼ˆé¿å…JOINæ“ä½œï¼‰
âœ“ æ•°æ®ç»“æ„æ¸…æ™°ï¼ˆæ—¶é—´ç‚¹æ˜ç¡®ï¼‰
âœ“ å­˜å‚¨æ•ˆç‡é«˜ï¼ˆå‡å°‘è¡Œæ•°ï¼‰

è€ƒè™‘ï¼š
- å­—æ®µæ•°é‡è¾ƒå¤šï¼ˆ96-288ä¸ªæ—¶é—´ç‚¹ï¼‰
- éœ€è¦åº”ç”¨å±‚å¤„ç†æ—¶é—´ç‚¹æ˜ å°„
- æ‰©å±•æ–°æ—¶é—´ç²’åº¦éœ€è¦è¡¨ç»“æ„å˜æ›´
```

**å¤åˆä¸»é”®è®¾è®¡**ï¼š

```sql
-- å…¸å‹çš„å¤åˆä¸»é”®æ¨¡å¼
PRIMARY KEY (`DEVICE_ID`,`DATA_TIME`,`CASE_TYPE`,`EXT_TYPE`,`effective`)
PRIMARY KEY (`phyunit_id`,`case_type`,`DATA_TIME`,`EXT_TYPE`)
PRIMARY KEY (`AREA_ID`,`DATA_TIME`,`CASE_TYPE`,`DATA_TYPE`,`UNIT_TYPE`)

-- è®¾è®¡åŸåˆ™ï¼š
-- 1. ä¸šåŠ¡å”¯ä¸€æ€§ä¿è¯
-- 2. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
-- 3. æ•°æ®åˆ†åŒºæ”¯æŒ
-- 4. å†å²æ•°æ®ç®¡ç†
```

**ç´¢å¼•ä¼˜åŒ–ç­–ç•¥**ï¼š

```sql
-- æ›´æ–°æ—¶é—´ç´¢å¼•ï¼ˆæ•°æ®åŒæ­¥ï¼‰
KEY `ind_mpRP_uptime` (`UPDATE_TIME`)
KEY `ind_mpmo_uptime` (`UPDATE_TIME`)

-- ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼•ï¼ˆå¤šå­—æ®µç»„åˆï¼‰
KEY `index_query` (`DATA_TIME`,`EXT_TYPE`,`CASE_TYPE`,`DEV_NAME`,`ST_NAME`)
KEY `index_query` (`DATA_TIME`,`phyunit_name`,`EXT_TYPE`,`case_type`)

-- ç´¢å¼•è®¾è®¡è€ƒè™‘ï¼š
-- 1. æ•°æ®åŒæ­¥åœºæ™¯çš„æ—¶é—´èŒƒå›´æŸ¥è¯¢
-- 2. ä¸šåŠ¡æŸ¥è¯¢çš„å¤šç»´åº¦è¿‡æ»¤
-- 3. åˆ†é¡µæŸ¥è¯¢çš„æ€§èƒ½ä¼˜åŒ–
```

#### 9.4.4 æºç«¯æ•°æ®ä¸æ¥å£å¹³å°çš„é›†æˆ

**æ•°æ®è®¿é—®æ¨¡å¼**ï¼š

```yaml
# æ•°æ®æºé…ç½®
data_sources:
  power_trading_db:
    type: mysql
    host: ${POWER_DB_HOST}
    port: 3306
    database: power_trading
    username: ${POWER_DB_USER}
    password: ${POWER_DB_PASSWORD}
    connection_pool:
      max_connections: 20
      min_connections: 5
      connection_timeout: 30s
    read_only: true  # æºç«¯æ•°æ®åªè¯»è®¿é—®
    tables:
      - mos_pub_repair_plan
      - mos_pub_must_onoff
      - mos_pub_bid_sys_stat
      - mos_pub_tie_plan
      - mos_pub_scs_res_dev
      - mos_pub_fixed_plan
```

**æ¥å£ç”Ÿæˆæ˜ å°„**ï¼š

```json
{
  "interface_templates": [
    {
      "source_table": "mos_pub_repair_plan",
      "interface_name": "è®¾å¤‡æ£€ä¿®è®¡åˆ’æŸ¥è¯¢",
      "interface_path": "/api/v1/repair-plan",
      "description": "æŸ¥è¯¢ç”µåŠ›è®¾å¤‡æ£€ä¿®è®¡åˆ’ä¿¡æ¯",
      "query_template": "SELECT ST_NAME, DEV_NAME, device_type, status, effective, termination FROM mos_pub_repair_plan WHERE DATA_TIME >= #{startTime} AND DATA_TIME <= #{endTime} AND CASE_TYPE = #{caseType}",
      "parameters": [
        {"name": "startTime", "type": "datetime", "required": true, "description": "æŸ¥è¯¢å¼€å§‹æ—¶é—´"},
        {"name": "endTime", "type": "datetime", "required": true, "description": "æŸ¥è¯¢ç»“æŸæ—¶é—´"},
        {"name": "caseType", "type": "integer", "required": false, "default": 220, "description": "æ¡ˆä¾‹ç±»å‹ï¼Œ220ï¼šæ—¥å‰ï¼›200ï¼šå®æ—¶"}
      ],
      "response_fields": [
        {"field": "ST_NAME", "alias": "ç”µå‚åç§°", "type": "string"},
        {"field": "DEV_NAME", "alias": "è®¾å¤‡åç§°", "type": "string"},
        {"field": "device_type", "alias": "è®¾å¤‡ç±»å‹", "type": "string"},
        {"field": "status", "alias": "è®¾å¤‡çŠ¶æ€", "type": "integer"},
        {"field": "effective", "alias": "è®¡åˆ’å¼€å§‹æ—¶é—´", "type": "datetime"},
        {"field": "termination", "alias": "è®¡åˆ’ç»“æŸæ—¶é—´", "type": "datetime"}
      ]
    },
    {
      "source_table": "mos_pub_must_onoff",
      "interface_name": "æœºç»„å¿…å¼€å¿…åœçŠ¶æ€æŸ¥è¯¢",
      "interface_path": "/api/v1/unit-onoff-status",
      "description": "æŸ¥è¯¢å‘ç”µæœºç»„å¿…å¼€å¿…åœçŠ¶æ€ä¿¡æ¯",
      "query_template": "SELECT phyunit_name, status1, status2, status3, status4, status5 FROM mos_pub_must_onoff WHERE DATA_TIME = #{dataTime} AND case_type = #{caseType}",
      "parameters": [
        {"name": "dataTime", "type": "datetime", "required": true, "description": "æ•°æ®æ—¥æœŸ"},
        {"name": "caseType", "type": "integer", "required": false, "default": 220, "description": "æ¡ˆä¾‹ç±»å‹"}
      ],
      "response_fields": [
        {"field": "phyunit_name", "alias": "æœºç»„åç§°", "type": "string"},
        {"field": "status1", "alias": "çŠ¶æ€(0:05)", "type": "decimal"},
        {"field": "status2", "alias": "çŠ¶æ€(0:10)", "type": "decimal"},
        {"field": "status3", "alias": "çŠ¶æ€(0:15)", "type": "decimal"},
        {"field": "status4", "alias": "çŠ¶æ€(0:20)", "type": "decimal"},
        {"field": "status5", "alias": "çŠ¶æ€(0:25)", "type": "decimal"}
      ]
    }
  ]
}
```

**æ•°æ®åŒæ­¥ç­–ç•¥**ï¼š

```yaml
# æ•°æ®åŒæ­¥é…ç½®
sync_config:
  sync_mode: incremental  # å¢é‡åŒæ­¥
  sync_interval: 5m       # åŒæ­¥é—´éš”5åˆ†é’Ÿ
  batch_size: 1000        # æ‰¹å¤„ç†å¤§å°
  
  # åŒæ­¥ä»»åŠ¡é…ç½®
  sync_tasks:
    - table: mos_pub_repair_plan
      sync_field: UPDATE_TIME
      retention_days: 90
    - table: mos_pub_must_onoff
      sync_field: UPDATE_TIME
      retention_days: 30
    - table: mos_pub_bid_sys_stat
      sync_field: DATA_TIME
      retention_days: 365
    - table: mos_pub_scs_res_dev
      sync_field: UPDATE_TIME
      retention_days: 180
    - table: mos_pub_scs_res_dev_time_type
      sync_field: UPDATE_TIME
      retention_days: 180
    - table: mos_pub_fixed_plan
      sync_field: DATA_TIME
      retention_days: 365
```

#### 9.4.5 æ•°æ®æµè½¬æ¶æ„

**æ•´ä½“æ•°æ®æµè½¬å›¾**ï¼š

```mermaid
graph TB
    subgraph "ç”µåŠ›äº¤æ˜“ç³»ç»Ÿï¼ˆæºç«¯ï¼‰"
        A1[mos_pub_repair_plan<br/>æ£€ä¿®è®¡åˆ’è¡¨]
        A2[mos_pub_must_onoff<br/>æœºç»„å¿…å¼€å¿…åœçŠ¶æ€è¡¨]
        A3[mos_pub_bid_sys_stat<br/>ç«ä»·ç³»ç»Ÿç»Ÿè®¡è¡¨]
        A4[mos_pub_scs_res_dev<br/>å®‰å…¨çº¦æŸç»“æœè®¾å¤‡è¡¨]
        A5[mos_pub_scs_res_dev_time_type<br/>å®‰å…¨çº¦æŸç»“æœè®¾å¤‡æ—¶é—´ç±»å‹è¡¨]
        A6[mos_pub_fixed_plan<br/>å›ºå®šè®¡åˆ’è¡¨]
    end

    subgraph "æ¥å£å¹³å°ç³»ç»Ÿ"
        B1[æ•°æ®åŒæ­¥æœåŠ¡<br/>Data Sync Service]
        B2[æ¥å£ç”Ÿæˆå¼•æ“<br/>Interface Generator]
        B3[æ¥å£ç®¡ç†æœåŠ¡<br/>Interface Management]
        B4[APIç½‘å…³<br/>API Gateway]
    end

    subgraph "æ•°æ®æ¶ˆè´¹è€…"
        C1[å†…éƒ¨ä¸šåŠ¡ç³»ç»Ÿ]
        C2[ç¬¬ä¸‰æ–¹åº”ç”¨]
        C3[æ•°æ®åˆ†æå¹³å°]
        C4[ç›‘æ§å‘Šè­¦ç³»ç»Ÿ]
    end

    A1 --> B1
    A2 --> B1
    A3 --> B1
    A4 --> B1
    A5 --> B1
    A6 --> B1

    B1 --> B2
    B2 --> B3
    B3 --> B4

    B4 --> C1
    B4 --> C2
    B4 --> C3
    B4 --> C4
```

**æ•°æ®æµè½¬è¯¦ç»†è¯´æ˜**ï¼š

```
1. æ•°æ®é‡‡é›†å±‚ï¼ˆæºç«¯ç³»ç»Ÿï¼‰ï¼š
   â”œâ”€â”€ ç”µåŠ›è°ƒåº¦ç³»ç»Ÿäº§ç”Ÿå®æ—¶è¿è¡Œæ•°æ®
   â”œâ”€â”€ äº¤æ˜“ç³»ç»Ÿç”Ÿæˆå¸‚åœºäº¤æ˜“æ•°æ®
   â”œâ”€â”€ å®‰å…¨çº¦æŸç³»ç»Ÿè¾“å‡ºçº¦æŸåˆ†æç»“æœ
   â””â”€â”€ è®¡åˆ’ç³»ç»Ÿå‘å¸ƒå„ç±»å‘ç”µè®¡åˆ’

2. æ•°æ®åŒæ­¥å±‚ï¼ˆæ¥å£å¹³å°ï¼‰ï¼š
   â”œâ”€â”€ å¢é‡æ•°æ®åŒæ­¥ï¼ˆåŸºäºUPDATE_TIME/DATA_TIMEï¼‰
   â”œâ”€â”€ æ•°æ®è´¨é‡æ£€æŸ¥å’Œæ¸…æ´—
   â”œâ”€â”€ æ•°æ®æ ¼å¼æ ‡å‡†åŒ–å¤„ç†
   â””â”€â”€ å¼‚å¸¸æ•°æ®ç›‘æ§å’Œå‘Šè­¦

3. æ¥å£ç”Ÿæˆå±‚ï¼ˆæ¥å£å¹³å°ï¼‰ï¼š
   â”œâ”€â”€ åŸºäºæºç«¯è¡¨ç»“æ„è‡ªåŠ¨ç”Ÿæˆæ¥å£
   â”œâ”€â”€ SQLæ¨¡æ¿åŒ–å’Œå‚æ•°åŒ–å¤„ç†
   â”œâ”€â”€ æ¥å£æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
   â””â”€â”€ æ¥å£ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒ

4. æ¥å£æœåŠ¡å±‚ï¼ˆæ¥å£å¹³å°ï¼‰ï¼š
   â”œâ”€â”€ ç»Ÿä¸€APIç½‘å…³å…¥å£
   â”œâ”€â”€ è®¤è¯æˆæƒå’Œæƒé™æ§åˆ¶
   â”œâ”€â”€ è¯·æ±‚é™æµå’Œç†”æ–­ä¿æŠ¤
   â””â”€â”€ ç›‘æ§æ—¥å¿—å’Œæ€§èƒ½ç»Ÿè®¡

5. æ•°æ®æ¶ˆè´¹å±‚ï¼ˆå¤–éƒ¨ç³»ç»Ÿï¼‰ï¼š
   â”œâ”€â”€ æ ‡å‡†åŒ–REST APIè°ƒç”¨
   â”œâ”€â”€ å®æ—¶æ•°æ®æŸ¥è¯¢å’Œåˆ†æ
   â”œâ”€â”€ å†å²æ•°æ®ç»Ÿè®¡å’ŒæŠ¥è¡¨
   â””â”€â”€ ä¸šåŠ¡ç³»ç»Ÿé›†æˆå’Œåº”ç”¨
```

**å…³é”®æ•°æ®æµè½¬åœºæ™¯**ï¼š

```yaml
# åœºæ™¯1ï¼šè®¾å¤‡æ£€ä¿®è®¡åˆ’æŸ¥è¯¢
scenario_1:
  name: "è®¾å¤‡æ£€ä¿®è®¡åˆ’æŸ¥è¯¢"
  source_table: "mos_pub_repair_plan"
  data_flow:
    - step: "è°ƒåº¦ç³»ç»Ÿæ›´æ–°æ£€ä¿®è®¡åˆ’"
      action: "INSERT/UPDATE mos_pub_repair_plan"
      trigger: "UPDATE_TIMEå­—æ®µæ›´æ–°"
    - step: "æ•°æ®åŒæ­¥æœåŠ¡æ£€æµ‹å˜æ›´"
      action: "å¢é‡åŒæ­¥åˆ°æ¥å£å¹³å°"
      interval: "5åˆ†é’Ÿ"
    - step: "æ¥å£å¹³å°æä¾›æŸ¥è¯¢æœåŠ¡"
      action: "é€šè¿‡/api/v1/repair-planæ¥å£æŸ¥è¯¢"
      parameters: ["startTime", "endTime", "caseType"]
    - step: "ä¸šåŠ¡ç³»ç»Ÿè°ƒç”¨æ¥å£"
      action: "è·å–æ£€ä¿®è®¡åˆ’æ•°æ®ç”¨äºè°ƒåº¦å†³ç­–"
      format: "JSONæ ¼å¼å“åº”"

# åœºæ™¯2ï¼šæœºç»„çŠ¶æ€å®æ—¶ç›‘æ§
scenario_2:
  name: "æœºç»„çŠ¶æ€å®æ—¶ç›‘æ§"
  source_table: "mos_pub_must_onoff"
  data_flow:
    - step: "äº¤æ˜“ç³»ç»Ÿå‘å¸ƒæœºç»„çŠ¶æ€"
      action: "UPDATE mos_pub_must_onoff"
      frequency: "æ¯5åˆ†é’Ÿ288ä¸ªæ—¶é—´ç‚¹"
    - step: "å®æ—¶æ•°æ®åŒæ­¥"
      action: "å‡†å®æ—¶åŒæ­¥çŠ¶æ€æ•°æ®"
      delay: "<1åˆ†é’Ÿ"
    - step: "çŠ¶æ€ç›‘æ§æ¥å£è°ƒç”¨"
      action: "é€šè¿‡/api/v1/unit-onoff-statusæŸ¥è¯¢"
      usage: "ç›‘æ§ç³»ç»Ÿå®æ—¶å±•ç¤º"
    - step: "å‘Šè­¦ç³»ç»Ÿé›†æˆ"
      action: "å¼‚å¸¸çŠ¶æ€è§¦å‘å‘Šè­¦"
      threshold: "åŸºäºstatuså€¼åˆ¤æ–­"

# åœºæ™¯3ï¼šå¸‚åœºæ•°æ®åˆ†æ
scenario_3:
  name: "ç”µåŠ›å¸‚åœºæ•°æ®åˆ†æ"
  source_table: "mos_pub_bid_sys_stat"
  data_flow:
    - step: "ç«ä»·ç³»ç»Ÿç”Ÿæˆç»Ÿè®¡æ•°æ®"
      action: "INSERT mos_pub_bid_sys_stat"
      granularity: "96ä¸ª15åˆ†é’Ÿæ—¶é—´ç‚¹"
    - step: "å†å²æ•°æ®ç§¯ç´¯"
      action: "æŒ‰æ—¥æœŸç»´åº¦å­˜å‚¨"
      retention: "365å¤©"
    - step: "åˆ†ææ¥å£æä¾›æœåŠ¡"
      action: "æ”¯æŒæ—¶é—´èŒƒå›´å’Œç»´åº¦æŸ¥è¯¢"
      analytics: "è¶‹åŠ¿åˆ†æã€å¯¹æ¯”åˆ†æ"
    - step: "æŠ¥è¡¨ç³»ç»Ÿæ•°æ®å±•ç¤º"
      action: "ç”Ÿæˆå¸‚åœºåˆ†ææŠ¥è¡¨"
      visualization: "å›¾è¡¨ã€è¶‹åŠ¿çº¿ã€çƒ­åŠ›å›¾"
```

**æ•°æ®è´¨é‡ä¿éšœæœºåˆ¶**ï¼š

```
æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼š
â”œâ”€â”€ ä¸»é”®å”¯ä¸€æ€§éªŒè¯
â”œâ”€â”€ å¿…å¡«å­—æ®µéç©ºæ£€æŸ¥
â”œâ”€â”€ æ•°æ®ç±»å‹æ ¼å¼éªŒè¯
â””â”€â”€ ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§æ ¡éªŒ

æ•°æ®æ—¶æ•ˆæ€§ä¿éšœï¼š
â”œâ”€â”€ å®æ—¶ç›‘æ§UPDATE_TIMEå­—æ®µ
â”œâ”€â”€ æ•°æ®å»¶è¿Ÿå‘Šè­¦æœºåˆ¶
â”œâ”€â”€ åŒæ­¥å¤±è´¥é‡è¯•ç­–ç•¥
â””â”€â”€ æ•°æ®è¡¥å¿å’Œä¿®å¤æœºåˆ¶

æ•°æ®å®‰å…¨æ€§æ§åˆ¶ï¼š
â”œâ”€â”€ æºç«¯æ•°æ®åªè¯»è®¿é—®
â”œâ”€â”€ æ•æ„Ÿæ•°æ®è„±æ•å¤„ç†
â”œâ”€â”€ è®¿é—®æƒé™ç²¾ç»†åŒ–æ§åˆ¶
â””â”€â”€ æ“ä½œå®¡è®¡æ—¥å¿—è®°å½•
```

### 9.5 æ•°æ®å­—å…¸å®Œæ•´å®šä¹‰

#### 9.4.1 æšä¸¾å€¼å­—å…¸

**ç”¨æˆ·çŠ¶æ€æšä¸¾**ï¼š

```sql
CREATE TABLE enum_user_status (
    code TINYINT PRIMARY KEY COMMENT 'çŠ¶æ€ç ',
    name VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€åç§°',
    description VARCHAR(100) COMMENT 'çŠ¶æ€æè¿°',
    color VARCHAR(10) COMMENT 'æ˜¾ç¤ºé¢œè‰²'
) COMMENT='ç”¨æˆ·çŠ¶æ€æšä¸¾';

INSERT INTO enum_user_status VALUES
(0, 'ç¦ç”¨', 'ç”¨æˆ·è¢«ç®¡ç†å‘˜ç¦ç”¨ï¼Œæ— æ³•ç™»å½•ç³»ç»Ÿ', '#ff4d4f'),
(1, 'å¯ç”¨', 'ç”¨æˆ·æ­£å¸¸çŠ¶æ€ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿ', '#52c41a'),
(2, 'é”å®š', 'ç”¨æˆ·å› å¼‚å¸¸æ“ä½œè¢«ä¸´æ—¶é”å®š', '#faad14');
```

**æ¥å£çŠ¶æ€æšä¸¾**ï¼š

```sql
CREATE TABLE enum_interface_status (
    code VARCHAR(20) PRIMARY KEY COMMENT 'çŠ¶æ€ç ',
    name VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€åç§°',
    description VARCHAR(100) COMMENT 'çŠ¶æ€æè¿°',
    color VARCHAR(10) COMMENT 'æ˜¾ç¤ºé¢œè‰²',
    allow_call TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å…è®¸è°ƒç”¨'
) COMMENT='æ¥å£çŠ¶æ€æšä¸¾';

INSERT INTO enum_interface_status VALUES
('unpublished', 'æœªä¸Šæ¶', 'æ¥å£å·²ç”Ÿæˆä½†æœªå‘å¸ƒï¼Œä¸å¯è°ƒç”¨', '#d9d9d9', 0),
('published', 'å·²ä¸Šæ¶', 'æ¥å£å·²å‘å¸ƒï¼Œå¯ä»¥æ­£å¸¸è°ƒç”¨', '#52c41a', 1),
('offline', 'å·²ä¸‹æ¶', 'æ¥å£è¢«ä¸‹æ¶ï¼Œæš‚åœè°ƒç”¨', '#ff4d4f', 0),
('deprecated', 'å·²åºŸå¼ƒ', 'æ¥å£ç‰ˆæœ¬è¿‡æœŸï¼Œå»ºè®®å‡çº§', '#faad14', 0);
```

**ç”³è¯·çŠ¶æ€æšä¸¾**ï¼š

```sql
CREATE TABLE enum_application_status (
    code VARCHAR(20) PRIMARY KEY COMMENT 'çŠ¶æ€ç ',
    name VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€åç§°',
    description VARCHAR(100) COMMENT 'çŠ¶æ€æè¿°',
    color VARCHAR(10) COMMENT 'æ˜¾ç¤ºé¢œè‰²',
    is_final TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æœ€ç»ˆçŠ¶æ€'
) COMMENT='ç”³è¯·çŠ¶æ€æšä¸¾';

INSERT INTO enum_application_status VALUES
('pending', 'å¾…å®¡æ‰¹', 'ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…å®¡æ‰¹äººå¤„ç†', '#1890ff', 0),
('approved', 'å·²é€šè¿‡', 'ç”³è¯·å®¡æ‰¹é€šè¿‡ï¼Œç”¨æˆ·è·å¾—æ¥å£æƒé™', '#52c41a', 1),
('rejected', 'å·²æ‹’ç»', 'ç”³è¯·è¢«æ‹’ç»ï¼Œç”¨æˆ·æœªè·å¾—æƒé™', '#ff4d4f', 1),
('cancelled', 'å·²å–æ¶ˆ', 'ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆç”³è¯·', '#d9d9d9', 1);
```

#### 9.4.2 æ•°æ®ç±»å‹å­—å…¸

**å‚æ•°ç±»å‹å®šä¹‰**ï¼š

```sql
CREATE TABLE param_type_definitions (
    type_code VARCHAR(20) PRIMARY KEY COMMENT 'ç±»å‹ä»£ç ',
    type_name VARCHAR(50) NOT NULL COMMENT 'ç±»å‹åç§°',
    java_type VARCHAR(50) COMMENT 'Javaç±»å‹',
    mysql_type VARCHAR(50) COMMENT 'MySQLç±»å‹',
    validation_pattern VARCHAR(255) COMMENT 'éªŒè¯æ­£åˆ™',
    default_validation JSON COMMENT 'é»˜è®¤éªŒè¯è§„åˆ™',
    example_value VARCHAR(100) COMMENT 'ç¤ºä¾‹å€¼'
) COMMENT='å‚æ•°ç±»å‹å®šä¹‰è¡¨';

INSERT INTO param_type_definitions VALUES
('string', 'å­—ç¬¦ä¸²', 'String', 'VARCHAR', '^.{0,255}$', '{"maxLength": 255}', 'example_string'),
('integer', 'æ•´æ•°', 'Integer', 'INT', '^-?\\d+$', '{"min": -2147483648, "max": 2147483647}', '123'),
('long', 'é•¿æ•´æ•°', 'Long', 'BIGINT', '^-?\\d+$', '{"min": -9223372036854775808, "max": 9223372036854775807}', '1234567890'),
('decimal', 'å°æ•°', 'BigDecimal', 'DECIMAL', '^-?\\d+(\\.\\d+)?$', '{"precision": 10, "scale": 2}', '123.45'),
('boolean', 'å¸ƒå°”å€¼', 'Boolean', 'TINYINT', '^(true|false|0|1)$', '{}', 'true'),
('date', 'æ—¥æœŸ', 'LocalDate', 'DATE', '^\\d{4}-\\d{2}-\\d{2}$', '{"format": "yyyy-MM-dd"}', '2024-01-15'),
('datetime', 'æ—¥æœŸæ—¶é—´', 'LocalDateTime', 'DATETIME', '^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$', '{"format": "yyyy-MM-dd HH:mm:ss"}', '2024-01-15 10:30:00'),
('json', 'JSONå¯¹è±¡', 'Object', 'JSON', '^\\{.*\\}$', '{}', '{"key": "value"}');
```

#### 9.4.3 ä¸šåŠ¡è§„åˆ™å­—å…¸

**ä¸šåŠ¡çº¦æŸè§„åˆ™è¡¨**ï¼š

```sql
CREATE TABLE business_rules (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§„åˆ™ID',
    rule_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'è§„åˆ™ä»£ç ',
    rule_name VARCHAR(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
    rule_type VARCHAR(20) NOT NULL COMMENT 'è§„åˆ™ç±»å‹',
    target_table VARCHAR(50) COMMENT 'ç›®æ ‡è¡¨',
    target_field VARCHAR(50) COMMENT 'ç›®æ ‡å­—æ®µ',
    rule_expression TEXT NOT NULL COMMENT 'è§„åˆ™è¡¨è¾¾å¼',
    error_message VARCHAR(255) COMMENT 'é”™è¯¯æç¤ºä¿¡æ¯',
    is_active TINYINT DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨',
    priority INT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´'
) COMMENT='ä¸šåŠ¡è§„åˆ™å®šä¹‰è¡¨';

INSERT INTO business_rules VALUES
(1, 'username_format', 'ç”¨æˆ·åæ ¼å¼æ£€æŸ¥', 'validation', 'users', 'username', '^[a-zA-Z][a-zA-Z0-9_]{2,49}$', 'ç”¨æˆ·åå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œ3-50å­—ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿', 1, 1, NOW()),
(2, 'password_strength', 'å¯†ç å¼ºåº¦æ£€æŸ¥', 'validation', 'users', 'password', '^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$', 'å¯†ç è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦', 1, 1, NOW()),
(3, 'interface_name_unique', 'æ¥å£åç§°å”¯ä¸€æ€§', 'uniqueness', 'interfaces', 'name', 'UNIQUE', 'æ¥å£åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°', 1, 1, NOW()),
(4, 'interface_path_format', 'æ¥å£è·¯å¾„æ ¼å¼', 'validation', 'interfaces', 'path', '^/[a-zA-Z0-9/_-]+$', 'æ¥å£è·¯å¾„æ ¼å¼é”™è¯¯ï¼Œå¿…é¡»ä»¥/å¼€å¤´ï¼Œåªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦', 1, 1, NOW()),
(5, 'daily_application_limit', 'æ¯æ—¥ç”³è¯·é™åˆ¶', 'business', 'subscription_applications', 'user_id', 'COUNT(*) <= 10 WHERE DATE(applied_at) = CURDATE()', 'æ¯æ—¥æœ€å¤šç”³è¯·10ä¸ªæ¥å£', 1, 2, NOW());
```

## 10. å‰ç«¯ç»„ä»¶è§„èŒƒ

### 10.1 ç»„ä»¶æ¶æ„è®¾è®¡

#### 10.1.1 ç»„ä»¶åˆ†å±‚æ¶æ„

**ç»„ä»¶å±‚æ¬¡ç»“æ„**ï¼š

```
é¡µé¢å±‚ï¼ˆPagesï¼‰ï¼š
- è·¯ç”±é¡µé¢ç»„ä»¶
- ä¸šåŠ¡é€»è¾‘æ•´åˆ
- æ•°æ®æµç®¡ç†
- é¡µé¢çº§çŠ¶æ€ç®¡ç†

å®¹å™¨å±‚ï¼ˆContainersï¼‰ï¼š
- ä¸šåŠ¡å®¹å™¨ç»„ä»¶
- æ•°æ®è·å–å’Œå¤„ç†
- å­ç»„ä»¶åè°ƒ
- ä¸šåŠ¡çŠ¶æ€ç®¡ç†

ç»„ä»¶å±‚ï¼ˆComponentsï¼‰ï¼š
- å¯å¤ç”¨UIç»„ä»¶
- çº¯å±•ç¤ºç»„ä»¶
- äº¤äº’é€»è¾‘å°è£…
- å±æ€§éªŒè¯

åŸºç¡€å±‚ï¼ˆBaseï¼‰ï¼š
- åŸå­çº§ç»„ä»¶
- æ ·å¼ç³»ç»Ÿ
- å·¥å…·å‡½æ•°
- å¸¸é‡å®šä¹‰
```

**ç»„ä»¶å‘½åè§„èŒƒ**ï¼š

```javascript
// é¡µé¢ç»„ä»¶ï¼šPascalCase + Pageåç¼€
InterfaceCatalogPage.vue
InterfaceManagementPage.vue
UserCenterPage.vue

// ä¸šåŠ¡ç»„ä»¶ï¼šPascalCase + ä¸šåŠ¡å«ä¹‰
InterfaceGenerationWizard.vue
SubscriptionApplicationForm.vue
ApprovalHistoryTable.vue

// åŸºç¡€ç»„ä»¶ï¼šBase + PascalCase
BaseButton.vue
BaseTable.vue
BaseModal.vue

// å¸ƒå±€ç»„ä»¶ï¼šLayout + PascalCase
LayoutHeader.vue
LayoutSidebar.vue
LayoutContent.vue
```

#### 10.1.2 çŠ¶æ€ç®¡ç†æ¶æ„

**Pinia Storeè®¾è®¡**ï¼š

```javascript
// stores/index.js - çŠ¶æ€ç®¡ç†å…¥å£
import { createPinia } from 'pinia'
import { createPersistedState } from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(createPersistedState({
  storage: localStorage,
  serializer: {
    serialize: JSON.stringify,
    deserialize: JSON.parse
  }
}))

export default pinia

// stores/modules/user.js - ç”¨æˆ·çŠ¶æ€ç®¡ç†
import { defineStore } from 'pinia'
import { userApi } from '@/api/user'

export const useUserStore = defineStore('user', {
  state: () => ({
    userInfo: null,
    token: null,
    permissions: [],
    roles: [],
    isLoggedIn: false,
    loginLoading: false
  }),
  
  getters: {
    // ç”¨æˆ·æƒé™æ£€æŸ¥
    hasPermission: (state) => (permission) => {
      return state.permissions.includes(permission)
    },
    
    // ç”¨æˆ·è§’è‰²æ£€æŸ¥
    hasRole: (state) => (role) => {
      return state.roles.includes(role)
    },
    
    // ç”¨æˆ·æ˜¾ç¤ºåç§°
    displayName: (state) => {
      return state.userInfo?.real_name || state.userInfo?.username || 'æœªçŸ¥ç”¨æˆ·'
    },
    
    // ç”¨æˆ·å¤´åƒURL
    avatarUrl: (state) => {
      return state.userInfo?.avatar_url || '/default-avatar.png'
    }
  },
  
  actions: {
    // ç”¨æˆ·ç™»å½•
    async login(credentials) {
      this.loginLoading = true
      try {
        const response = await userApi.login(credentials)
        const { token, user, permissions, roles } = response.data
        
        this.token = token
        this.userInfo = user
        this.permissions = permissions
        this.roles = roles
        this.isLoggedIn = true
        
        // è®¾ç½®axiosé»˜è®¤token
        this.setAuthToken(token)
        
        return { success: true }
      } catch (error) {
        return { 
          success: false, 
          message: error.response?.data?.message || 'ç™»å½•å¤±è´¥' 
        }
      } finally {
        this.loginLoading = false
      }
    },
    
    // ç”¨æˆ·ç™»å‡º
    async logout() {
      try {
        await userApi.logout()
      } catch (error) {
        console.error('ç™»å‡ºè¯·æ±‚å¤±è´¥:', error)
      } finally {
        this.clearUserData()
      }
    },
    
    // æ¸…é™¤ç”¨æˆ·æ•°æ®
    clearUserData() {
      this.userInfo = null
      this.token = null
      this.permissions = []
      this.roles = []
      this.isLoggedIn = false
      this.removeAuthToken()
    },
    
    // è®¾ç½®è®¤è¯token
    setAuthToken(token) {
      // è®¾ç½®axiosè¯·æ±‚å¤´
      if (token) {
        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`
      }
    },
    
    // ç§»é™¤è®¤è¯token
    removeAuthToken() {
      delete axios.defaults.headers.common['Authorization']
    },
    
    // åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
    async refreshUserInfo() {
      try {
        const response = await userApi.getCurrentUser()
        this.userInfo = response.data
      } catch (error) {
        console.error('åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
      }
    }
  },
  
  // æŒä¹…åŒ–é…ç½®
  persist: {
    key: 'user-store',
    storage: localStorage,
    paths: ['token', 'userInfo', 'permissions', 'roles', 'isLoggedIn']
  }
})
```

**æ¥å£ç®¡ç†çŠ¶æ€**ï¼š

```javascript
// stores/modules/interface.js
export const useInterfaceStore = defineStore('interface', {
  state: () => ({
    // æ¥å£åˆ—è¡¨æ•°æ®
    interfaces: [],
    categories: [],
    
    // åˆ†é¡µä¿¡æ¯
    pagination: {
      current: 1,
      pageSize: 20,
      total: 0
    },
    
    // ç­›é€‰æ¡ä»¶
    filters: {
      status: '',
      category: '',
      keyword: ''
    },
    
    // åŠ è½½çŠ¶æ€
    loading: {
      list: false,
      detail: false,
      operation: false
    },
    
    // å½“å‰é€‰ä¸­çš„æ¥å£
    selectedInterfaces: [],
    
    // æ¥å£è¯¦æƒ…
    currentInterface: null
  }),
  
  getters: {
    // å·²å‘å¸ƒæ¥å£æ•°é‡
    publishedCount: (state) => {
      return state.interfaces.filter(item => item.status === 'published').length
    },
    
    // æœªå‘å¸ƒæ¥å£æ•°é‡
    unpublishedCount: (state) => {
      return state.interfaces.filter(item => item.status === 'unpublished').length
    },
    
    // æŒ‰åˆ†ç±»åˆ†ç»„çš„æ¥å£
    interfacesByCategory: (state) => {
      const grouped = {}
      state.interfaces.forEach(item => {
        const category = item.category_name || 'æœªåˆ†ç±»'
        if (!grouped[category]) {
          grouped[category] = []
        }
        grouped[category].push(item)
      })
      return grouped
    }
  },
  
  actions: {
    // è·å–æ¥å£åˆ—è¡¨
    async fetchInterfaces(params = {}) {
      this.loading.list = true
      try {
        const queryParams = {
          page: this.pagination.current,
          size: this.pagination.pageSize,
          ...this.filters,
          ...params
        }
        
        const response = await interfaceApi.getList(queryParams)
        const { records, total, current, size } = response.data
        
        this.interfaces = records
        this.pagination = { current, size, total }
        
        return { success: true }
      } catch (error) {
        return { 
          success: false, 
          message: error.response?.data?.message || 'è·å–æ¥å£åˆ—è¡¨å¤±è´¥' 
        }
      } finally {
        this.loading.list = false
      }
    },
    
    // è·å–æ¥å£åˆ†ç±»
    async fetchCategories() {
      try {
        const response = await interfaceApi.getCategories()
        this.categories = response.data
      } catch (error) {
        console.error('è·å–åˆ†ç±»å¤±è´¥:', error)
      }
    },
    
    // æ‰¹é‡æ“ä½œæ¥å£
    async batchOperation(operation, interfaceIds, reason = '') {
      this.loading.operation = true
      try {
        const response = await interfaceApi.batchOperation({
          operation,
          interface_ids: interfaceIds,
          reason
        })
        
        // åˆ·æ–°åˆ—è¡¨
        await this.fetchInterfaces()
        
        return { 
          success: true, 
          data: response.data 
        }
      } catch (error) {
        return { 
          success: false, 
          message: error.response?.data?.message || 'æ‰¹é‡æ“ä½œå¤±è´¥' 
        }
      } finally {
        this.loading.operation = false
      }
    },
    
    // æ›´æ–°ç­›é€‰æ¡ä»¶
    updateFilters(newFilters) {
      this.filters = { ...this.filters, ...newFilters }
      this.pagination.current = 1 // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
    },
    
    // æ›´æ–°åˆ†é¡µ
    updatePagination(newPagination) {
      this.pagination = { ...this.pagination, ...newPagination }
    },
    
    // é€‰æ‹©æ¥å£
    selectInterfaces(interfaceIds) {
      this.selectedInterfaces = interfaceIds
    },
    
    // æ¸…ç©ºé€‰æ‹©
    clearSelection() {
      this.selectedInterfaces = []
    }
  }
})
```

### 10.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 10.2.1 æ¥å£ç”Ÿæˆå‘å¯¼ç»„ä»¶

**InterfaceGenerationWizard.vue**ï¼š

```vue
<template>
  <div class="interface-generation-wizard">
    <!-- æ­¥éª¤å¯¼èˆª -->
    <div class="wizard-steps">
      <div 
        v-for="(step, index) in steps" 
        :key="step.key"
        :class="[
          'step-item',
          { 
            'active': currentStep === index,
            'completed': index < currentStep,
            'disabled': index > currentStep
          }
        ]"
        @click="handleStepClick(index)"
      >
        <div class="step-number">
          <i v-if="index < currentStep" class="icon-check"></i>
          <span v-else>{{ index + 1 }}</span>
        </div>
        <div class="step-content">
          <div class="step-title">{{ step.title }}</div>
          <div class="step-description">{{ step.description }}</div>
        </div>
      </div>
    </div>
    
    <!-- æ­¥éª¤å†…å®¹ -->
    <div class="wizard-content">
      <transition name="slide-fade" mode="out-in">
        <component 
          :is="currentStepComponent"
          v-model="formData"
          :loading="loading"
          :errors="errors"
          @validate="handleStepValidate"
          @next="handleNext"
          @prev="handlePrev"
        />
      </transition>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="wizard-actions">
      <base-button 
        v-if="currentStep > 0"
        type="default"
        @click="handlePrev"
      >
        ä¸Šä¸€æ­¥
      </base-button>
      
      <base-button 
        v-if="currentStep < steps.length - 1"
        type="primary"
        :loading="loading"
        :disabled="!currentStepValid"
        @click="handleNext"
      >
        ä¸‹ä¸€æ­¥
      </base-button>
      
      <base-button 
        v-if="currentStep === steps.length - 1"
        type="primary"
        :loading="loading"
        @click="handleSubmit"
      >
        ç”Ÿæˆæ¥å£
      </base-button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import { useRouter } from 'vue-router'
import { useInterfaceStore } from '@/stores/modules/interface'
import { interfaceApi } from '@/api/interface'

// ç»„ä»¶å¼•å…¥
import DataSourceSelection from './steps/DataSourceSelection.vue'
import InterfaceConfiguration from './steps/InterfaceConfiguration.vue'
import ParameterSettings from './steps/ParameterSettings.vue'
import PreviewConfirmation from './steps/PreviewConfirmation.vue'

// Propså®šä¹‰
const props = defineProps({
  initialData: {
    type: Object,
    default: () => ({})
  }
})

// Emitså®šä¹‰
const emit = defineEmits(['success', 'cancel'])

// å“åº”å¼æ•°æ®
const router = useRouter()
const interfaceStore = useInterfaceStore()

const currentStep = ref(0)
const loading = ref(false)
const errors = ref({})
const currentStepValid = ref(false)

// æ­¥éª¤é…ç½®
const steps = [
  {
    key: 'datasource',
    title: 'é€‰æ‹©æ•°æ®æº',
    description: 'é€‰æ‹©æ•°æ®æºå’Œæ•°æ®è¡¨',
    component: DataSourceSelection
  },
  {
    key: 'configuration',
    title: 'æ¥å£é…ç½®',
    description: 'é…ç½®æ¥å£åŸºæœ¬ä¿¡æ¯',
    component: InterfaceConfiguration
  },
  {
    key: 'parameters',
    title: 'å‚æ•°è®¾ç½®',
    description: 'è®¾ç½®æ¥å£å‚æ•°',
    component: ParameterSettings
  },
  {
    key: 'preview',
    title: 'é¢„è§ˆç¡®è®¤',
    description: 'é¢„è§ˆå¹¶ç¡®è®¤é…ç½®',
    component: PreviewConfirmation
  }
]

// è¡¨å•æ•°æ®
const formData = ref({
  // æ•°æ®æºé€‰æ‹©
  dataSource: null,
  tableName: '',
  tableInfo: null,
  
  // æ¥å£é…ç½®
  interfaceName: '',
  interfaceDescription: '',
  interfacePath: '',
  category: null,
  
  // å‚æ•°è®¾ç½®
  parameters: [],
  sqlTemplate: '',
  
  // å…¶ä»–é…ç½®
  rateLimit: 1000,
  timeout: 30,
  cacheTtl: 300,
  
  ...props.initialData
})

// è®¡ç®—å±æ€§
const currentStepComponent = computed(() => {
  return steps[currentStep.value]?.component
})

// äº‹ä»¶å¤„ç†
const handleStepClick = (index) => {
  // åªå…è®¸ç‚¹å‡»å·²å®Œæˆçš„æ­¥éª¤
  if (index < currentStep.value) {
    currentStep.value = index
  }
}

const handleStepValidate = (valid, stepErrors = {}) => {
  currentStepValid.value = valid
  errors.value = stepErrors
}

const handleNext = async () => {
  if (!currentStepValid.value) {
    return
  }
  
  // æ‰§è¡Œå½“å‰æ­¥éª¤çš„ç‰¹æ®Šé€»è¾‘
  const stepKey = steps[currentStep.value].key
  
  if (stepKey === 'datasource') {
    // æ•°æ®æºé€‰æ‹©å®Œæˆåï¼Œè‡ªåŠ¨ç”Ÿæˆæ¥å£åç§°å’Œè·¯å¾„
    await generateInterfaceDefaults()
  } else if (stepKey === 'configuration') {
    // æ¥å£é…ç½®å®Œæˆåï¼Œç”ŸæˆSQLæ¨¡æ¿
    await generateSqlTemplate()
  }
  
  currentStep.value++
}

const handlePrev = () => {
  if (currentStep.value > 0) {
    currentStep.value--
  }
}

const handleSubmit = async () => {
  loading.value = true
  try {
    const response = await interfaceApi.generate(formData.value)
    
    emit('success', response.data)
    
    // è·³è½¬åˆ°æ¥å£ç®¡ç†é¡µé¢
    router.push({
      name: 'InterfaceManagement',
      query: { highlight: response.data.id }
    })
  } catch (error) {
    console.error('æ¥å£ç”Ÿæˆå¤±è´¥:', error)
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  } finally {
    loading.value = false
  }
}

// è¾…åŠ©æ–¹æ³•
const generateInterfaceDefaults = async () => {
  const { tableName, tableInfo } = formData.value
  
  if (!tableName || !tableInfo) return
  
  // æ ¹æ®è¡¨åå’Œè¡¨ç±»å‹ç”Ÿæˆæ¥å£åç§°
  const tableType = detectTableType(tableInfo)
  formData.value.interfaceName = generateInterfaceName(tableName, tableType)
  formData.value.interfacePath = generateInterfacePath(tableName)
}

const generateSqlTemplate = () => {
  const { tableName, parameters } = formData.value
  
  let sql = `SELECT * FROM ${tableName} WHERE 1=1`
  
  parameters.forEach(param => {
    if (param.isRequired) {
      sql += `\n  AND ${param.name} = #{${param.name}}`
    } else {
      sql += `\n  <if test="${param.name} != null">AND ${param.name} = #{${param.name}}</if>`
    }
  })
  
  formData.value.sqlTemplate = sql
}

const detectTableType = (tableInfo) => {
  const columns = tableInfo.columns || []
  const columnNames = columns.map(col => col.name.toLowerCase())
  
  if (columnNames.some(name => /^value\d+$/.test(name))) {
    return 'hourly_data'
  } else if (columnNames.some(name => /^p\d+$/.test(name))) {
    return 'timeseries'
  } else if (columnNames.includes('devname') && columnNames.includes('devtype')) {
    return 'device_info'
  } else {
    return 'general'
  }
}

const generateInterfaceName = (tableName, tableType) => {
  const typeMap = {
    hourly_data: 'å°æ—¶æ•°æ®æŸ¥è¯¢',
    timeseries: 'æ—¶é—´åºåˆ—æ•°æ®æŸ¥è¯¢',
    device_info: 'è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢',
    general: 'æ•°æ®æŸ¥è¯¢'
  }
  
  return `${tableName}${typeMap[tableType] || typeMap.general}`
}

const generateInterfacePath = (tableName) => {
  // è½¬æ¢ä¸ºé©¼å³°å‘½å
  const camelCase = tableName.replace(/_([a-z])/g, (match, letter) => letter.toUpperCase())
  return `/px-phzhb-external-share/dataproduct/${camelCase}`
}

// ç›‘å¬å™¨
watch(() => props.initialData, (newData) => {
  if (newData) {
    formData.value = { ...formData.value, ...newData }
  }
}, { immediate: true })
</script>

<style scoped>
.interface-generation-wizard {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px;
}

.wizard-steps {
  display: flex;
  justify-content: space-between;
  margin-bottom: 32px;
  padding: 0 20px;
}

.step-item {
  display: flex;
  align-items: center;
  flex: 1;
  cursor: pointer;
  transition: all 0.3s ease;
}

.step-item:not(:last-child)::after {
  content: '';
  flex: 1;
  height: 2px;
  background: #e8e8e8;
  margin: 0 16px;
  transition: background-color 0.3s ease;
}

.step-item.completed::after {
  background: #52c41a;
}

.step-number {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #e8e8e8;
  color: #999;
  font-weight: 500;
  transition: all 0.3s ease;
}

.step-item.active .step-number {
  background: #1890ff;
  color: white;
}

.step-item.completed .step-number {
  background: #52c41a;
  color: white;
}

.step-content {
  margin-left: 12px;
}

.step-title {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin-bottom: 4px;
}

.step-description {
  font-size: 12px;
  color: #666;
}

.wizard-content {
  min-height: 400px;
  margin-bottom: 24px;
}

.wizard-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 24px;
  border-top: 1px solid #e8e8e8;
}

/* è¿‡æ¸¡åŠ¨ç”» */
.slide-fade-enter-active,
.slide-fade-leave-active {
  transition: all 0.3s ease;
}

.slide-fade-enter-from {
  transform: translateX(30px);
  opacity: 0;
}

.slide-fade-leave-to {
  transform: translateX(-30px);
  opacity: 0;
}
</style>
```

#### 10.2.2 æ•°æ®è¡¨æ ¼ç»„ä»¶

**BaseTable.vue**ï¼š

```vue
<template>
  <div class="base-table">
    <!-- è¡¨æ ¼å·¥å…·æ  -->
    <div v-if="showToolbar" class="table-toolbar">
      <div class="toolbar-left">
        <slot name="toolbar-left">
          <div v-if="selectable && selectedRows.length > 0" class="selection-info">
            å·²é€‰æ‹© {{ selectedRows.length }} é¡¹
            <base-button 
              type="link" 
              size="small" 
              @click="clearSelection"
            >
              æ¸…ç©º
            </base-button>
          </div>
        </slot>
      </div>
      
      <div class="toolbar-right">
        <slot name="toolbar-right">
          <!-- åˆ·æ–°æŒ‰é’® -->
          <base-button 
            type="text" 
            :loading="loading"
            @click="handleRefresh"
          >
            <i class="icon-refresh"></i>
          </base-button>
          
          <!-- åˆ—è®¾ç½® -->
          <base-dropdown v-if="columnSettable">
            <base-button type="text">
              <i class="icon-setting"></i>
            </base-button>
            <template #dropdown>
              <div class="column-settings">
                <div 
                  v-for="column in columns" 
                  :key="column.key"
                  class="column-setting-item"
                >
                  <base-checkbox 
                    v-model="column.visible"
                    @change="handleColumnVisibilityChange"
                  >
                    {{ column.title }}
                  </base-checkbox>
                </div>
              </div>
            </template>
          </base-dropdown>
        </slot>
      </div>
    </div>
    
    <!-- è¡¨æ ¼ä¸»ä½“ -->
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <!-- é€‰æ‹©åˆ— -->
            <th v-if="selectable" class="selection-column">
              <base-checkbox 
                :checked="isAllSelected"
                :indeterminate="isIndeterminate"
                @change="handleSelectAll"
              />
            </th>
            
            <!-- æ•°æ®åˆ— -->
            <th 
              v-for="column in visibleColumns" 
              :key="column.key"
              :class="[
                'table-header',
                {
                  'sortable': column.sortable,
                  'sorted': sortField === column.key
                }
              ]"
              :style="{ width: column.width }"
              @click="handleSort(column)"
            >
              <div class="header-content">
                <span>{{ column.title }}</span>
                <div v-if="column.sortable" class="sort-icons">
                  <i 
                    :class="[
                      'icon-caret-up',
                      { 'active': sortField === column.key && sortOrder === 'asc' }
                    ]"
                  ></i>
                  <i 
                    :class="[
                      'icon-caret-down',
                      { 'active': sortField === column.key && sortOrder === 'desc' }
                    ]"
                  ></i>
                </div>
              </div>
            </th>
          </tr>
        </thead>
        
        <tbody>
          <!-- åŠ è½½çŠ¶æ€ -->
          <tr v-if="loading">
            <td :colspan="totalColumns" class="loading-row">
              <div class="loading-content">
                <i class="icon-loading spinning"></i>
                <span>åŠ è½½ä¸­...</span>
              </div>
            </td>
          </tr>
          
          <!-- ç©ºæ•°æ®çŠ¶æ€ -->
          <tr v-else-if="!data || data.length === 0">
            <td :colspan="totalColumns" class="empty-row">
              <div class="empty-content">
                <slot name="empty">
                  <i class="icon-empty"></i>
                  <p>æš‚æ— æ•°æ®</p>
                </slot>
              </div>
            </td>
          </tr>
          
          <!-- æ•°æ®è¡Œ -->
          <tr 
            v-else
            v-for="(row, index) in data" 
            :key="getRowKey(row, index)"
            :class="[
              'table-row',
              {
                'selected': selectedRowKeys.includes(getRowKey(row, index)),
                'hover': hoverable
              }
            ]"
            @click="handleRowClick(row, index)"
            @mouseenter="handleRowHover(row, index, true)"
            @mouseleave="handleRowHover(row, index, false)"
          >
            <!-- é€‰æ‹©åˆ— -->
            <td v-if="selectable" class="selection-column">
              <base-checkbox 
                :checked="selectedRowKeys.includes(getRowKey(row, index))"
                @change="handleRowSelect(row, index, $event)"
                @click.stop
              />
            </td>
            
            <!-- æ•°æ®åˆ— -->
            <td 
              v-for="column in visibleColumns" 
              :key="column.key"
              :class="['table-cell', column.align ? `text-${column.align}` : '']"
            >
              <slot 
                :name="column.key" 
                :row="row" 
                :column="column" 
                :index="index"
              >
                {{ getCellValue(row, column) }}
              </slot>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <!-- åˆ†é¡µå™¨ -->
    <div v-if="pagination && !loading" class="table-pagination">
      <base-pagination 
        v-model:current="currentPage"
        v-model:page-size="currentPageSize"
        :total="pagination.total"
        :show-size-changer="pagination.showSizeChanger"
        :show-quick-jumper="pagination.showQuickJumper"
        :show-total="pagination.showTotal"
        @change="handlePageChange"
        @show-size-change="handlePageSizeChange"
      />
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'

// Propså®šä¹‰
const props = defineProps({
  // è¡¨æ ¼æ•°æ®
  data: {
    type: Array,
    default: () => []
  },
  
  // åˆ—é…ç½®
  columns: {
    type: Array,
    required: true
  },
  
  // è¡Œé”®
  rowKey: {
    type: [String, Function],
    default: 'id'
  },
  
  // åŠ è½½çŠ¶æ€
  loading: {
    type: Boolean,
    default: false
  },
  
  // æ˜¯å¦å¯é€‰æ‹©
  selectable: {
    type: Boolean,
    default: false
  },
  
  // é€‰ä¸­çš„è¡Œé”®
  selectedRowKeys: {
    type: Array,
    default: () => []
  },
  
  // åˆ†é¡µé…ç½®
  pagination: {
    type: [Object, Boolean],
    default: false
  },
  
  // æ˜¯å¦æ˜¾ç¤ºå·¥å…·æ 
  showToolbar: {
    type: Boolean,
    default: true
  },
  
  // æ˜¯å¦å¯è®¾ç½®åˆ—
  columnSettable: {
    type: Boolean,
    default: true
  },
  
  // æ˜¯å¦å¯æ‚¬åœ
  hoverable: {
    type: Boolean,
    default: true
  },
  
  // æ’åºå­—æ®µ
  sortField: {
    type: String,
    default: ''
  },
  
  // æ’åºé¡ºåº
  sortOrder: {
    type: String,
    default: ''
  }
})

// Emitså®šä¹‰
const emit = defineEmits([
  'update:selectedRowKeys',
  'update:sortField',
  'update:sortOrder',
  'row-click',
  'row-select',
  'select-all',
  'sort-change',
  'page-change',
  'refresh'
])

// å“åº”å¼æ•°æ®
const currentPage = ref(props.pagination?.current || 1)
const currentPageSize = ref(props.pagination?.pageSize || 20)

// è®¡ç®—å±æ€§
const visibleColumns = computed(() => {
  return props.columns.filter(column => column.visible !== false)
})

const totalColumns = computed(() => {
  let count = visibleColumns.value.length
  if (props.selectable) count++
  return count
})

const selectedRows = computed(() => {
  return props.data.filter((row, index) => {
    return props.selectedRowKeys.includes(getRowKey(row, index))
  })
})

const isAllSelected = computed(() => {
  return props.data.length > 0 && selectedRows.value.length === props.data.length
})

const isIndeterminate = computed(() => {
  return selectedRows.value.length > 0 && selectedRows.value.length < props.data.length
})

// æ–¹æ³•
const getRowKey = (row, index) => {
  if (typeof props.rowKey === 'function') {
    return props.rowKey(row, index)
  }
  return row[props.rowKey] || index
}

const getCellValue = (row, column) => {
  if (column.render) {
    return column.render(row[column.key], row, column)
  }
  
  const keys = column.key.split('.')
  let value = row
  
  for (const key of keys) {
    value = value?.[key]
    if (value === undefined || value === null) break
  }
  
  return value
}

const handleRowClick = (row, index) => {
  emit('row-click', row, index)
}

const handleRowHover = (row, index, isEnter) => {
  // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†æ‚¬åœæ•ˆæœ
}

const handleRowSelect = (row, index, checked) => {
  const rowKey = getRowKey(row, index)
  let newSelectedKeys = [...props.selectedRowKeys]
  
  if (checked) {
    if (!newSelectedKeys.includes(rowKey)) {
      newSelectedKeys.push(rowKey)
    }
  } else {
    newSelectedKeys = newSelectedKeys.filter(key => key !== rowKey)
  }
  
  emit('update:selectedRowKeys', newSelectedKeys)
  emit('row-select', row, index, checked, selectedRows.value)
}

const handleSelectAll = (checked) => {
  let newSelectedKeys = []
  
  if (checked) {
    newSelectedKeys = props.data.map((row, index) => getRowKey(row, index))
  }
  
  emit('update:selectedRowKeys', newSelectedKeys)
  emit('select-all', checked, selectedRows.value)
}

const clearSelection = () => {
  emit('update:selectedRowKeys', [])
}

const handleSort = (column) => {
  if (!column.sortable) return
  
  let newSortOrder = 'asc'
  
  if (props.sortField === column.key) {
    if (props.sortOrder === 'asc') {
      newSortOrder = 'desc'
    } else if (props.sortOrder === 'desc') {
      newSortOrder = ''
    }
  }
  
  const newSortField = newSortOrder ? column.key : ''
  
  emit('update:sortField', newSortField)
  emit('update:sortOrder', newSortOrder)
  emit('sort-change', newSortField, newSortOrder, column)
}

const handlePageChange = (page, pageSize) => {
  currentPage.value = page
  currentPageSize.value = pageSize
  emit('page-change', page, pageSize)
}

const handlePageSizeChange = (current, size) => {
  currentPage.value = current
  currentPageSize.value = size
  emit('page-change', current, size)
}

const handleRefresh = () => {
  emit('refresh')
}

const handleColumnVisibilityChange = () => {
  // åˆ—å¯è§æ€§å˜åŒ–å¤„ç†
}

// ç›‘å¬å™¨
watch(() => props.pagination?.current, (newVal) => {
  if (newVal !== undefined) {
    currentPage.value = newVal
  }
})

watch(() => props.pagination?.pageSize, (newVal) => {
  if (newVal !== undefined) {
    currentPageSize.value = newVal
  }
})
</script>

<style scoped>
.base-table {
  background: white;
  border-radius: 6px;
  overflow: hidden;
}

.table-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid #e8e8e8;
}

.toolbar-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.toolbar-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

.selection-info {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #666;
  font-size: 14px;
}

.table-container {
  overflow-x: auto;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table-header {
  padding: 12px 16px;
  background: #fafafa;
  border-bottom: 1px solid #e8e8e8;
  font-weight: 500;
  color: #333;
  text-align: left;
}

.table-header.sortable {
  cursor: pointer;
  user-select: none;
}

.table-header.sortable:hover {
  background: #f0f0f0;
}

.header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.sort-icons {
  display: flex;
  flex-direction: column;
  margin-left: 8px;
}

.sort-icons i {
  font-size: 10px;
  color: #bfbfbf;
  line-height: 1;
}

.sort-icons i.active {
  color: #1890ff;
}

.table-row {
  transition: background-color 0.2s ease;
}

.table-row:hover {
  background: #f5f5f5;
}

.table-row.selected {
  background: #e6f7ff;
}

.table-cell {
  padding: 12px 16px;
  border-bottom: 1px solid #e8e8e8;
  color: #333;
}

.selection-column {
  width: 48px;
  text-align: center;
}

.loading-row,
.empty-row {
  text-align: center;
}

.loading-content,
.empty-content {
  padding: 40px 20px;
  color: #999;
}

.loading-content i {
  margin-right: 8px;
}

.spinning {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.empty-content i {
  font-size: 48px;
  color: #d9d9d9;
  margin-bottom: 16px;
  display: block;
}

.table-pagination {
  padding: 16px;
  border-top: 1px solid #e8e8e8;
  display: flex;
  justify-content: flex-end;
}

.column-settings {
  padding: 8px;
  min-width: 120px;
}

.column-setting-item {
  padding: 4px 0;
}

.text-left { text-align: left; }
.text-center { text-align: center; }
.text-right { text-align: right; }
</style>
```

### 10.3 äº¤äº’é€»è¾‘è§„èŒƒ

#### 10.3.1 ç”¨æˆ·äº¤äº’æ¨¡å¼

**ç‚¹å‡»äº¤äº’è§„èŒƒ**ï¼š

```javascript
// æŒ‰é’®ç‚¹å‡»é˜²æŠ–å¤„ç†
const useDebounceClick = (fn, delay = 300) => {
  let timer = null
  
  return (...args) => {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(this, args)
    }, delay)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const handleSubmit = useDebounceClick(async () => {
  // æäº¤é€»è¾‘
}, 500)

// åŒå‡»ç¼–è¾‘æ¨¡å¼
const useDoubleClickEdit = () => {
  const isEditing = ref(false)
  const editValue = ref('')
  
  const startEdit = (value) => {
    isEditing.value = true
    editValue.value = value
  }
  
  const cancelEdit = () => {
    isEditing.value = false
    editValue.value = ''
  }
  
  const confirmEdit = async () => {
    try {
      // ä¿å­˜é€»è¾‘
      await saveValue(editValue.value)
      isEditing.value = false
    } catch (error) {
      // é”™è¯¯å¤„ç†
    }
  }
  
  return {
    isEditing,
    editValue,
    startEdit,
    cancelEdit,
    confirmEdit
  }
}
```

**æ‹–æ‹½äº¤äº’è§„èŒƒ**ï¼š

```javascript
// æ‹–æ‹½æ’åºç»„åˆå¼å‡½æ•°
const useDragSort = (list, options = {}) => {
  const {
    onSort = () => {},
    disabled = false,
    handle = null
  } = options
  
  const dragState = reactive({
    dragging: false,
    dragIndex: -1,
    dropIndex: -1
  })
  
  const handleDragStart = (event, index) => {
    if (disabled) return
    
    dragState.dragging = true
    dragState.dragIndex = index
    
    event.dataTransfer.effectAllowed = 'move'
    event.dataTransfer.setData('text/html', event.target.outerHTML)
  }
  
  const handleDragOver = (event, index) => {
    if (!dragState.dragging) return
    
    event.preventDefault()
    dragState.dropIndex = index
  }
  
  const handleDrop = (event, index) => {
    if (!dragState.dragging) return
    
    event.preventDefault()
    
    const { dragIndex } = dragState
    if (dragIndex !== index) {
      // æ‰§è¡Œæ’åº
      const newList = [...list.value]
      const dragItem = newList.splice(dragIndex, 1)[0]
      newList.splice(index, 0, dragItem)
      
      list.value = newList
      onSort(newList, dragIndex, index)
    }
    
    // é‡ç½®çŠ¶æ€
    dragState.dragging = false
    dragState.dragIndex = -1
    dragState.dropIndex = -1
  }
  
  return {
    dragState,
    handleDragStart,
    handleDragOver,
    handleDrop
  }
}
```

#### 10.3.2 è¡¨å•äº¤äº’è§„èŒƒ

**è¡¨å•éªŒè¯äº¤äº’**ï¼š

```javascript
// è¡¨å•éªŒè¯ç»„åˆå¼å‡½æ•°
const useFormValidation = (rules) => {
  const errors = ref({})
  const isValidating = ref(false)
  
  const validateField = async (field, value) => {
    const fieldRules = rules[field]
    if (!fieldRules) return true
    
    for (const rule of fieldRules) {
      try {
        if (rule.required && (!value || value.toString().trim() === '')) {
          throw new Error(rule.message || `${field}ä¸èƒ½ä¸ºç©º`)
        }
        
        if (rule.pattern && !rule.pattern.test(value)) {
          throw new Error(rule.message || `${field}æ ¼å¼ä¸æ­£ç¡®`)
        }
        
        if (rule.validator) {
          await rule.validator(value)
        }
      } catch (error) {
        errors.value[field] = error.message
        return false
      }
    }
    
    delete errors.value[field]
    return true
  }
  
  const validateForm = async (formData) => {
    isValidating.value = true
    errors.value = {}
    
    const validationPromises = Object.keys(rules).map(field => 
      validateField(field, formData[field])
    )
    
    const results = await Promise.all(validationPromises)
    isValidating.value = false
    
    return results.every(result => result)
  }
  
  const clearErrors = () => {
    errors.value = {}
  }
  
  return {
    errors,
    isValidating,
    validateField,
    validateForm,
    clearErrors
  }
}

// å®æ—¶éªŒè¯ç¤ºä¾‹
const formRules = {
  username: [
    { required: true, message: 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º' },
    { pattern: /^[a-zA-Z][a-zA-Z0-9_]{2,49}$/, message: 'ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®' }
  ],
  email: [
    { required: true, message: 'é‚®ç®±ä¸èƒ½ä¸ºç©º' },
    { pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/, message: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®' }
  ],
  password: [
    { required: true, message: 'å¯†ç ä¸èƒ½ä¸ºç©º' },
    { 
      validator: (value) => {
        if (value.length < 8) {
          throw new Error('å¯†ç é•¿åº¦è‡³å°‘8ä½')
        }
        if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(value)) {
          throw new Error('å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—')
        }
      }
    }
  ]
}

const { errors, validateField, validateForm } = useFormValidation(formRules)
```

### 10.4 äº‹ä»¶å¤„ç†è§„èŒƒ

#### 10.4.1 äº‹ä»¶æ€»çº¿è®¾è®¡

**å…¨å±€äº‹ä»¶ç®¡ç†**ï¼š

```javascript
// utils/eventBus.js
import { ref } from 'vue'

class EventBus {
  constructor() {
    this.events = new Map()
  }
  
  // è®¢é˜…äº‹ä»¶
  on(event, callback) {
    if (!this.events.has(event)) {
      this.events.set(event, [])
    }
    this.events.get(event).push(callback)
    
    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => this.off(event, callback)
  }
  
  // å–æ¶ˆè®¢é˜…
  off(event, callback) {
    if (!this.events.has(event)) return
    
    const callbacks = this.events.get(event)
    const index = callbacks.indexOf(callback)
    if (index > -1) {
      callbacks.splice(index, 1)
    }
  }
  
  // è§¦å‘äº‹ä»¶
  emit(event, ...args) {
    if (!this.events.has(event)) return
    
    const callbacks = this.events.get(event)
    callbacks.forEach(callback => {
      try {
        callback(...args)
      } catch (error) {
        console.error(`äº‹ä»¶å¤„ç†å™¨é”™è¯¯ [${event}]:`, error)
      }
    })
  }
  
  // ä¸€æ¬¡æ€§äº‹ä»¶
  once(event, callback) {
    const onceCallback = (...args) => {
      callback(...args)
      this.off(event, onceCallback)
    }
    this.on(event, onceCallback)
  }
  
  // æ¸…ç©ºæ‰€æœ‰äº‹ä»¶
  clear() {
    this.events.clear()
  }
}

export const eventBus = new EventBus()

// äº‹ä»¶å¸¸é‡å®šä¹‰
export const EVENTS = {
  // ç”¨æˆ·ç›¸å…³
  USER_LOGIN: 'user:login',
  USER_LOGOUT: 'user:logout',
  USER_INFO_UPDATE: 'user:info-update',
  
  // æ¥å£ç›¸å…³
  INTERFACE_CREATED: 'interface:created',
  INTERFACE_UPDATED: 'interface:updated',
  INTERFACE_DELETED: 'interface:deleted',
  INTERFACE_STATUS_CHANGED: 'interface:status-changed',
  
  // è®¢é˜…ç›¸å…³
  SUBSCRIPTION_APPLIED: 'subscription:applied',
  SUBSCRIPTION_APPROVED: 'subscription:approved',
  SUBSCRIPTION_REJECTED: 'subscription:rejected',
  
  // ç³»ç»Ÿç›¸å…³
  NOTIFICATION_RECEIVED: 'notification:received',
  SYSTEM_ERROR: 'system:error',
  NETWORK_ERROR: 'network:error'
}
```

**ç»„ä»¶äº‹ä»¶å¤„ç†**ï¼š

```javascript
// composables/useEventHandler.js
import { onMounted, onUnmounted } from 'vue'
import { eventBus, EVENTS } from '@/utils/eventBus'

export const useEventHandler = () => {
  const unsubscribers = []
  
  const subscribe = (event, handler) => {
    const unsubscribe = eventBus.on(event, handler)
    unsubscribers.push(unsubscribe)
    return unsubscribe
  }
  
  const emit = (event, ...args) => {
    eventBus.emit(event, ...args)
  }
  
  // ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†
  onUnmounted(() => {
    unsubscribers.forEach(unsubscribe => unsubscribe())
  })
  
  return {
    subscribe,
    emit,
    EVENTS
  }
}

// ä½¿ç”¨ç¤ºä¾‹
export default {
  setup() {
    const { subscribe, emit, EVENTS } = useEventHandler()
    
    // è®¢é˜…æ¥å£çŠ¶æ€å˜æ›´äº‹ä»¶
    subscribe(EVENTS.INTERFACE_STATUS_CHANGED, (interfaceData) => {
      console.log('æ¥å£çŠ¶æ€å˜æ›´:', interfaceData)
      // åˆ·æ–°åˆ—è¡¨æˆ–æ›´æ–°UI
    })
    
    // è§¦å‘äº‹ä»¶
    const handleInterfacePublish = (interfaceId) => {
      emit(EVENTS.INTERFACE_STATUS_CHANGED, {
        id: interfaceId,
        status: 'published',
        timestamp: Date.now()
      })
    }
    
    return {
      handleInterfacePublish
    }
  }
}
```

### 10.5 æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡

### 9.1 æ ¸å¿ƒè¡¨DDLè¯­å¥

#### 9.1.1 ç”¨æˆ·ç›¸å…³è¡¨

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT 'é‚®ç®±åœ°å€',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    real_name VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·ç ',
    department VARCHAR(100) COMMENT 'éƒ¨é—¨',
    position VARCHAR(100) COMMENT 'èŒä½',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

-- è§’è‰²è¡¨
CREATE TABLE roles (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§’è‰²ID',
    role_name VARCHAR(50) NOT NULL UNIQUE COMMENT 'è§’è‰²åç§°',
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'è§’è‰²ç¼–ç ',
    description VARCHAR(200) COMMENT 'è§’è‰²æè¿°',
    permissions JSON COMMENT 'æƒé™åˆ—è¡¨',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å…³è”ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role_id INT NOT NULL COMMENT 'è§’è‰²ID',
    assigned_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†é…æ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

#### 9.1.2 æ¥å£ç®¡ç†ç›¸å…³è¡¨

```sql


-- æ¥å£åˆ†ç±»è¡¨
CREATE TABLE interface_categories (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'åˆ†ç±»ID',
    category_name VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»åç§°',
    category_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'åˆ†ç±»ä»£ç ',
    description TEXT COMMENT 'åˆ†ç±»æè¿°',
    color_code VARCHAR(10) COMMENT 'é¢œè‰²æ ‡è¯†',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_category_code (category_code)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¥å£åˆ†ç±»è¡¨';

-- æ¥å£è¡¨
CREATE TABLE interfaces (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¥å£ID',
    interface_name VARCHAR(200) NOT NULL COMMENT 'æ¥å£åç§°',
    interface_path VARCHAR(500) NOT NULL UNIQUE COMMENT 'æ¥å£è·¯å¾„',
    description TEXT COMMENT 'æ¥å£æè¿°',
    category_id INT COMMENT 'åˆ†ç±»ID',
    business_rule_ref VARCHAR(100) COMMENT 'å¯¹åº”æŠ«éœ²è§„åˆ™ç¼–å·',
    
    sql_template TEXT NOT NULL COMMENT 'SQLæŸ¥è¯¢æ¨¡æ¿',
    request_params JSON COMMENT 'è¯·æ±‚å‚æ•°å®šä¹‰',
    response_format JSON COMMENT 'å“åº”æ ¼å¼å®šä¹‰',
    table_type VARCHAR(50) COMMENT 'æ•°æ®è¡¨ç±»å‹(hourly_24,min5_288,device_info)',
    
    status VARCHAR(20) DEFAULT 'unpublished' COMMENT 'æ¥å£çŠ¶æ€(unpublished:æœªä¸Šæ¶,published:å·²ä¸Šæ¶,offline:å·²ä¸‹æ¶)',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    published_at DATETIME COMMENT 'å‘å¸ƒæ—¶é—´',

    FOREIGN KEY (created_by) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES interface_categories(id),
    INDEX idx_interface_path (interface_path),
    INDEX idx_status (status),
    INDEX idx_category_id (category_id),
    INDEX idx_created_by (created_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¥å£è¡¨';

-- æ¥å£å‚æ•°è¡¨
CREATE TABLE interface_parameters (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å‚æ•°ID',
    interface_id BIGINT NOT NULL COMMENT 'æ¥å£ID',
    param_name VARCHAR(100) NOT NULL COMMENT 'å‚æ•°åç§°',
    param_type VARCHAR(50) NOT NULL COMMENT 'å‚æ•°ç±»å‹',
    param_description VARCHAR(200) COMMENT 'å‚æ•°æè¿°',
    is_required TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å¿…å¡«(0:å¦,1:æ˜¯)',
    default_value VARCHAR(200) COMMENT 'é»˜è®¤å€¼',
    validation_rule VARCHAR(500) COMMENT 'éªŒè¯è§„åˆ™',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    FOREIGN KEY (interface_id) REFERENCES interfaces(id) ON DELETE CASCADE,
    INDEX idx_interface_id (interface_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ¥å£å‚æ•°è¡¨';
```

#### 9.1.3 è®¢é˜…ç”³è¯·ç›¸å…³è¡¨

```sql
-- è®¢é˜…ç”³è¯·è¡¨ï¼ˆç®€åŒ–ä¸€çº§å®¡æ‰¹ï¼‰
CREATE TABLE subscription_applications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”³è¯·ID',
    user_id BIGINT NOT NULL COMMENT 'ç”³è¯·ç”¨æˆ·ID',
    interface_id BIGINT NOT NULL COMMENT 'æ¥å£ID',
    application_reason TEXT NOT NULL COMMENT 'ç”³è¯·ç†ç”±',
    business_scenario TEXT COMMENT 'ä¸šåŠ¡åœºæ™¯',
    status VARCHAR(20) DEFAULT 'pending' COMMENT 'ç”³è¯·çŠ¶æ€ï¼špending(å¾…å®¡æ‰¹)ã€approved(é€šè¿‡)ã€rejected(æ‹’ç»)',
    applied_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ç”³è¯·æ—¶é—´',
    approved_at DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
    approved_by BIGINT COMMENT 'å®¡æ‰¹äººID',
    approval_comment TEXT COMMENT 'å®¡æ‰¹æ„è§ï¼ˆæ‹’ç»æ—¶å¿…å¡«ï¼‰',
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (interface_id) REFERENCES interfaces(id),
    FOREIGN KEY (approved_by) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_interface_id (interface_id),
    INDEX idx_status (status),
    INDEX idx_applied_at (applied_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢é˜…ç”³è¯·è¡¨';

-- å®¡æ‰¹è®°å½•è¡¨
CREATE TABLE approval_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
    application_id BIGINT NOT NULL COMMENT 'ç”³è¯·ID',
    approver_id BIGINT NOT NULL COMMENT 'å®¡æ‰¹äººID',
    action VARCHAR(20) NOT NULL COMMENT 'å®¡æ‰¹åŠ¨ä½œ(approve,reject)',
    comment TEXT COMMENT 'å®¡æ‰¹æ„è§',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'å®¡æ‰¹æ—¶é—´',
    FOREIGN KEY (application_id) REFERENCES subscription_applications(id) ON DELETE CASCADE,
    FOREIGN KEY (approver_id) REFERENCES users(id),
    INDEX idx_application_id (application_id),
    INDEX idx_approver_id (approver_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¡æ‰¹è®°å½•è¡¨';
```

#### 9.1.4 APIå¯†é’¥å’Œæ—¥å¿—è¡¨

```sql
-- ç”¨æˆ·åº”ç”¨IDè¡¨ï¼ˆæ›¿ä»£APIå¯†é’¥ï¼‰
CREATE TABLE user_app_ids (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    app_id VARCHAR(32) NOT NULL UNIQUE COMMENT 'åº”ç”¨ID',
    app_name VARCHAR(100) COMMENT 'åº”ç”¨åç§°',
    permissions JSON COMMENT 'æƒé™èŒƒå›´',
    call_limit_per_day INT DEFAULT 10000 COMMENT 'æ¯æ—¥è°ƒç”¨é™åˆ¶',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    last_used_at DATETIME COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',
    expires_at DATETIME COMMENT 'è¿‡æœŸæ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_app_id (app_id),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·åº”ç”¨IDè¡¨';

-- APIå¯†é’¥è¡¨ï¼ˆä¿ç•™å…¼å®¹ï¼‰
CREATE TABLE api_keys (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å¯†é’¥ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    api_key VARCHAR(64) NOT NULL UNIQUE COMMENT 'APIå¯†é’¥',
    secret_key VARCHAR(128) NOT NULL COMMENT 'ç­¾åå¯†é’¥',
    permissions JSON COMMENT 'æƒé™èŒƒå›´',
    expires_at DATETIME COMMENT 'è¿‡æœŸæ—¶é—´',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    last_used_at DATETIME COMMENT 'æœ€åä½¿ç”¨æ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_api_key (api_key),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='APIå¯†é’¥è¡¨';

-- APIè°ƒç”¨æ—¥å¿—è¡¨
CREATE TABLE api_call_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    app_id VARCHAR(32) COMMENT 'åº”ç”¨ID',
    api_key_id BIGINT COMMENT 'APIå¯†é’¥IDï¼ˆå…¼å®¹å­—æ®µï¼‰',
    interface_id BIGINT COMMENT 'æ¥å£ID',
    request_ip VARCHAR(45) COMMENT 'è¯·æ±‚IP',
    request_method VARCHAR(10) COMMENT 'è¯·æ±‚æ–¹æ³•',
    request_params TEXT COMMENT 'è¯·æ±‚å‚æ•°',
    response_status VARCHAR(10) COMMENT 'å“åº”çŠ¶æ€ï¼ˆ0-æˆåŠŸï¼Œå…¶ä»–-å¤±è´¥ï¼‰',
    response_message VARCHAR(200) COMMENT 'å“åº”æ¶ˆæ¯',
    response_body TEXT COMMENT 'å“åº”å†…å®¹',
    response_time_ms INT COMMENT 'å“åº”æ—¶é—´(æ¯«ç§’)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è°ƒç”¨æ—¶é—´',
    FOREIGN KEY (api_key_id) REFERENCES api_keys(id),
    FOREIGN KEY (interface_id) REFERENCES interfaces(id),
    INDEX idx_app_id (app_id),
    INDEX idx_api_key_id (api_key_id),
    INDEX idx_interface_id (interface_id),
    INDEX idx_created_at (created_at),
    INDEX idx_request_ip (request_ip)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='APIè°ƒç”¨æ—¥å¿—è¡¨';

-- æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    user_id BIGINT COMMENT 'æ“ä½œç”¨æˆ·ID',
    operation_type VARCHAR(50) NOT NULL COMMENT 'æ“ä½œç±»å‹',
    operation_desc VARCHAR(200) NOT NULL COMMENT 'æ“ä½œæè¿°',
    target_type VARCHAR(50) COMMENT 'ç›®æ ‡ç±»å‹',
    target_id VARCHAR(100) COMMENT 'ç›®æ ‡ID',
    operation_data JSON COMMENT 'æ“ä½œæ•°æ®',
    request_ip VARCHAR(45) COMMENT 'è¯·æ±‚IP',
    user_agent VARCHAR(500) COMMENT 'ç”¨æˆ·ä»£ç†',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_operation_type (operation_type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œæ—¥å¿—è¡¨';

-- æ‰¹é‡æ“ä½œä»»åŠ¡è¡¨
CREATE TABLE batch_operation_tasks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä»»åŠ¡ID',
    task_id VARCHAR(64) NOT NULL UNIQUE COMMENT 'ä»»åŠ¡æ ‡è¯†',
    user_id BIGINT NOT NULL COMMENT 'æ“ä½œç”¨æˆ·ID',
    operation_type VARCHAR(50) NOT NULL COMMENT 'æ“ä½œç±»å‹(publish/offline/reject)',
    target_type VARCHAR(50) NOT NULL COMMENT 'ç›®æ ‡ç±»å‹(interface)',
    total_count INT NOT NULL COMMENT 'æ€»æ“ä½œæ•°é‡',
    success_count INT DEFAULT 0 COMMENT 'æˆåŠŸæ•°é‡',
    failed_count INT DEFAULT 0 COMMENT 'å¤±è´¥æ•°é‡',
    status VARCHAR(20) DEFAULT 'running' COMMENT 'ä»»åŠ¡çŠ¶æ€(running/completed/failed)',
    operation_reason TEXT COMMENT 'æ“ä½œåŸå› ',
    started_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'å¼€å§‹æ—¶é—´',
    completed_at DATETIME COMMENT 'å®Œæˆæ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_task_id (task_id),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_started_at (started_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰¹é‡æ“ä½œä»»åŠ¡è¡¨';

-- æ‰¹é‡æ“ä½œç»“æœè¡¨
CREATE TABLE batch_operation_results (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç»“æœID',
    task_id VARCHAR(64) NOT NULL COMMENT 'ä»»åŠ¡æ ‡è¯†',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡ID',
    status VARCHAR(20) NOT NULL COMMENT 'æ“ä½œçŠ¶æ€(success/failed/skipped)',
    message TEXT COMMENT 'æ“ä½œç»“æœæ¶ˆæ¯',
    error_code VARCHAR(50) COMMENT 'é”™è¯¯ä»£ç ',
    executed_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ‰§è¡Œæ—¶é—´',
    FOREIGN KEY (task_id) REFERENCES batch_operation_tasks(task_id) ON DELETE CASCADE,
    INDEX idx_task_id (task_id),
    INDEX idx_target_id (target_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰¹é‡æ“ä½œç»“æœè¡¨';

-- é€šçŸ¥è¡¨
CREATE TABLE notifications (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é€šçŸ¥ID',
    user_id BIGINT NOT NULL COMMENT 'æ¥æ”¶ç”¨æˆ·ID',
    type VARCHAR(50) NOT NULL COMMENT 'é€šçŸ¥ç±»å‹(interface_offline/approval_result/system_notice)',
    title VARCHAR(200) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
    content TEXT NOT NULL COMMENT 'é€šçŸ¥å†…å®¹',
    related_type VARCHAR(50) COMMENT 'å…³è”ç±»å‹(interface/application)',
    related_id BIGINT COMMENT 'å…³è”ID',
    status VARCHAR(20) DEFAULT 'unread' COMMENT 'è¯»å–çŠ¶æ€(read/unread)',
    send_methods JSON COMMENT 'å‘é€æ–¹å¼(site/email/sms)',
    send_status JSON COMMENT 'å‘é€çŠ¶æ€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    read_at DATETIME COMMENT 'è¯»å–æ—¶é—´',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥è¡¨';

-- é€šçŸ¥æ¨¡æ¿è¡¨
CREATE TABLE notification_templates (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¨¡æ¿ID',
    template_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'æ¨¡æ¿ç¼–ç ',
    template_name VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    type VARCHAR(50) NOT NULL COMMENT 'é€šçŸ¥ç±»å‹',
    title_template VARCHAR(200) NOT NULL COMMENT 'æ ‡é¢˜æ¨¡æ¿',
    content_template TEXT NOT NULL COMMENT 'å†…å®¹æ¨¡æ¿',
    variables JSON COMMENT 'å˜é‡å®šä¹‰',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€(0:ç¦ç”¨,1:å¯ç”¨)',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_template_code (template_code),
    INDEX idx_type (type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥æ¨¡æ¿è¡¨';
```

### 9.2 åˆå§‹åŒ–æ•°æ®

```sql
-- åˆå§‹åŒ–æ¥å£åˆ†ç±»æ•°æ®
INSERT INTO interface_categories (category_name, category_code, description, color_code, sort_order) VALUES
('æ—¥å‰ç°è´§', 'day_ahead_spot', 'æ—¥å‰ç°è´§å¸‚åœºç›¸å…³æ•°æ®æ¥å£', '#1890ff', 1),
('é¢„æµ‹', 'forecast', 'è´Ÿè·é¢„æµ‹ã€æ–°èƒ½æºé¢„æµ‹ç­‰é¢„æµ‹ç±»æ•°æ®æ¥å£', '#52c41a', 2),
('è¾…åŠ©æœåŠ¡', 'ancillary_service', 'è°ƒé¢‘ã€è°ƒå‹ã€å¤‡ç”¨ç­‰è¾…åŠ©æœåŠ¡æ•°æ®æ¥å£', '#faad14', 3),
('ç”µç½‘è¿è¡Œ', 'grid_operation', 'ç”µç½‘è¿è¡ŒçŠ¶æ€ã€çº¦æŸæƒ…å†µç­‰è¿è¡Œæ•°æ®æ¥å£', '#f5222d', 4);

-- åˆå§‹åŒ–è§’è‰²æ•°æ®
INSERT INTO roles (role_name, role_code, description, permissions) VALUES
('æ•°æ®æ¶ˆè´¹è€…', 'consumer', 'æ•°æ®æ¶ˆè´¹è€…è§’è‰²', '["interface:read", "subscription:apply"]'),
('æŠ€æœ¯éƒ¨ç®¡ç†å‘˜', 'tech', 'æŠ€æœ¯éƒ¨ç®¡ç†å‘˜è§’è‰²', '["interface:read", "interface:create", "interface:update", "audit:read"]'),
('ç»“ç®—éƒ¨ç®¡ç†å‘˜', 'finance', 'ç»“ç®—éƒ¨ç®¡ç†å‘˜è§’è‰²', '["interface:read", "interface:publish", "application:approve", "audit:read"]'),
('ç³»ç»Ÿç®¡ç†å‘˜', 'admin', 'ç³»ç»Ÿç®¡ç†å‘˜è§’è‰²', '["*"]');

-- åˆå§‹åŒ–ç®¡ç†å‘˜ç”¨æˆ·
INSERT INTO users (username, email, password_hash, real_name, department, position) VALUES
('admin', 'admin@powertrading.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaYMk6j8Ej2Gy', 'ç³»ç»Ÿç®¡ç†å‘˜', 'ITéƒ¨', 'ç³»ç»Ÿç®¡ç†å‘˜');

-- åˆ†é…ç®¡ç†å‘˜è§’è‰²
INSERT INTO user_roles (user_id, role_id) VALUES (1, 4);

-- åˆå§‹åŒ–ç®¡ç†å‘˜appId
INSERT INTO user_app_ids (user_id, app_id, app_name, permissions, call_limit_per_day) VALUES
(1, 'ADMIN-SYS-001-MGMT', 'ç³»ç»Ÿç®¡ç†åº”ç”¨', '["*"]', 100000);

-- åˆå§‹åŒ–ç³»ç»Ÿé…ç½®
INSERT INTO system_config (config_key, config_value, description) VALUES
('database.connection.maxPoolSize', '20', 'MySQLè¿æ¥æ± æœ€å¤§è¿æ¥æ•°'),
('database.connection.timeout', '30000', 'MySQLè¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)');

-- ç³»ç»Ÿä¸å†ä½¿ç”¨é€šçŸ¥åŠŸèƒ½ï¼Œç§»é™¤é€šçŸ¥æ¨¡æ¿åˆå§‹åŒ–

-- æ›´æ–°æ¥å£çŠ¶æ€æšä¸¾å€¼
ALTER TABLE interfaces MODIFY COLUMN status VARCHAR(20) DEFAULT 'unpublished' COMMENT 'æ¥å£çŠ¶æ€(unpublished:æœªä¸Šæ¶,published:å·²ä¸Šæ¶,offline:å·²ä¸‹æ¶)';
```

## 10. éƒ¨ç½²æ¶æ„

### 10.1 å®¹å™¨åŒ–éƒ¨ç½²

#### 10.1.1 Docker Composeé…ç½®

```yaml
version: '3.8'

services:
  # å‰ç«¯åº”ç”¨
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - gateway
    networks:
      - power-trading-network

  # APIç½‘å…³
  gateway:
    build:
      context: ./gateway
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - NACOS_SERVER_ADDR=nacos:8848
    depends_on:
      - nacos
    networks:
      - power-trading-network

  # ç”¨æˆ·æœåŠ¡
  user-service:
    build:
      context: ./user-service
      dockerfile: Dockerfile
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - NACOS_SERVER_ADDR=nacos:8848
      - MYSQL_HOST=mysql
    depends_on:
      - mysql
      - nacos
    networks:
      - power-trading-network

  # æ¥å£æœåŠ¡
  interface-service:
    build:
      context: ./interface-service
      dockerfile: Dockerfile
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - NACOS_SERVER_ADDR=nacos:8848
      - MYSQL_HOST=mysql
    depends_on:
      - mysql
      - nacos
    networks:
      - power-trading-network

  # å®¡æ‰¹æœåŠ¡
  approval-service:
    build:
      context: ./approval-service
      dockerfile: Dockerfile
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - NACOS_SERVER_ADDR=nacos:8848
      - MYSQL_HOST=mysql
    depends_on:
      - mysql
      - nacos
    networks:
      - power-trading-network



  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=power_trading
      - MYSQL_USER=power_user
      - MYSQL_PASSWORD=power123
    volumes:
      - mysql_data:/var/lib/mysql
      - ./sql/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - power-trading-network

  # Nacosæ³¨å†Œä¸­å¿ƒ
  nacos:
    image: nacos/nacos-server:v2.2.0
    environment:
      - MODE=standalone
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_USER=root
      - MYSQL_SERVICE_PASSWORD=root123
    ports:
      - "8848:8848"
    depends_on:
      - mysql
    networks:
      - power-trading-network

volumes:
  mysql_data:

networks:
  power-trading-network:
    driver: bridge
```

### 10.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 10.2.1 Kuberneteséƒ¨ç½²é…ç½®

```yaml
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: power-trading

---
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: power-trading
data:
  application.yml: |
    spring:
      profiles:
        active: k8s
      cloud:
        nacos:
          discovery:
            server-addr: nacos-service:8848
          config:
            server-addr: nacos-service:8848
      datasource:
        url: jdbc:mysql://mysql-service:3306/power_trading
        username: power_user
        password: power123

---
# gateway-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gateway-deployment
  namespace: power-trading
spec:
  replicas: 2
  selector:
    matchLabels:
      app: gateway
  template:
    metadata:
      labels:
        app: gateway
    spec:
      containers:
      - name: gateway
        image: power-trading/gateway:v1.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
      volumes:
      - name: config-volume
        configMap:
          name: app-config

---
# gateway-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gateway-service
  namespace: power-trading
spec:
  selector:
    app: gateway
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 8080
  type: LoadBalancer
```

## 11. ç›‘æ§ä¸è¿ç»´

### 11.1 åº”ç”¨ç›‘æ§

#### 11.1.1 Prometheusç›‘æ§é…ç½®

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "power_trading_rules.yml"

scrape_configs:
  - job_name: 'power-trading-gateway'
    static_configs:
      - targets: ['gateway:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s

  - job_name: 'power-trading-services'
    static_configs:
      - targets: 
        - 'user-service:8081'
        - 'interface-service:8082'
        - 'approval-service:8083'
        - 'audit-service:8084'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 15s

  - job_name: 'mysql-exporter'
    static_configs:
      - targets: ['mysql-exporter:9104']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

#### 11.1.2 åŸºç¡€ç›‘æ§æŒ‡æ ‡

**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š

* **ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ç©ºé—´

* **åº”ç”¨æŒ‡æ ‡**ï¼šHTTPè¯·æ±‚æ•°ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡

* **æ•°æ®åº“æŒ‡æ ‡**ï¼šè¿æ¥æ•°ã€æŸ¥è¯¢å“åº”æ—¶é—´ã€æ…¢æŸ¥è¯¢

* **ä¸šåŠ¡æŒ‡æ ‡**ï¼šæ¥å£è°ƒç”¨é‡ã€ç”¨æˆ·æ´»è·ƒæ•°ã€è®¢é˜…ç”³è¯·æ•°

### 11.2 æ—¥å¿—ç®¡ç†

#### 11.2.1 åŸºç¡€æ—¥å¿—é…ç½®

**æ—¥å¿—çº§åˆ«é…ç½®**ï¼š

```yaml
# application.yml
logging:
  level:
    com.powertrading: INFO
    org.springframework: WARN
    org.mybatis: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/power-trading.log
    max-size: 100MB
    max-history: 30
```

**æ—¥å¿—åˆ†ç±»**ï¼š

* **åº”ç”¨æ—¥å¿—**ï¼šä¸šåŠ¡æ“ä½œã€é”™è¯¯ä¿¡æ¯ã€æ€§èƒ½æŒ‡æ ‡

* **è®¿é—®æ—¥å¿—**ï¼šAPIè°ƒç”¨è®°å½•ã€ç”¨æˆ·è®¿é—®è½¨è¿¹

* **ç³»ç»Ÿæ—¥å¿—**ï¼šå¯åŠ¨ä¿¡æ¯ã€é…ç½®å˜æ›´ã€ç³»ç»Ÿå¼‚å¸¸

## 12. å®‰å…¨æ¶æ„

### 12.1 è®¤è¯æˆæƒæœºåˆ¶

#### 12.1.1 JWT Tokené…ç½®

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint() {
        return new JwtAuthenticationEntryPoint();
    }
    
    @Bean
    public JwtRequestFilter jwtRequestFilter() {
        return new JwtRequestFilter();
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    @Bean
    public JwtTokenUtil jwtTokenUtil() {
        return new JwtTokenUtil();
    }
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable()
            .authorizeRequests()
            .antMatchers("/api/v1/auth/**").permitAll()
            .antMatchers("/api/v1/interfaces/catalog").hasAnyRole("CONSUMER", "TECH", "FINANCE", "ADMIN")
            .antMatchers("/api/v1/interfaces/generate").hasAnyRole("TECH", "ADMIN")
            .antMatchers("/api/v1/applications/approve").hasAnyRole("FINANCE", "ADMIN")
            .anyRequest().authenticated()
            .and()
            .exceptionHandling().authenticationEntryPoint(jwtAuthenticationEntryPoint)
            .and()
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);
            
        http.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);
    }
}
```

### 12.2 æ•°æ®åŠ å¯†

#### 12.2.1 æ•æ„Ÿæ•°æ®åŠ å¯†å·¥å…·

```java
@Component
public class EncryptionService {
    
    private static final String ALGORITHM = "AES/GCB/PKCS5Padding";
    private static final String KEY_ALGORITHM = "AES";
    
    @Value("${app.encryption.secret-key}")
    private String secretKey;
    
    public String encrypt(String plainText) {
        try {
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            SecretKeySpec keySpec = new SecretKeySpec(secretKey.getBytes(), KEY_ALGORITHM);
            cipher.init(Cipher.ENCRYPT_MODE, keySpec);
            
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("Encryption failed", e);
        }
    }
    
    public String decrypt(String encryptedText) {
        try {
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            SecretKeySpec keySpec = new SecretKeySpec(secretKey.getBytes(), KEY_ALGORITHM);
            cipher.init(Cipher.DECRYPT_MODE, keySpec);
            
            byte[] decrypted = cipher.doFinal(Base64.getDecoder().decode(encryptedText));
            return new String(decrypted);
        } catch (Exception e) {
            throw new RuntimeException("Decryption failed", e);
        }
    }
}
```

***

## æ–‡æ¡£ç»´æŠ¤ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0\
**æœ€åæ›´æ–°**ï¼š2024-01-15\
**ç»´æŠ¤äººå‘˜**ï¼šæŠ€æœ¯å›¢é˜Ÿ\
**å®¡æ ¸çŠ¶æ€**ï¼šå¾…å®¡æ ¸

**å˜æ›´è®°å½•**ï¼š

* v1.0ï¼šåˆå§‹æŠ€æœ¯æ¶æ„è®¾è®¡ï¼Œå¯¹åº”PRD v1.0åŠŸèƒ½éœ€æ±‚

* åŒ…å«å®Œæ•´çš„å¾®æœåŠ¡æ¶æ„ã€æ•°æ®åº“è®¾è®¡ã€APIå®šä¹‰å’Œéƒ¨ç½²æ–¹æ¡ˆ

* ç®€åŒ–ç”¨æˆ·ä¸­å¿ƒåŠŸèƒ½ï¼šç§»é™¤ä½¿ç”¨ç»Ÿè®¡ã€å®‰å…¨ä¸­å¿ƒã€å¤´åƒä¸Šä¼ ç­‰åŠŸèƒ½

* ç®€åŒ–ç›‘æ§æ¶æ„ï¼šç§»é™¤å¤æ‚çš„å‘Šè­¦è§„åˆ™å’ŒELKé…ç½®ï¼Œä¿ç•™åŸºç¡€ç›‘æ§

* ç§»é™¤æ“ä½œå®¡è®¡æ—¥å¿—è¡¨å’Œç›¸å…³æŠ€æœ¯å®ç°

* ç§»é™¤EChartså›¾è¡¨åº“ä¾èµ–

* ç§»é™¤æ¥å£ç›‘æ§ç›¸å…³æŠ€æœ¯å®ç°ï¼ˆè®¡åˆ’v2.0ç‰ˆæœ¬ï¼‰

* ç§»é™¤è®¡è´¹ç®¡ç†ç›¸å…³æŠ€æœ¯æ¶æ„ï¼ˆæš‚ä¸å®ç°ï¼‰

