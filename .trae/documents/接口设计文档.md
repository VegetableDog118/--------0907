# 电力交易中心接口服务平台接口设计文档 v1.0

## 版本信息

| 版本号  | 发布日期       | 更新内容            | 维护人员 |
| ---- | ---------- | --------------- | ---- |
| v1.0 | 2024-01-15 | 初始版本，包含核心接口设计 | 后端团队 |

---

## 1. 接口设计概览

### 1.1 接口架构

**微服务架构**：
- **Gateway Service** (8080): 统一网关，负责路由、认证、限流
- **User Service** (8086): 用户管理服务
- **Interface Service** (8087): 接口管理服务
- **Approval Service** (8088): 审批服务

**通信协议**：
- 协议：HTTP/HTTPS
- 数据格式：JSON
- 字符编码：UTF-8

### 1.2 接口调用流程

```mermaid
sequenceDiagram
    participant C as 客户端
    participant G as Gateway
    participant A as Auth Service
    participant S as Business Service
    participant D as Database
    
    C->>G: 1. 发送API请求
    G->>A: 2. 验证Token/API Key
    A->>G: 3. 返回认证结果
    alt 认证成功
        G->>S: 4. 转发请求到业务服务
        S->>D: 5. 查询/操作数据
        D->>S: 6. 返回数据结果
        S->>G: 7. 返回业务结果
        G->>C: 8. 返回最终响应
    else 认证失败
        G->>C: 返回401错误
    end
```

## 2. 接口规范

### 2.1 请求规范

**请求头规范**：
```http
Content-Type: application/json
Authorization: Bearer <token>
X-API-Key: <api_key>
X-Request-ID: <unique_request_id>
User-Agent: <client_info>
```

**URL规范**：
```
{protocol}://{host}:{port}/api/{version}/{service}/{resource}

示例：
https://api.powertrading.com/api/v1/interfaces/list
```

**分页参数规范**：
```json
{
  "page": 1,        // 页码，从1开始
  "size": 20,       // 每页大小，默认20，最大100
  "sort": "createTime,desc"  // 排序字段和方向
}
```

### 2.2 响应规范

**统一响应格式**：
```json
{
  "success": true,           // 请求是否成功
  "data": {},               // 响应数据
  "message": "操作成功",      // 响应消息
  "errorCode": null,        // 错误码（成功时为null）
  "timestamp": 1640995200000 // 响应时间戳
}
```

**分页响应格式**：
```json
{
  "success": true,
  "data": {
    "records": [],           // 数据列表
    "total": 100,           // 总记录数
    "page": 1,              // 当前页码
    "size": 20,             // 每页大小
    "pages": 5              // 总页数
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

### 2.3 错误响应格式

```json
{
  "success": false,
  "data": null,
  "message": "参数验证失败",
  "errorCode": "PARAM_INVALID",
  "timestamp": 1640995200000,
  "errors": [              // 详细错误信息（可选）
    {
      "field": "username",
      "message": "用户名不能为空"
    }
  ]
}
```

## 3. 认证和安全机制

### 3.1 认证方式

**JWT Token认证**（用于Web前端）：
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**API Key认证**（用于第三方调用）：
```http
X-API-Key: ak_1234567890abcdef
```

### 3.2 Token结构

**JWT Payload**：
```json
{
  "sub": "user123",        // 用户ID
  "username": "testuser",  // 用户名
  "role": "consumer",      // 用户角色
  "permissions": [         // 权限列表
    "interface:view",
    "interface:subscribe"
  ],
  "iat": 1640995200,       // 签发时间
  "exp": 1641081600        // 过期时间
}
```

### 3.3 权限控制

**角色权限映射**：
```json
{
  "admin": ["*"],          // 超级管理员，所有权限
  "settlement": [
    "interface:publish",
    "interface:unpublish",
    "application:approve"
  ],
  "tech": [
    "interface:create",
    "interface:edit",
    "interface:test"
  ],
  "consumer": [
    "interface:view",
    "interface:subscribe",
    "application:submit"
  ]
}
```

### 3.4 安全措施

**请求限流**：
- 基于IP：每分钟100次请求
- 基于用户：每分钟1000次请求
- 基于API Key：根据订阅等级限制

**数据加密**：
- 传输加密：HTTPS/TLS 1.2+
- 敏感数据：AES-256加密存储
- 密码：BCrypt哈希

**安全头设置**：
```http
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000
```

## 4. 核心接口定义

### 4.1 用户管理接口

#### 4.1.1 用户登录

**接口信息**：
- **URL**: `POST /api/v1/auth/login`
- **描述**: 用户登录认证
- **权限**: 无需认证

**请求参数**：
```json
{
  "username": "testuser",    // 用户名，必填
  "password": "password123", // 密码，必填
  "captcha": "ABCD",        // 验证码，可选
  "rememberMe": false       // 记住登录，可选
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "rt_1234567890abcdef",
    "expiresIn": 7200,
    "user": {
      "id": "user123",
      "username": "testuser",
      "realName": "张三",
      "role": "consumer",
      "permissions": ["interface:view", "interface:subscribe"]
    }
  },
  "message": "登录成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.1.2 获取用户信息

**接口信息**：
- **URL**: `GET /api/v1/users/profile`
- **描述**: 获取当前用户详细信息
- **权限**: 需要认证

**请求参数**：无

**响应示例**：
```json
{
  "success": true,
  "data": {
    "id": "user123",
    "username": "testuser",
    "realName": "张三",
    "companyName": "某某电力公司",
    "phone": "13800138000",
    "email": "test@example.com",
    "department": "技术部",
    "position": "工程师",
    "role": "consumer",
    "status": "active",
    "appId": "ak_1234567890abcdef",
    "apiKeyEnabled": true,
    "lastLoginTime": "2024-01-15T10:30:00Z",
    "loginCount": 25,
    "createTime": "2024-01-01T00:00:00Z"
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.1.3 更新用户信息

**接口信息**：
- **URL**: `PUT /api/v1/users/profile`
- **描述**: 更新当前用户信息
- **权限**: 需要认证

**请求参数**：
```json
{
  "realName": "张三",
  "phone": "13800138000",
  "email": "test@example.com",
  "department": "技术部",
  "position": "高级工程师"
}
```

**响应示例**：
```json
{
  "success": true,
  "data": null,
  "message": "更新成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

### 4.2 接口管理接口

#### 4.2.1 获取接口列表

**接口信息**：
- **URL**: `GET /api/v1/interfaces/list`
- **描述**: 分页查询接口列表
- **权限**: interface:view

**请求参数**：
```json
{
  "page": 1,
  "size": 20,
  "keyword": "电力",        // 关键词搜索，可选
  "categoryId": "cat001",   // 分类筛选，可选
  "status": "published",   // 状态筛选，可选
  "sort": "createTime,desc" // 排序，可选
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "id": "int001",
        "interfaceName": "日前现货价格查询",
        "interfacePath": "/api/v1/market/day-ahead/price",
        "description": "查询指定日期的日前现货市场价格信息",
        "categoryId": "cat001",
        "categoryName": "日前现货",
        "categoryColor": "#1890ff",
        "status": "published",
        "statusDisplay": "已上架",
        "version": "1.0",
        "requestMethod": "POST",
        "rateLimit": 1000,
        "timeout": 30,
        "createTime": "2024-01-01T00:00:00Z",
        "updateTime": "2024-01-15T10:30:00Z",
        "publishTime": "2024-01-10T09:00:00Z",
        "createBy": "tech001",
        "createByName": "技术员A",
        "publishBy": "settlement001",
        "publishByName": "结算员A",
        "subscribed": true,        // 当前用户是否已订阅
        "callCount": 1250         // 调用次数统计
      }
    ],
    "total": 100,
    "page": 1,
    "size": 20,
    "pages": 5
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.2.2 获取接口详情

**接口信息**：
- **URL**: `GET /api/v1/interfaces/{id}`
- **描述**: 获取接口详细信息
- **权限**: interface:view

**路径参数**：
- `id`: 接口ID

**响应示例**：
```json
{
  "success": true,
  "data": {
    "id": "int001",
    "interfaceName": "日前现货价格查询",
    "interfacePath": "/api/v1/market/day-ahead/price",
    "description": "查询指定日期的日前现货市场价格信息",
    "categoryId": "cat001",
    "categoryName": "日前现货",
    "dataSourceId": "ds001",
    "dataSourceName": "主数据库",
    "tableName": "market_price",
    "requestMethod": "POST",
    "status": "published",
    "version": "1.0",
    "sqlTemplate": "SELECT * FROM market_price WHERE trade_date = #{tradeDate}",
    "responseFormat": {
      "type": "object",
      "properties": {
        "tradeDate": {"type": "string", "description": "交易日期"},
        "price": {"type": "number", "description": "价格"}
      }
    },
    "rateLimit": 1000,
    "timeout": 30,
    "parameters": [
      {
        "id": "param001",
        "paramName": "tradeDate",
        "paramType": "date",
        "paramLocation": "body",
        "description": "交易日期",
        "required": true,
        "defaultValue": null,
        "validationRule": "date",
        "example": "2024-01-15",
        "sortOrder": 1
      }
    ],
    "createTime": "2024-01-01T00:00:00Z",
    "updateTime": "2024-01-15T10:30:00Z",
    "publishTime": "2024-01-10T09:00:00Z",
    "createBy": "tech001",
    "createByName": "技术员A"
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.2.3 创建接口

**接口信息**：
- **URL**: `POST /api/v1/interfaces`
- **描述**: 创建新接口
- **权限**: interface:create

**请求参数**：
```json
{
  "interfaceName": "负荷预测查询",
  "interfacePath": "/api/v1/forecast/load",
  "description": "查询指定时间段的负荷预测数据",
  "categoryId": "cat002",
  "dataSourceId": "ds001",
  "tableName": "load_forecast",
  "requestMethod": "POST",
  "sqlTemplate": "SELECT * FROM load_forecast WHERE forecast_time BETWEEN #{startTime} AND #{endTime}",
  "responseFormat": {
    "type": "array",
    "items": {
      "type": "object",
      "properties": {
        "forecastTime": {"type": "string", "description": "预测时间"},
        "loadValue": {"type": "number", "description": "负荷值"}
      }
    }
  },
  "rateLimit": 500,
  "timeout": 60,
  "parameters": [
    {
      "paramName": "startTime",
      "paramType": "datetime",
      "paramLocation": "body",
      "description": "开始时间",
      "required": true,
      "validationRule": "datetime",
      "example": "2024-01-15T00:00:00Z",
      "sortOrder": 1
    },
    {
      "paramName": "endTime",
      "paramType": "datetime",
      "paramLocation": "body",
      "description": "结束时间",
      "required": true,
      "validationRule": "datetime",
      "example": "2024-01-15T23:59:59Z",
      "sortOrder": 2
    }
  ]
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "id": "int002",
    "status": "unpublished"
  },
  "message": "接口创建成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.2.4 上架接口

**接口信息**：
- **URL**: `POST /api/v1/interfaces/{id}/publish`
- **描述**: 上架接口
- **权限**: interface:publish

**路径参数**：
- `id`: 接口ID

**请求参数**：无

**响应示例**：
```json
{
  "success": true,
  "data": null,
  "message": "接口上架成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.2.5 下架接口

**接口信息**：
- **URL**: `POST /api/v1/interfaces/{id}/offline`
- **描述**: 下架接口
- **权限**: interface:unpublish

**路径参数**：
- `id`: 接口ID

**请求参数**：
```json
{
  "offlineReason": "接口维护升级"  // 下架原因，必填
}
```

**响应示例**：
```json
{
  "success": true,
  "data": null,
  "message": "接口下架成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

### 4.3 订阅申请接口

#### 4.3.1 提交订阅申请

**接口信息**：
- **URL**: `POST /api/v1/applications`
- **描述**: 提交接口订阅申请
- **权限**: application:submit

**请求参数**：
```json
{
  "interfaceIds": ["int001", "int002", "int003"],
  "reason": "用于电力交易分析系统，需要获取市场价格和负荷预测数据",
  "businessScenario": "我司正在开发电力交易分析系统，需要实时获取市场数据进行分析决策",
  "estimatedCalls": 10000  // 预计每日调用次数
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "applicationId": "app001",
    "status": "pending",
    "submitTime": "2024-01-15T10:30:00Z"
  },
  "message": "申请提交成功，请等待审批",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.3.2 获取申请列表

**接口信息**：
- **URL**: `GET /api/v1/applications`
- **描述**: 获取订阅申请列表
- **权限**: application:view

**请求参数**：
```json
{
  "page": 1,
  "size": 20,
  "status": "pending",     // 状态筛选，可选
  "userId": "user123",    // 用户筛选（管理员可用），可选
  "sort": "submitTime,desc"
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "id": "app001",
        "userId": "user123",
        "userName": "张三",
        "companyName": "某某电力公司",
        "interfaceIds": ["int001", "int002"],
        "interfaceNames": ["日前现货价格查询", "负荷预测查询"],
        "reason": "用于电力交易分析系统",
        "businessScenario": "开发电力交易分析系统",
        "estimatedCalls": 10000,
        "status": "pending",
        "statusDisplay": "待审批",
        "submitTime": "2024-01-15T10:30:00Z",
        "processTime": null,
        "processBy": null,
        "processComment": null
      }
    ],
    "total": 50,
    "page": 1,
    "size": 20,
    "pages": 3
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.3.3 审批申请

**接口信息**：
- **URL**: `POST /api/v1/applications/{id}/approve`
- **描述**: 审批订阅申请
- **权限**: application:approve

**路径参数**：
- `id`: 申请ID

**请求参数**：
```json
{
  "action": "approve",     // 审批动作：approve/reject
  "comment": "申请理由充分，同意订阅"  // 审批意见
}
```

**响应示例**：
```json
{
  "success": true,
  "data": null,
  "message": "审批成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

### 4.4 数据接口调用

#### 4.4.1 动态接口调用

**接口信息**：
- **URL**: `POST /api/v1/interfaces/execute/{id}`
- **描述**: 调用已订阅的数据接口
- **权限**: 需要有效的API Key和接口订阅权限

**路径参数**：
- `id`: 接口ID

**请求头**：
```http
Content-Type: application/json
X-API-Key: ak_1234567890abcdef
X-Request-ID: req_1234567890
```

**请求参数**（根据接口定义动态变化）：
```json
{
  "tradeDate": "2024-01-15",
  "region": "华北"
}
```

**响应示例**：
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "tradeDate": "2024-01-15",
        "region": "华北",
        "price": 350.5,
        "volume": 1000000,
        "updateTime": "2024-01-15T10:00:00Z"
      }
    ],
    "total": 1,
    "executionTime": 125  // 执行时间（毫秒）
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

### 4.5 系统管理接口

#### 4.5.1 获取接口分类

**接口信息**：
- **URL**: `GET /api/v1/categories`
- **描述**: 获取接口分类列表
- **权限**: 无需认证

**响应示例**：
```json
{
  "success": true,
  "data": [
    {
      "id": "cat001",
      "categoryCode": "day_ahead_spot",
      "categoryName": "日前现货",
      "description": "日前现货市场相关数据接口",
      "color": "#1890ff",
      "sortOrder": 1,
      "interfaceCount": 25  // 该分类下的接口数量
    },
    {
      "id": "cat002",
      "categoryCode": "forecast",
      "categoryName": "预测",
      "description": "负荷预测、新能源预测等预测类数据接口",
      "color": "#52c41a",
      "sortOrder": 2,
      "interfaceCount": 18
    }
  ],
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

#### 4.5.2 获取统计数据

**接口信息**：
- **URL**: `GET /api/v1/statistics/overview`
- **描述**: 获取平台统计概览
- **权限**: statistics:view

**响应示例**：
```json
{
  "success": true,
  "data": {
    "interfaceStats": {
      "totalCount": 150,
      "publishedCount": 120,
      "unpublishedCount": 25,
      "offlineCount": 5
    },
    "userStats": {
      "totalCount": 500,
      "activeCount": 450,
      "pendingCount": 30,
      "inactiveCount": 20
    },
    "subscriptionStats": {
      "totalCount": 2500,
      "activeCount": 2300,
      "expiredCount": 200
    },
    "callStats": {
      "todayCount": 50000,
      "monthCount": 1200000,
      "totalCount": 15000000
    },
    "applicationStats": {
      "pendingCount": 15,
      "approvedCount": 200,
      "rejectedCount": 10
    }
  },
  "message": "查询成功",
  "errorCode": null,
  "timestamp": 1640995200000
}
```

## 5. 错误码定义

### 5.1 HTTP状态码

| 状态码 | 含义 | 说明 |
|--------|------|------|
| 200 | OK | 请求成功 |
| 201 | Created | 资源创建成功 |
| 400 | Bad Request | 请求参数错误 |
| 401 | Unauthorized | 未认证或认证失败 |
| 403 | Forbidden | 无权限访问 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突 |
| 422 | Unprocessable Entity | 参数验证失败 |
| 429 | Too Many Requests | 请求过于频繁 |
| 500 | Internal Server Error | 服务器内部错误 |
| 502 | Bad Gateway | 网关错误 |
| 503 | Service Unavailable | 服务不可用 |

### 5.2 业务错误码

#### 5.2.1 通用错误码

| 错误码 | HTTP状态码 | 错误信息 | 说明 |
|--------|------------|----------|------|
| SUCCESS | 200 | 操作成功 | 请求处理成功 |
| PARAM_INVALID | 400 | 参数验证失败 | 请求参数不符合要求 |
| PARAM_MISSING | 400 | 缺少必需参数 | 必填参数未提供 |
| UNAUTHORIZED | 401 | 未授权访问 | Token无效或已过期 |
| FORBIDDEN | 403 | 无权限访问 | 用户权限不足 |
| RESOURCE_NOT_FOUND | 404 | 资源不存在 | 请求的资源未找到 |
| RESOURCE_CONFLICT | 409 | 资源冲突 | 资源已存在或状态冲突 |
| RATE_LIMIT_EXCEEDED | 429 | 请求频率超限 | 超出API调用频率限制 |
| INTERNAL_ERROR | 500 | 系统内部错误 | 服务器处理异常 |
| SERVICE_UNAVAILABLE | 503 | 服务不可用 | 服务暂时不可用 |

#### 5.2.2 用户相关错误码

| 错误码 | HTTP状态码 | 错误信息 | 说明 |
|--------|------------|----------|------|
| USER_NOT_FOUND | 404 | 用户不存在 | 用户ID不存在 |
| USER_DISABLED | 403 | 用户已禁用 | 用户账号被禁用 |
| USER_PENDING | 403 | 用户待激活 | 用户注册待审核 |
| LOGIN_FAILED | 401 | 登录失败 | 用户名或密码错误 |
| PASSWORD_INVALID | 400 | 密码格式错误 | 密码不符合安全要求 |
| CAPTCHA_INVALID | 400 | 验证码错误 | 验证码不正确或已过期 |
| TOKEN_EXPIRED | 401 | Token已过期 | 访问令牌已过期 |
| TOKEN_INVALID | 401 | Token无效 | 访问令牌格式错误 |
| API_KEY_INVALID | 401 | API Key无效 | API密钥不存在或已禁用 |

#### 5.2.3 接口相关错误码

| 错误码 | HTTP状态码 | 错误信息 | 说明 |
|--------|------------|----------|------|
| INTERFACE_NOT_FOUND | 404 | 接口不存在 | 接口ID不存在 |
| INTERFACE_OFFLINE | 403 | 接口已下架 | 接口不可用 |
| INTERFACE_PATH_CONFLICT | 409 | 接口路径冲突 | 接口路径已被占用 |
| INTERFACE_NOT_SUBSCRIBED | 403 | 未订阅接口 | 用户未订阅该接口 |
| INTERFACE_SUBSCRIPTION_EXPIRED | 403 | 订阅已过期 | 接口订阅已过期 |
| INTERFACE_CALL_LIMIT_EXCEEDED | 429 | 调用次数超限 | 超出接口调用限制 |
| INTERFACE_EXECUTION_TIMEOUT | 500 | 接口执行超时 | 接口查询超时 |
| INTERFACE_EXECUTION_ERROR | 500 | 接口执行错误 | 接口查询异常 |
| DATA_SOURCE_UNAVAILABLE | 503 | 数据源不可用 | 数据源连接失败 |

#### 5.2.4 申请相关错误码

| 错误码 | HTTP状态码 | 错误信息 | 说明 |
|--------|------------|----------|------|
| APPLICATION_NOT_FOUND | 404 | 申请不存在 | 申请ID不存在 |
| APPLICATION_PROCESSED | 409 | 申请已处理 | 申请已审批，不可重复处理 |
| APPLICATION_DUPLICATE | 409 | 重复申请 | 用户已申请相同接口 |
| APPROVAL_PERMISSION_DENIED | 403 | 无审批权限 | 用户无权审批该申请 |

### 5.3 错误响应示例

#### 5.3.1 参数验证错误

```json
{
  "success": false,
  "data": null,
  "message": "参数验证失败",
  "errorCode": "PARAM_INVALID",
  "timestamp": 1640995200000,
  "errors": [
    {
      "field": "username",
      "message": "用户名不能为空",
      "rejectedValue": ""
    },
    {
      "field": "password",
      "message": "密码长度不能少于8位",
      "rejectedValue": "123"
    }
  ]
}
```

#### 5.3.2 权限不足错误

```json
{
  "success": false,
  "data": null,
  "message": "无权限访问",
  "errorCode": "FORBIDDEN",
  "timestamp": 1640995200000,
  "details": {
    "requiredPermission": "interface:publish",
    "userRole": "consumer",
    "userPermissions": ["interface:view", "interface:subscribe"]
  }
}
```

#### 5.3.3 频率限制错误

```json
{
  "success": false,
  "data": null,
  "message": "请求频率超限",
  "errorCode": "RATE_LIMIT_EXCEEDED",
  "timestamp": 1640995200000,
  "details": {
    "limit": 1000,
    "remaining": 0,
    "resetTime": 1640995260000
  }
}
```

## 6. 接口测试

### 6.1 测试环境

**环境信息**：
- **测试环境**: https://test-api.powertrading.com
- **文档地址**: https://test-api.powertrading.com/swagger-ui.html
- **测试账号**: 
  - 管理员: admin / admin123
  - 技术员: tech001 / tech123
  - 结算员: settlement001 / settlement123
  - 消费者: consumer001 / consumer123

### 6.2 接口测试工具

**Postman集合**：
```json
{
  "info": {
    "name": "电力交易接口平台API",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://test-api.powertrading.com"
    },
    {
      "key": "access_token",
      "value": ""
    }
  ]
}
```

**cURL示例**：
```bash
# 用户登录
curl -X POST "https://test-api.powertrading.com/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "consumer001",
    "password": "consumer123"
  }'

# 获取接口列表
curl -X GET "https://test-api.powertrading.com/api/v1/interfaces/list?page=1&size=10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 调用数据接口
curl -X POST "https://test-api.powertrading.com/api/v1/interfaces/execute/int001" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ak_1234567890abcdef" \
  -d '{
    "tradeDate": "2024-01-15"
  }'
```

### 6.3 自动化测试

**测试用例示例**：
```javascript
// Jest测试用例
describe('接口管理API测试', () => {
  let authToken;
  
  beforeAll(async () => {
    // 登录获取Token
    const loginResponse = await request(app)
      .post('/api/v1/auth/login')
      .send({
        username: 'consumer001',
        password: 'consumer123'
      });
    
    authToken = loginResponse.body.data.token;
  });
  
  test('获取接口列表', async () => {
    const response = await request(app)
      .get('/api/v1/interfaces/list')
      .set('Authorization', `Bearer ${authToken}`)
      .query({ page: 1, size: 10 });
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
    expect(response.body.data.records).toBeInstanceOf(Array);
  });
  
  test('获取接口详情', async () => {
    const response = await request(app)
      .get('/api/v1/interfaces/int001')
      .set('Authorization', `Bearer ${authToken}`);
    
    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
    expect(response.body.data.id).toBe('int001');
  });
});
```

## 7. 性能和监控

### 7.1 性能指标

**响应时间要求**：
- 接口列表查询: < 500ms
- 接口详情查询: < 200ms
- 数据接口调用: < 2000ms
- 用户认证: < 100ms

**并发处理能力**：
- 系统并发用户: 1000+
- API调用QPS: 10000+
- 数据库连接池: 100

### 7.2 监控指标

**系统监控**：
```json
{
  "metrics": {
    "api": {
      "totalRequests": 1000000,
      "successRate": 99.5,
      "averageResponseTime": 150,
      "p95ResponseTime": 500,
      "p99ResponseTime": 1000
    },
    "database": {
      "connectionPoolUsage": 75,
      "slowQueryCount": 5,
      "averageQueryTime": 50
    },
    "cache": {
      "hitRate": 85.5,
      "memoryUsage": 60
    },
    "errors": {
      "4xxCount": 1000,
      "5xxCount": 50,
      "timeoutCount": 10
    }
  }
}
```

### 7.3 日志规范

**访问日志格式**：
```json
{
  "timestamp": "2024-01-15T10:30:00.123Z",
  "requestId": "req_1234567890",
  "method": "POST",
  "url": "/api/v1/interfaces/list",
  "userId": "user123",
  "userAgent": "Mozilla/5.0...",
  "clientIp": "192.168.1.100",
  "responseStatus": 200,
  "responseTime": 125,
  "requestSize": 256,
  "responseSize": 1024
}
```

**错误日志格式**：
```json
{
  "timestamp": "2024-01-15T10:30:00.123Z",
  "level": "ERROR",
  "requestId": "req_1234567890",
  "userId": "user123",
  "errorCode": "INTERFACE_EXECUTION_ERROR",
  "errorMessage": "数据库连接超时",
  "stackTrace": "java.sql.SQLException: Connection timeout...",
  "context": {
    "interfaceId": "int001",
    "dataSourceId": "ds001",
    "sqlTemplate": "SELECT * FROM market_price WHERE..."
  }
}
```

---

## 总结

本文档详细定义了电力交易中心接口服务平台的完整接口规范，包括：

1. **统一的接口设计规范**和响应格式
2. **完善的认证和安全机制**
3. **核心业务接口**的详细定义
4. **完整的错误码体系**和异常处理
5. **接口测试**和性能监控方案

接口设计遵循RESTful规范，确保系统的可扩展性和易用性。开发团队应严格按照本文档进行接口开发和调用，确保系统的稳定性和一致性。

文档将随着业务发展持续更新，请相关人员及时关注版本变更。